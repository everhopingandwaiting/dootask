import{m,a as _t}from"./vuex.cc7cb26e.js";import{n as d,M as Ct,U as vt,c as bt,i as Lt,a as w}from"./app.cf46d6aa.js";import{l as _}from"./le5le-store.b40f9152.js";import{l as y}from"./longpress.5305f240.js";import{D as Dt}from"./index.02ada02b.js";import{Q as $}from"./quill-hi.b7c37d93.js";import"./quill-mention-hi.f348056f.js";import{V as xt}from"./vue.c448ed56.js";import{i as St}from"./view-design-hi.d2045547.js";import{V as It}from"./vue-virtual-scroll-list-hi.3a8a6077.js";import{I as $t}from"./ImgUpload.15d1fe95.js";import{U as Mt}from"./tip.8f37a43d.js";var Tt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"common-circle",style:t.style,attrs:{"data-id":t.percent}},[e("svg",{attrs:{viewBox:"0 0 28 28"}},[e("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[e("path",{staticClass:"common-circle-path",attrs:{d:"M-500-100h997V48h-997z"}}),e("g",{attrs:{"fill-rule":"nonzero"}},[e("path",{staticClass:"common-circle-g-path-ring",attrs:{"stroke-width":"3",d:"M14 25.5c6.351 0 11.5-5.149 11.5-11.5S20.351 2.5 14 2.5 2.5 7.649 2.5 14 7.649 25.5 14 25.5z"}}),e("path",{staticClass:"common-circle-g-path-core",attrs:{d:t.arc(t.args)}})])])])])},At=[];const Et={name:"WCircle",props:{percent:{type:Number,default:0},size:{type:Number,default:120}},computed:{style(){let{size:t}=this;return this.isNumeric(t)&&(t+="px"),{width:t,height:t}},args(){const{percent:t}=this;let s=Math.min(360,360/100*t);return s==360?s=0:s==0&&(s=360),{x:14,y:14,r:14,start:360,end:s}}},methods:{isNumeric(t){return t!==""&&!isNaN(parseFloat(t))&&isFinite(t)},point(t,s,e,i){return[(t+Math.sin(i)*e).toFixed(2),(s-Math.cos(i)*e).toFixed(2)]},full(t,s,e,i){return i<=0?`M ${t-e} ${s} A ${e} ${e} 0 1 1 ${t+e} ${s} A ${e} ${e} 1 1 1 ${t-e} ${s} Z`:`M ${t-e} ${s} A ${e} ${e} 0 1 1 ${t+e} ${s} A ${e} ${e} 1 1 1 ${t-e} ${s} M ${t-i} ${s} A ${i} ${i} 0 1 1 ${t+i} ${s} A ${i} ${i} 1 1 1 ${t-i} ${s} Z`},part(t,s,e,i,a,o){const[r,n]=[a/360*2*Math.PI,o/360*2*Math.PI],l=[this.point(t,s,i,r),this.point(t,s,e,r),this.point(t,s,e,n),this.point(t,s,i,n)],c=n-r>Math.PI?"1":"0";return`M ${l[0][0]} ${l[0][1]} L ${l[1][0]} ${l[1][1]} A ${e} ${e} 0 ${c} 1 ${l[2][0]} ${l[2][1]} L ${l[3][0]} ${l[3][1]} A ${i} ${i}  0 ${c} 0 ${l[0][0]} ${l[0][1]} Z`},arc(t){const{x:s=0,y:e=0}=t;let{R:i=0,r:a=0,start:o,end:r}=t;return[i,a]=[Math.max(i,a),Math.min(i,a)],i<=0?"":o!==+o||r!==+r?this.full(s,e,i,a):Math.abs(o-r)<1e-6?"":Math.abs(o-r)%360<1e-6?this.full(s,e,i,a):([o,r]=[o%360,r%360],o>r&&(r+=360),this.part(s,e,i,a,o,r))}}},k={};var jt=d(Et,Tt,At,!1,Ft,null,null,null);function Ft(t){for(let s in k)this[s]=k[s]}var Rt=function(){return jt.exports}();var Ot=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"markdown-body",domProps:{innerHTML:t._s(t.html)},on:{click:t.onCLick}})},Vt=[];const Bt={name:"DialogMarkdown",props:{text:{type:String,default:""}},data(){return{mdi:null}},mounted(){this.copyCodeBlock()},updated(){this.copyCodeBlock()},computed:{html({text:t}){return Ct(t)}},methods:{copyCodeBlock(){this.$el.querySelectorAll(".code-block-wrapper").forEach(s=>{const e=s.querySelector(".code-block-header__copy"),i=s.querySelector(".code-block-body");e&&i&&e.getAttribute("data-copy")!=="click"&&(e.setAttribute("data-copy","click"),e.addEventListener("click",()=>{var a,o,r;(a=navigator.clipboard)!=null&&a.writeText?navigator.clipboard.writeText((o=i.textContent)!=null?o:""):this.copyContent({text:(r=i.textContent)!=null?r:"",origin:!0})}))})},copyContent(t){const s={origin:!0,...t};let e;s.origin?e=document.createElement("textarea"):e=document.createElement("input"),e.setAttribute("readonly","readonly"),e.value=s.text,document.body.appendChild(e),e.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(e)},onCLick(t){this.$emit("click",t)}}},C={};var Pt=d(Bt,Ot,Vt,!1,qt,null,null,null);function qt(t){for(let s in C)this[s]=C[s]}var yt=function(){return Pt.exports}(),Ut=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-text no-dark-content"},[t.msg.type==="md"?e("DialogMarkdown",{attrs:{text:t.msg.text},on:{click:t.viewText}}):e("pre",{domProps:{innerHTML:t._s(t.$A.formatTextMsg(t.msg.text,t.userId))},on:{click:t.viewText}}),t.translation?[e("div",{staticClass:"content-divider"},[e("span"),e("div",{staticClass:"divider-label translation-label",on:{click:t.viewText}},[t._v(t._s(t.translation.label))]),e("span")]),t.msg.type==="md"?e("DialogMarkdown",{attrs:{text:t.translation.content}}):e("pre",{domProps:{innerHTML:t._s(t.$A.formatTextMsg(t.translation.content,t.userId))}})]:t._e()],2)},Nt=[];const zt={components:{DialogMarkdown:yt},props:{msgId:Number,msg:Object},computed:{...m(["cacheTranslations","cacheTranslationLanguage"]),translation({cacheTranslations:t,msgId:s,cacheTranslationLanguage:e}){const i=t.find(a=>a.key===`msg-${s}`&&a.language===e);return i||null}},methods:{viewText(t){this.$emit("viewText",t)}}},b={};var Wt=d(zt,Ut,Nt,!1,Ht,null,null,null);function Ht(t){for(let s in b)this[s]=b[s]}var Qt=function(){return Wt.exports}(),Gt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{class:`content-file ${t.msg.type}`},[e("div",{staticClass:"dialog-file"},[t.msg.type==="img"?e("img",{staticClass:"file-img",style:t.imageStyle(t.msg),attrs:{src:t.imageSrc(t.msg)},on:{click:t.viewFile}}):t.isVideoFile(t.msg)?e("div",{staticClass:"file-video",style:t.imageStyle(t.msg),on:{click:t.viewFile}},[t.msg.thumb?e("img",{attrs:{src:t.msg.thumb}}):e("video",{attrs:{width:t.imageStyle(t.msg,"width"),height:t.imageStyle(t.msg,"height")}},[e("source",{attrs:{src:t.msg.path,type:"video/mp4"}})]),t._m(0)]):e("div",{staticClass:"file-box",on:{click:t.downFile}},[e("img",{staticClass:"file-thumb",attrs:{src:t.msg.thumb}}),e("div",{staticClass:"file-info"},[e("div",{staticClass:"file-name"},[t._v(t._s(t.msg.name))]),e("div",{staticClass:"file-size"},[t._v(t._s(t.$A.bytesToSize(t.msg.size)))])])]),t.msg.percentage?e("div",{staticClass:"file-percentage"},[e("span",{style:t.fileStyle(t.msg.percentage)})]):t._e()])])},Kt=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"file-play"},[e("div",{staticClass:"play-icon"},[e("i",{staticClass:"taskfont"},[t._v("\uE745")])])])}];const Jt={props:{msg:Object},methods:{viewFile(){this.$emit("viewFile")},downFile(){this.$emit("downFile")},fileStyle(t){return t?{width:`${t}%`}:{}},imageStyle({width:t,height:s,thumb:e},i="style"){if(t&&s){const a=$A.imageRatioExceed(t,s,3);$A.imageRatioJudge(e)&&a>0&&(t>s?t=s*a:s=t*a);let o=220,r=220,n=t,l=s;return(t>o||s>r)&&(t>s?(n=o,l=s*(o/t)):(n=t*(r/s),l=r)),i==="width"?n:i==="height"?l:{width:n+"px",height:l+"px"}}return i==="width"||i==="height"?0:{}},imageSrc({width:t,height:s,thumb:e}){const i=$A.imageRatioExceed(t,s,3);return $A.imageRatioJudge(e)&&i>0&&(e=$A.thumbRestore(e)+`/crop/ratio:${i},percentage:320x0`),e},isVideoFile(t){return t.type==="file"&&t.ext==="mp4"&&t.width>0&&t.height>0}}},L={};var Yt=d(Jt,Gt,Kt,!1,Xt,null,null,null);function Xt(t){for(let s in L)this[s]=L[s]}var Zt=function(){return Yt.exports}(),te=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-record no-dark-content"},[e("div",{staticClass:"dialog-record",class:{playing:t.audioPlaying===t.msg.path},style:t.recordStyle(t.msg),on:{click:t.playRecord}},[e("div",{staticClass:"record-time"},[t._v(t._s(t.recordDuration(t.msg.duration)))]),e("div",{staticClass:"record-icon taskfont"})]),t.msg.text?[t._m(0),e("div",{staticClass:"content-additional"},[t._v(t._s(t.msg.text))])]:t._e(),t.translation?[e("div",{staticClass:"content-divider"},[e("span"),e("div",{staticClass:"divider-label translation-label",on:{click:t.viewText}},[t._v(t._s(t.translation.label))]),e("span")]),e("div",{staticClass:"content-additional"},[t._v(t._s(t.translation.content))])]:t._e()],2)},ee=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-divider"},[e("span",{staticClass:"divider-full"})])}];const se={components:{DialogMarkdown:yt},props:{msgId:Number,msg:Object},computed:{...m(["audioPlaying","cacheTranslations","cacheTranslationLanguage"]),translation({cacheTranslations:t,msgId:s,cacheTranslationLanguage:e}){const i=t.find(a=>a.key===`msg-${s}`&&a.language===e);return i||null}},methods:{playRecord(){this.$emit("playRecord")},recordStyle(t){const{duration:s}=t;return{width:50+Math.min(180,Math.floor(s/200))+"px"}},recordDuration(t){const s=Math.floor(t/6e4),e=Math.floor(t/1e3)%60;return s>0?`${s}:${e}\u2033`:`${Math.max(1,e)}\u2033`},viewText(t){this.$emit("viewText",t)}}},D={};var ie=d(se,te,ee,!1,ae,null,null,null);function ae(t){for(let s in D)this[s]=D[s]}var oe=function(){return ie.exports}(),re=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-location no-dark-content"},[e("div",{staticClass:"location-title"},[t._v(t._s(t.msg.title))]),t.msg.address?e("div",{staticClass:"location-address"},[t._v(t._s(t.msg.address))]):t._e(),e("div",{staticClass:"location-preview",style:t.imageStyle(t.msg)})])},ne=[];const le={props:{msg:Object},methods:{imageStyle({width:t,height:s,thumb:e}){if(!e)return{};const i={backgroundImage:`url(${e})`};if(t&&s){const a=$A.scaleToScale(t,s,600);i.backgroundSize=`${a.width}px ${a.height}px`}return i}}},x={};var ce=d(le,re,ne,!1,de,null,null,null);function de(t){for(let s in x)this[s]=x[s]}var ue=function(){return ce.exports}(),he=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-meeting no-dark-content"},[e("ul",{staticClass:"dialog-meeting",class:{"meeting-end":!!t.msg.end_at}},[e("li",[e("em",[t._v(t._s(t.$L("\u4F1A\u8BAE\u4E3B\u9898")))]),t._v(" "+t._s(t.msg.name)+" ")]),e("li",[e("em",[t._v(t._s(t.$L("\u4F1A\u8BAE\u521B\u5EFA\u4EBA")))]),e("UserAvatar",{attrs:{userid:t.msg.userid,"show-icon":!1,"show-name":!0}})],1),e("li",[e("em",[t._v(t._s(t.$L("\u9891\u9053ID")))]),t._v(" "+t._s(t.channelID(t.msg.meetingid))+" ")]),t.msg.end_at?e("li",{staticClass:"meeting-operation"},[t._v(" "+t._s(t.$L("\u4F1A\u8BAE\u5DF2\u7ED3\u675F"))+" ")]):e("li",{staticClass:"meeting-operation",on:{click:t.openMeeting}},[t._v(" "+t._s(t.$L("\u70B9\u51FB\u52A0\u5165\u4F1A\u8BAE"))+" "),e("i",{staticClass:"taskfont"},[t._v("\uE68B")])])])])},pe=[];const me={props:{msg:Object},methods:{openMeeting(){this.$emit("openMeeting")},channelID(t){return t.replace(/^(.{3})(.{3})(.*)$/,"$1 $2 $3")}}},S={};var ge=d(me,he,pe,!1,fe,null,null,null);function fe(t){for(let s in S)this[s]=S[s]}var _e=function(){return ge.exports}(),ve=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-text content-word-chain no-dark-content"},[e("pre",{domProps:{innerHTML:t._s(t.$A.formatTextMsg(t.msg.text,t.userId))}}),e("ul",{class:{expand:t.unfoldWordChainData.indexOf(t.msgId)!==-1}},[t._l((t.msg.list||[]).filter(function(i){return i.type=="case"}),function(i){return e("li",[t._v(" "+t._s(t.$L("\u4F8B"))+" "+t._s(i.text)+" ")])}),t._l((t.msg.list||[]).filter(function(i){return i.type!="case"&&i.text}),function(i,a){return e("li",[a==2&&t.msg.list.length>4?e("span",{staticClass:"expand",on:{click:t.unfoldWordChain}},[t._v(" ..."+t._s(t.$L("\u5C55\u5F00"))+"... ")]):t._e(),e("span",{class:{shrink:a>=2&&t.msg.list.length>4}},[t._v(" "+t._s(a+1)+". "+t._s(i.text)+" ")])])}),e("li",{staticClass:"participate",on:{click:t.onWordChain}},[t._v(" "+t._s(t.$L("\u53C2\u4E0E\u63A5\u9F99"))+" "),e("i",{staticClass:"taskfont"},[t._v("\uE703")])])],2)])},$e=[];const ye={props:{msg:Object,msgId:Number,unfoldWordChainData:Array},methods:{unfoldWordChain(){this.$emit("unfoldWordChain")},onWordChain(){this.$emit("onWordChain")}}},I={};var we=d(ye,ve,$e,!1,ke,null,null,null);function ke(t){for(let s in I)this[s]=I[s]}var Ce=function(){return we.exports}(),be=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-text content-word-vote no-dark-content"},[e("div",{staticClass:"vote-msg-head"},[e("i",{staticClass:"taskfont"},[t._v("\uE7FD")]),e("em",[t._v(t._s(t.$L("\u6295\u7968")))]),e("span",[t._v(t._s(t.msg.multiple==1?t.$L("\u591A\u9009"):t.$L("\u5355\u9009")))]),e("span",[t._v(t._s(t.msg.anonymous==1?t.$L("\u533F\u540D"):t.$L("\u5B9E\u540D")))])]),e("pre",{domProps:{innerHTML:t._s(t.$A.formatTextMsg(t.msg.text,t.userId))}}),(t.msg.votes||[]).filter(function(i){return i.userid==t.userId}).length==0?[t.msg.multiple==0?e("RadioGroup",{attrs:{vertical:""},model:{value:t.voteData[t.msg.uuid],callback:function(i){t.$set(t.voteData,t.msg.uuid,i)},expression:"voteData[msg.uuid]"}},t._l(t.msg.list||[],function(i,a){return e("Radio",{key:a,attrs:{label:i.id}},[t._v(" "+t._s(i.text)+" ")])}),1):e("CheckboxGroup",{model:{value:t.voteData[t.msg.uuid],callback:function(i){t.$set(t.voteData,t.msg.uuid,i)},expression:"voteData[msg.uuid]"}},t._l(t.msg.list||[],function(i,a){return e("Checkbox",{key:a,attrs:{label:i.id}},[t._v(" "+t._s(i.text)+" ")])}),1),e("div",{staticClass:"btn-row"},[(t.voteData[t.msg.uuid]||[]).length==0?e("Button",{staticClass:"ivu-btn-grey",attrs:{disabled:""}},[t._v(t._s(t.$L("\u8BF7\u9009\u62E9\u540E\u6295\u7968")))]):e("Button",{staticClass:"no-dark-content",attrs:{type:"warning",loading:t.msg._loadIng>0},on:{click:function(i){return t.onVote("vote")}}},[t._v(t._s(t.$L("\u7ACB\u5373\u6295\u7968")))])],1)]:[e("div",{staticClass:"vote-result-body"},[e("ul",t._l(t.msg.list||[],function(i){return e("li",[e("div",{staticClass:"vote-option-title"},[t._v(t._s(i.text))]),e("div",{staticClass:"ticket-num"},[e("span",[t._v(t._s(t.getVoteProgress(t.msg,i.id).num)+t._s(t.$L("\u7968")))]),e("span",[t._v(t._s(t.getVoteProgress(t.msg,i.id).progress+"%"))])]),e("Progress",{attrs:{percent:Number(t.getVoteProgress(t.msg,i.id).progress),"stroke-width":5,"hide-info":""}}),t.msg.anonymous==0?e("div",{staticClass:"avatar-row"},[t._l((t.msg.votes||[]).filter(function(a){return a.votes.indexOf(i.id)!=-1}),function(a){return[e("UserAvatar",{attrs:{userid:a.userid,size:18}})]})],2):t._e()],1)}),0)]),t.msg.state==1&&t.msg.userid==t.userId?e("div",{staticClass:"btn-row"},[e("Button",{attrs:{type:"warning",loading:t.msg._loadIng>0},on:{click:function(i){return t.onVote("again")}}},[t._v(t._s(t.$L("\u518D\u6B21\u53D1\u9001")))]),e("Button",{attrs:{type:"warning",loading:t.msg._loadIng>0},on:{click:function(i){return t.onVote("finish")}}},[t._v(t._s(t.$L("\u7ED3\u675F\u6295\u7968")))])],1):t._e()]],2)},Le=[];const De={props:{msg:Object,voteData:Object},methods:{getVoteProgress(t,s){const e=t.votes.filter(a=>(a.votes||"").indexOf(s)!=-1).length,i=e?(e/t.votes.length*100).toFixed(2):"0.00";return{num:e,progress:i}},onVote(t){this.$emit("onVote",t)}}},M={};var xe=d(De,be,Le,!1,Se,null,null,null);function Se(t){for(let s in M)this[s]=M[s]}var Ie=function(){return xe.exports}(),Me=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[t._v(" "+t._s(t.$L("\u60A8\u597D\uFF0C\u6211\u662F\u673A\u5668\u4EBA"))+"\uFF1A"+t._s(t.msg.data.nickname)+"\uFF0C"+t._s(t.$L("\u6211\u7684\u673A\u5668\u4EBAID\u662F"))+"\uFF1A"+t._s(t.msg.data.userid)+"\uFF0C"+t._s(t.$L("\u4F60\u53EF\u4EE5\u53D1\u9001"))+" "),e("span",{staticClass:"mark-color"},[t._v("/help")]),t._v(" "+t._s(t.$L("\u67E5\u770B\u6211\u652F\u6301\u4EC0\u4E48\u547D\u4EE4"))+"\u3002 ")])},Te=[];const Ae={props:{msg:Object},data(){return{}},computed:{},methods:{}},T={};var Ee=d(Ae,Me,Te,!1,je,null,null,null);function je(t){for(let s in T)this[s]=T[s]}var Fe=function(){return Ee.exports}(),Re=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[t._v(t._s(t.$L("\u60A8\u53EF\u4EE5\u901A\u8FC7\u53D1\u9001\u4EE5\u4E0B\u547D\u4EE4\u6765\u63A7\u5236\u6211"))+"\uFF1A")]),e("p",[t._v("\xA0")]),t.msg.manager?[e("p",[e("span",{staticClass:"mark-color"},[t._v("/list")]),t._v(" - "+t._s(t.$L("\u673A\u5668\u4EBA\u5217\u8868")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/newbot ("+t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+")")]),t._v(" - "+t._s(t.$L("\u521B\u5EFA\u673A\u5668\u4EBA")))])]:[e("p",[e("span",{staticClass:"mark-color"},[t._v("/info")]),t._v(" - "+t._s(t.$L("\u67E5\u770B\u673A\u5668\u4EBA\u8BE6\u60C5")))])],e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("\u4FEE\u6539\u673A\u5668\u4EBA")))])]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/setname"+t._s(t.IDLabel)+" ("+t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+")")]),t._v(" - "+t._s(t.$L("\u4FEE\u6539\u673A\u5668\u4EBA\u540D\u79F0")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/deletebot"+t._s(t.IDLabel))]),t._v(" - "+t._s(t.$L("\u5220\u9664\u673A\u5668\u4EBA")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/clearday"+t._s(t.IDLabel)+" ("+t._s(t.$L("\u5929\u6570"))+")")]),t._v(" - "+t._s(t.$L("\u8BBE\u7F6E\u4FDD\u7559\u6D88\u606F\u65F6\u95F4\uFF08\u9ED8\u8BA430\u5929\uFF09")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/webhook"+t._s(t.IDLabel)+" [url]")]),t._v(" - "+t._s(t.$L("\u8BBE\u7F6E\u6D88\u606FWebhook\uFF08\u8BE6\u60C5\u8BF7\u770B API\u63A5\u53E3\u6587\u6863\uFF09")))]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u8BBE\u7F6E")))])]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/token"+t._s(t.IDLabel))]),t._v(" - "+t._s(t.$L("\u751F\u6210Token\u4EE4\u724C")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/revoke"+t._s(t.IDLabel))]),t._v(" - "+t._s(t.$L("\u64A4\u9500\u673A\u5668\u4EBAToken\u4EE4\u724C")))]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("\u4F1A\u8BDD\u7BA1\u7406")))])]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/dialog"+t._s(t.IDLabel)+" ["+t._s(t.$L("\u641C\u7D22\u5173\u952E\u8BCD"))+"]")]),t._v(" - "+t._s(t.$L("\u67E5\u770B\u4F1A\u8BDDID")))]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("API\u63A5\u53E3\u6587\u6863")))])]),e("p",[e("span",{staticClass:"mark-color"},[t._v("/api")]),t._v(" - "+t._s(t.$L("\u67E5\u770B\u63A5\u53E3\u5217\u8868")))])],2)},Oe=[];const Ve={props:{msg:Object},data(){return{}},computed:{IDLabel(){return this.msg.manager?this.$L(" {\u673A\u5668\u4EBAID}"):""}}},A={};var Be=d(Ve,Re,Oe,!1,Pe,null,null,null);function Pe(t){for(let s in A)this[s]=A[s]}var qe=function(){return Be.exports}(),Ue=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u6211\u7684\u673A\u5668\u4EBA")))])]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("ID | \u540D\u79F0 | \u6E05\u7406\u65F6\u95F4 | Webhook")))])]),t._l(t.msg.data,function(i){return e("p",[t._v(t._s(i.userid)+" | "+t._s(i.nickname)+" | "+t._s(i.clear_day)+" | "+t._s(i.webhook_url?"\u2705":"-"))])})],2)},Ne=[];const ze={props:{msg:Object},data(){return{}},computed:{},methods:{}},E={};var We=d(ze,Ue,Ne,!1,He,null,null,null);function He(t){for(let s in E)this[s]=E[s]}var Qe=function(){return We.exports}(),Ge=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u8BE6\u60C5")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])]),e("p",[t._v(t._s(t.$L("\u4FDD\u7559\u6D88\u606F\u65F6\u95F4"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.clear_day))])]),e("p",[t._v(t._s(t.$L("\u6700\u540E\u4E00\u6B21\u6E05\u7406\u65F6\u95F4"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.clear_at||"-"))])]),e("p",[t._v(t._s(t.$L("Webhook\u5730\u5740"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.webhook_url||"-"))])]),e("p",[t._v(t._s(t.$L("Webhook\u8BF7\u6C42\u6B21\u6570"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.webhook_num))])])])},Ke=[];const Je={props:{msg:Object},data(){return{}},computed:{},methods:{}},j={};var Ye=d(Je,Ge,Ke,!1,Xe,null,null,null);function Xe(t){for(let s in j)this[s]=j[s]}var Ze=function(){return Ye.exports}(),ts=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u521B\u5EFA\u6210\u529F")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])])])},es=[];const ss={props:{msg:Object},data(){return{}},computed:{},methods:{}},F={};var is=d(ss,ts,es,!1,as,null,null,null);function as(t){for(let s in F)this[s]=F[s]}var os=function(){return is.exports}(),rs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u8BBE\u7F6E\u540D\u79F0\u6210\u529F")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])])])},ns=[];const ls={props:{msg:Object},data(){return{}},computed:{},methods:{}},R={};var cs=d(ls,rs,ns,!1,ds,null,null,null);function ds(t){for(let s in R)this[s]=R[s]}var us=function(){return cs.exports}(),hs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u5220\u9664\u6210\u529F")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])])])},ps=[];const ms={props:{msg:Object},data(){return{}},computed:{},methods:{}},O={};var gs=d(ms,hs,ps,!1,fs,null,null,null);function fs(t){for(let s in O)this[s]=O[s]}var _s=function(){return gs.exports}(),vs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u751F\u6210Token\u4EE4\u724C")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])]),e("p",[t._v("Token\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.token))])])])},$s=[];const ys={props:{msg:Object},data(){return{}},computed:{},methods:{}},V={};var ws=d(ys,vs,$s,!1,ks,null,null,null);function ks(t){for(let s in V)this[s]=V[s]}var Cs=function(){return ws.exports}(),bs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u64A4\u9500\u673A\u5668\u4EBAToken\u4EE4\u724C")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])])])},Ls=[];const Ds={props:{msg:Object},data(){return{}},computed:{},methods:{}},B={};var xs=d(Ds,bs,Ls,!1,Ss,null,null,null);function Ss(t){for(let s in B)this[s]=B[s]}var Is=function(){return xs.exports}(),Ms=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u8BBE\u7F6EWebhook\u5730\u5740")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])]),e("p",[t._v(t._s(t.$L("Webhook\u5730\u5740"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.webhook_url))])])])},Ts=[];const As={props:{msg:Object},data(){return{}},computed:{},methods:{}},P={};var Es=d(As,Ms,Ts,!1,js,null,null,null);function js(t){for(let s in P)this[s]=P[s]}var Fs=function(){return Es.exports}(),Rs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u8BBE\u7F6E\u4FDD\u7559\u6D88\u606F\u65F6\u95F4")))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBAID"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.userid))])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u540D\u79F0"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname))])]),e("p",[t._v(t._s(t.$L("\u6E05\u7406\u5468\u671F"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.clear_day)+t._s(t.$L("\u5929")))])]),e("p",[t._v(t._s(t.$L("\u4E0B\u6B21\u6E05\u7406"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.clear_at))])])])},Os=[];const Vs={props:{msg:Object},data(){return{}},computed:{},methods:{}},q={};var Bs=d(Vs,Rs,Os,!1,Ps,null,null,null);function Ps(t){for(let s in q)this[s]=q[s]}var qs=function(){return Bs.exports}(),Us=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L("\u673A\u5668\u4EBA"))+" "),e("span",{staticClass:"mark-color"},[t._v(t._s(t.msg.data.nickname)+" (ID:"+t._s(t.msg.data.userid)+")")]),t._v(" "+t._s(t.$L("\u5DF2\u52A0\u5165\u7684\u4F1A\u8BDD"))+"\uFF1A")])]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("\u4F1A\u8BDDID | \u4F1A\u8BDD\u540D\u79F0")))])]),t._l(t.msg.data.list,function(i){return e("p",[t._v(" "+t._s(i.id)+" | "+t._s(i.name)+t._s(i.type=="user"?t.$L(" (\u4E2A\u4EBA)"):"")+" ")])})],2)},Ns=[];const zs={props:{msg:Object},data(){return{}},computed:{},methods:{}},U={};var Ws=d(zs,Us,Ns,!1,Hs,null,null,null);function Hs(t){for(let s in U)this[s]=U[s]}var Qs=function(){return Ws.exports}(),Gs=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[t._v(t._s(t.$L("\u4F60\u53EF\u4EE5\u901A\u8FC7\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u6765\u8BF7\u6C42\u6211"))+":")]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("\u53D1\u9001\u6587\u672C\u6D88\u606F"))+"\uFF1A")])]),e("p",[t._v("curl --request POST '"+t._s(t.$A.apiUrl("dialog/msg/sendtext"))+"' \\")]),e("p",[t._v("--header 'version: "+t._s(t.msg.version)+"' \\")]),e("p",[t._v("--header 'token: "),e("span",{staticClass:"mark-color"},[t._v(t._s(t.$L("\u673A\u5668\u4EBAToken")))]),t._v("' \\")]),e("p",[t._v(`--form 'dialog_id="`),e("span",{staticClass:"mark-color"},[t._v(t._s(t.$L("\u5BF9\u8BDDID")))]),t._v(`"' \\`)]),e("p",[t._v(`--form 'text="`),e("span",{staticClass:"mark-color"},[t._v(t._s(t.$L("\u6D88\u606F\u5185\u5BB9")))]),t._v(`"'`)]),t._m(0),e("p",[t._v(`--form 'key="`),e("span",{staticClass:"mark-color"},[t._v(t._s(t.$L("\u641C\u7D22\u8BCD (\u7559\u7A7A\u81EA\u52A8\u751F\u6210)")))]),t._v(`"'`)]),t._m(1),e("p",[t._v(`--form 'reply_id="`),e("span",{staticClass:"mark-color"},[t._v(t._s(t.$L("\u56DE\u590D\u6307\u5B9A\u6D88\u606FID")))]),t._v(`"'`)]),e("p",[t._v("\xA0")]),e("p",[e("b",[t._v(t._s(t.$L("Webhook\u8BF4\u660E"))+"\uFF1A")])]),e("p",[t._v(t._s(t.$L("\u673A\u5668\u4EBA\u6536\u5230\u6D88\u606F\u540E\u4F1A\u5C06\u6D88\u606FPOST\u63A8\u9001\u5230Webhook\u5730\u5740\uFF0C\u8BF7\u6C42\u8D85\u65F6\u4E3A10\u79D2\uFF0C\u8BF7\u6C42\u53C2\u6570\u5982\u4E0B"))+"\uFF1A")]),e("p",[e("span",{staticClass:"mark-color"},[t._v("text")]),t._v(": "+t._s(t.$L("\u6D88\u606F\u6587\u672C")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("token")]),t._v(": "+t._s(t.$L("\u673A\u5668\u4EBAToken")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("dialog_id")]),t._v(": "+t._s(t.$L("\u5BF9\u8BDDID")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("dialog_type")]),t._v(": "+t._s(t.$L("\u5BF9\u8BDD\u7C7B\u578B")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("msg_id")]),t._v(": "+t._s(t.$L("\u6D88\u606FID")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("msg_uid")]),t._v(": "+t._s(t.$L("\u6D88\u606F\u53D1\u9001\u4EBAID")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("mention")]),t._v(": "+t._s(t.$L("\u662F\u5426\u88AB@\u5230")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("bot_uid")]),t._v(": "+t._s(t.$L("\u673A\u5668\u4EBAID")))]),e("p",[e("span",{staticClass:"mark-color"},[t._v("version")]),t._v(": "+t._s(t.$L("\u7CFB\u7EDF\u7248\u672C")))])])},Ks=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v(`--form 'text_type="`),e("span",{staticClass:"mark-color"},[t._v("[html|md]")]),t._v(`"'`)])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v(`--form 'silence="`),e("span",{staticClass:"mark-color"},[t._v("[yes|no]")]),t._v(`"'`)])}];const Js={props:{msg:Object},data(){return{}},computed:{},methods:{}},N={};var Ys=d(Js,Gs,Ks,!1,Xs,null,null,null);function Xs(t){for(let s in N)this[s]=N[s]}var Zs=function(){return Ys.exports}(),ti=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"open-approve-details",attrs:{"data-id":t.msg.data.id}},[e("b",[t._v(t._s(t.$L(`${t.msg.data.nickname} \u63D0\u4EA4\u7684\u300C${t.msg.data.proc_def_name}\u300D\u5F85\u4F60\u5BA1\u6279`)))]),e("div",{staticClass:"cause"},[e("p",[t._v(t._s(t.$L("\u7533\u8BF7\u4EBA"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v("@"+t._s(t.msg.data.nickname))]),t._v(" "+t._s(t.msg.data.department))]),e("b",[t._v(t._s(t.$L("\u8BE6\u60C5")))]),t.msg.data.type?e("p",[t._v(t._s(t.$L("\u5047\u671F\u7C7B\u578B"))+"\uFF1A"+t._s(t.$L(t.msg.data.type)))]):t._e(),e("p",[t._v(t._s(t.$L("\u5F00\u59CB\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.start_time)+" ("+t._s(t.$L(t.msg.data.start_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u7ED3\u675F\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.end_time)+" ("+t._s(t.$L(t.msg.data.end_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u4E8B\u7531"))+"\uFF1A"+t._s(t.msg.data.description))]),t.msg.data.thumb?e("p",{domProps:{innerHTML:t._s(t.imageHtml(t.msg.data.thumb))}}):t._e()]),e("div",{staticClass:"btn-raw no-dark-content"},[t.msg.action==="pass"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u540C\u610F")))]):t.msg.action==="refuse"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u62D2\u7EDD")))]):t.msg.action==="withdraw"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u64A4\u9500")))]):[e("button",{staticClass:"ivu-btn ivu-btn-primary"},[t._v(t._s(t.$L("\u540C\u610F")))]),e("button",{staticClass:"ivu-btn ivu-btn-error"},[t._v(t._s(t.$L("\u62D2\u7EDD")))])]],2)])},ei=[];const si={props:{msg:Object},data(){return{}},methods:{imageHtml(t){const s=$A.imageRatioHandle({src:t.url,width:t.width,height:t.height,crops:{ratio:3,percentage:"320x0"},scaleSize:220});return`<img src="${s.src}" width="${s.width}" height="${s.height}" />`}}},z={};var ii=d(si,ti,ei,!1,ai,null,null,null);function ai(t){for(let s in z)this[s]=z[s]}var oi=function(){return ii.exports}(),ri=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"open-approve-details",attrs:{"data-id":t.msg.data.id}},[e("b",[t._v(t._s(t.$L(`\u6284\u9001 ${t.msg.data.nickname} \u63D0\u4EA4\u7684\u300C${t.msg.data.proc_def_name}\u300D\u8BB0\u5F55`)))]),e("div",{staticClass:"cause"},[e("p",[t._v(t._s(t.$L("\u7533\u8BF7\u4EBA"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v("@"+t._s(t.msg.data.nickname))]),t._v(" "+t._s(t.msg.data.department))]),e("b",[t._v(t._s(t.$L("\u8BE6\u60C5")))]),t.msg.data.type?e("p",[t._v(t._s(t.$L("\u5047\u671F\u7C7B\u578B"))+"\uFF1A"+t._s(t.$L(t.msg.data.type)))]):t._e(),e("p",[t._v(t._s(t.$L("\u5F00\u59CB\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.start_time)+" ("+t._s(t.$L(t.msg.data.start_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u7ED3\u675F\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.end_time)+" ("+t._s(t.$L(t.msg.data.end_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u4E8B\u7531"))+"\uFF1A"+t._s(t.msg.data.description))])]),e("div",{staticClass:"btn-raw no-dark-content"},[t.msg.is_finished?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u540C\u610F")))]):e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u67E5\u770B\u8BE6\u60C5")))])])])},ni=[];const li={props:{msg:Object},data(){return{}},computed:{},methods:{}},W={};var ci=d(li,ri,ni,!1,di,null,null,null);function di(t){for(let s in W)this[s]=W[s]}var ui=function(){return ci.exports}(),hi=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"open-approve-details",attrs:{"data-id":t.msg.data.id}},[e("b",[t._v(t._s(t.$L(`${t.msg.data.comment_nickname} \u8BC4\u8BBA\u4E86 ${t.msg.data.nickname} \u7684\u300C${t.msg.data.proc_def_name}\u300D\u5BA1\u6279`)))]),e("div",{staticClass:"cause"},[e("p",[t._v(t._s(t.$L("\u7533\u8BF7\u4EBA"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v("@"+t._s(t.msg.data.nickname))]),t._v(" "+t._s(t.msg.data.department))]),e("b",[t._v(t._s(t.$L("\u8BC4\u8BBA\u5185\u5BB9")))]),e("p",[t._v(t._s(t.msg.data.comment_content))]),t.msg.data.thumb?e("p",{domProps:{innerHTML:t._s(t.imageHtml(t.msg.data.thumb))}}):t._e()]),e("div",{staticClass:"btn-raw no-dark-content"},[e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u67E5\u770B\u8BE6\u60C5")))])])])},pi=[];const mi={props:{msg:Object},data(){return{}},methods:{imageHtml(t){const s=$A.imageRatioHandle({src:t.url,width:t.width,height:t.height,crops:{ratio:3,percentage:"320x0"},scaleSize:220});return`<img src="${s.src}" width="${s.width}" height="${s.height}" />`}}},H={};var gi=d(mi,hi,pi,!1,fi,null,null,null);function fi(t){for(let s in H)this[s]=H[s]}var _i=function(){return gi.exports}(),vi=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"open-approve-details",attrs:{"data-id":t.msg.data.id}},[e("b",[t._v(t._s(t.$L(t.title)))]),e("div",{staticClass:"cause"},[e("p",[t._v(t._s(t.$L("\u7533\u8BF7\u4EBA"))+"\uFF1A"),e("span",{staticClass:"mark-color"},[t._v("@"+t._s(t.msg.data.start_nickname))]),t._v(" "+t._s(t.msg.data.department))]),e("b",[t._v(t._s(t.$L("\u8BE6\u60C5")))]),t.msg.data.type?e("p",[t._v(t._s(t.$L("\u5047\u671F\u7C7B\u578B"))+"\uFF1A"+t._s(t.$L(t.msg.data.type)))]):t._e(),e("p",[t._v(t._s(t.$L("\u5F00\u59CB\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.start_time)+" ("+t._s(t.$L(t.msg.data.start_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u7ED3\u675F\u65F6\u95F4"))+"\uFF1A"+t._s(t.msg.data.end_time)+" ("+t._s(t.$L(t.msg.data.end_day_of_week))+")")]),e("p",[t._v(t._s(t.$L("\u4E8B\u7531"))+"\uFF1A"+t._s(t.msg.data.description))])]),e("div",{staticClass:"btn-raw no-dark-content"},[t.msg.action==="pass"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u540C\u610F")))]):t.msg.action==="refuse"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u62D2\u7EDD")))]):t.msg.action==="withdraw"?e("button",{staticClass:"ivu-btn ivu-btn-grey"},[t._v(t._s(t.$L("\u5DF2\u64A4\u9500")))]):t._e()])])},$i=[];const yi={props:{msg:Object},data(){return{}},computed:{title({msg:t}){return t.action==="pass"?`\u60A8\u53D1\u8D77\u7684\u300C${t.data.proc_def_name}\u300D\u5DF2\u901A\u8FC7`:`\u60A8\u53D1\u8D77\u7684\u300C${t.data.proc_def_name}\u300D\u88AB ${t.data.nickname} \u62D2\u7EDD`}},methods:{}},Q={};var wi=d(yi,vi,$i,!1,ki,null,null,null);function ki(t){for(let s in Q)this[s]=Q[s]}var Ci=function(){return wi.exports}(),bi=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[t._v(t._s(t.$L(t.msg.title)))]),e("p",[t._v("\xA0")]),t._l(t.msg.list,function(i){return e("p",[e("span",{staticClass:"mention task",attrs:{"data-id":i.id}},[t._v("#"+t._s(i.name))])])})],2)},Li=[];const Di={props:{msg:Object},data(){return{}},computed:{},methods:{}},G={};var xi=d(Di,bi,Li,!1,Si,null,null,null);function Si(t){for(let s in G)this[s]=G[s]}var Ii=function(){return xi.exports}(),Mi=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("p",[e("b",[t._v(t._s(t.$L(t.msg.title)))])]),e("p",[t._v("\xA0")]),e("p",[t._v(t._s(t.$L("\u6587\u4EF6\u540D"))+": "+t._s(t.msg.name))]),e("p",[t._v(t._s(t.$L("\u6587\u4EF6\u5927\u5C0F"))+": "+t._s(t.$A.bytesToSize(t.msg.size)))]),e("p",{staticStyle:{"margin-top":"10px"}},[e("Button",{staticClass:"no-dark-content",attrs:{to:t.msg.url,target:"_blank",type:"warning"}},[t._v(t._s(t.$L("\u7ACB\u5373\u4E0B\u8F7D")))])],1)])},Ti=[];const Ai={props:{msg:Object},data(){return{}},computed:{},methods:{}},K={};var Ei=d(Ai,Mi,Ti,!1,ji,null,null,null);function ji(t){for(let s in K)this[s]=K[s]}var Fi=function(){return Ei.exports}(),Ri=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",t._l(t.items,function(i,a){return e("p",{key:a,style:i.style},[t._v(t._s(i.content))])}),0)},Oi=[];const Vi={props:{msg:Object},data(){return{}},computed:{items({msg:t}){const{content:s}=t;return $A.isArray(s)?s.map(e=>this.formatContent(e)):[this.formatContent(s)]}},methods:{formatContent(t){return $A.isJson(t)?{content:t.language===!1?t.content:this.$L(t.content),style:t.style||{}}:{content:this.$L(t),style:{}}}}},J={};var Bi=d(Vi,Ri,Oi,!1,Pi,null,null,null);function Pi(t){for(let s in J)this[s]=J[s]}var qi=function(){return Bi.exports}(),Ui=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.isBot?e("div",[t._v(" "+t._s(t.$L("\u4E0D\u652F\u6301\u7684\u6307\u4EE4"))+" "),e("span",{staticClass:"warning-color"},[t._v(t._s(t.msg.type))]),t._v("\uFF0C"+t._s(t.$L("\u4F60\u53EF\u4EE5\u53D1\u9001"))+" "),e("span",{staticClass:"mark-color"},[t._v("/help")]),t._v(" "+t._s(t.$L("\u67E5\u770B\u5E2E\u52A9\u83DC\u5355"))+"\u3002 ")]):e("div",[t._v(" "+t._s(t.$L("\u672A\u77E5\u7684\u6D88\u606F"))+" ")])},Ni=[];const zi={props:{msg:Object},data(){return{}},computed:{isBot(){return/^\//.test(this.msg.type)}},methods:{}},Y={};var Wi=d(zi,Ui,Ni,!1,Hi,null,null,null);function Hi(t){for(let s in Y)this[s]=Y[s]}var Qi=function(){return Wi.exports}(),Gi=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{class:`content-template no-dark-content ${t.msg.type}`,on:{click:t.viewText}},[e(t.currentTemplate,{tag:"component",attrs:{msg:t.msg}})],1)},Ki=[];const Ji={props:{msg:Object},data(){return{}},computed:{currentTemplate(){switch(this.msg.type){case"/hello":return Fe;case"/help":return qe;case"/list":return Qe;case"/info":return Ze;case"/newbot":return os;case"/setname":return us;case"/deletebot":return _s;case"/token":return Cs;case"/revoke":return Is;case"/webhook":return Fs;case"/clearday":return qs;case"/dialog":return Qs;case"/api":return Zs;case"approve_reviewer":return oi;case"approve_notifier":return ui;case"approve_comment_notifier":return _i;case"approve_submitter":return Ci;case"task_list":return Ii;case"file_download":return Fi;case"content":return qi;default:return Qi}}},methods:{viewText(t){this.$emit("viewText",t)}}},X={};var Yi=d(Ji,Gi,Ki,!1,Xi,null,null,null);function Xi(t){for(let s in X)this[s]=X[s]}var Zi=function(){return Yi.exports}(),ta=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-loading"},[t.error===!0?e("Icon",{attrs:{type:"ios-alert-outline"}}):e("Loading")],1)},ea=[];const sa={props:{error:Boolean}},Z={};var ia=d(sa,ta,ea,!1,aa,null,null,null);function aa(t){for(let s in Z)this[s]=Z[s]}var oa=function(){return ia.exports}(),ra=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content-unknown"},[t._v(t._s(t.$L("\u672A\u77E5\u7684\u6D88\u606F")))])},na=[];const la={},tt={};var ca=d(la,ra,na,!1,da,null,null,null);function da(t){for(let s in tt)this[s]=tt[s]}var ua=function(){return ca.exports}(),ha=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"dialog-view",class:t.viewClass,attrs:{"data-id":t.msgData.id}},[t.dialogType==="group"?e("div",{staticClass:"dialog-username"},[e("UserAvatar",{attrs:{userid:t.msgData.userid,"show-icon":!1,"show-name":!0,"click-open-dialog":""}})],1):t._e(),e("div",{directives:[{name:"longpress",rawName:"v-longpress",value:{callback:t.handleLongpress,delay:300},expression:"{callback: handleLongpress, delay: 300}"}],staticClass:"dialog-head",class:t.headClass,on:{click:t.handleClick}},[!t.hideReply&&t.msgData.reply_id&&t.showReplyData(t.msgData.msg.reply_data)?e("div",{staticClass:"dialog-reply no-dark-content",on:{click:t.viewReply}},[e("div",{staticClass:"reply-avatar"},[e("UserAvatar",{attrs:{userid:t.msgData.msg.reply_data.userid,"show-icon":!1,"show-name":!0}})],1),e("div",{staticClass:"reply-desc",domProps:{innerHTML:t._s(t.$A.getMsgSimpleDesc(t.msgData.msg.reply_data,"image-preview"))}})]):t._e(),!t.hideForward&&t.msgData.forward_id&&t.showForwardData(t.msgData.msg.forward_data)?e("div",{staticClass:"dialog-reply no-dark-content",on:{click:function(i){return t.openDialog(t.msgData.msg.forward_data.userid)}}},[e("div",{staticClass:"reply-avatar"},[e("UserAvatar",{attrs:{userid:t.msgData.msg.forward_data.userid,"show-icon":!1,"show-name":!0}})],1)]):t._e(),e("div",{ref:"content",staticClass:"dialog-content",class:t.contentClass},[t.msgData.type==="text"?e("TextMsg",{attrs:{msgId:t.msgData.id,msg:t.msgData.msg},on:{viewText:t.viewText}}):t.msgData.type==="file"?e("FileMsg",{attrs:{msg:t.msgData.msg},on:{viewFile:t.viewFile,downFile:t.downFile}}):t.msgData.type==="record"?e("RecordMsg",{attrs:{msgId:t.msgData.id,msg:t.msgData.msg},on:{playRecord:t.playRecord}}):t.msgData.type==="location"?e("LocationMsg",{attrs:{msg:t.msgData.msg}}):t.msgData.type==="meeting"?e("MeetingMsg",{attrs:{msg:t.msgData.msg},on:{openMeeting:t.openMeeting}}):t.msgData.type==="word-chain"?e("WordChainMsg",{attrs:{msg:t.msgData.msg,msgId:t.msgData.id,unfoldWordChainData:t.unfoldWordChainData},on:{unfoldWordChain:function(i){return t.unfoldWordChain(t.msgData)},onWordChain:t.onWordChain}}):t.msgData.type==="vote"?e("VoteMsg",{attrs:{msg:t.msgData.msg,voteData:t.voteData},on:{onVote:function(i){return t.onVote(i,t.msgData)}}}):t.msgData.type==="template"?e("TemplateMsg",{attrs:{msg:t.msgData.msg},on:{viewText:t.viewText}}):t.isLoading?e("LoadMsg",{attrs:{error:t.msgData.error}}):e("UnknownMsg")],1),t.$A.arrayLength(t.msgData.emoji)>0?e("ul",{staticClass:"dialog-emoji"},t._l(t.msgData.emoji,function(i,a){return e("li",{key:a,class:{hasme:i.userids.includes(t.userId)}},[e("div",{staticClass:"emoji-symbol no-dark-content",on:{click:function(o){return t.onEmoji(i.symbol)}}},[t._v(t._s(i.symbol))]),e("div",{staticClass:"emoji-users",on:{click:function(o){return t.onShowEmojiUser(i)}}},[e("ul",[t._l(i.userids,function(o,r){return[r<t.emojiUsersNum?e("li",{class:{bold:o==t.userId}},[e("UserAvatar",{attrs:{userid:o,"show-name":"","show-icon":!1}})],1):r==t.emojiUsersNum?e("li",[t._v("+"+t._s(i.userids.length-t.emojiUsersNum)+"\u4F4D")]):t._e()]})],2)])])}),0):t._e()]),e("div",{staticClass:"dialog-foot"},[!t.hideReply&&t.msgData.reply_num>0?e("div",{staticClass:"reply",on:{click:t.replyList}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),t._v(" "+t._s(t.msgData.reply_num)+"\u6761\u56DE\u590D ")]):t._e(),t.msgData.tag?e("div",{staticClass:"tag"},[e("i",{staticClass:"taskfont"},[t._v("\uE61E")])]):t._e(),t.msgData.todo?e("div",{staticClass:"todo",on:{click:t.openTodo}},[e("EPopover",{ref:"todo",attrs:{"popper-class":"dialog-wrapper-read-poptip",placement:t.isRightMsg?"bottom-end":"bottom-start"},model:{value:t.todoShow,callback:function(i){t.todoShow=i},expression:"todoShow"}},[e("div",{staticClass:"read-poptip-content"},[e("Scrollbar",{attrs:{"class-name":"read"}},[e("div",{staticClass:"read-title"},[e("em",[t._v(t._s(t.todoDoneList.length))]),t._v(" "+t._s(t.$L("\u5B8C\u6210"))+" ")]),e("ul",t._l(t.todoDoneList,function(i){return e("li",[e("UserAvatar",{attrs:{userid:i.userid,size:26,showName:""}})],1)}),0)]),e("Scrollbar",{attrs:{"class-name":"unread"}},[e("div",{staticClass:"read-title"},[e("em",[t._v(t._s(t.todoUndoneList.length))]),t._v(" "+t._s(t.$L("\u5F85\u529E"))+" "),e("span",{staticClass:"space"}),e("Button",{attrs:{type:"primary",size:"small"},on:{click:t.handleTodoAdd}},[t._v(t._s(t.$L("\u6DFB\u52A0")))])],1),e("ul",t._l(t.todoUndoneList,function(i){return e("li",[e("UserAvatar",{attrs:{userid:i.userid,size:26,showName:""}})],1)}),0)])],1),e("div",{staticClass:"popover-reference",attrs:{slot:"reference"},slot:"reference"})]),t.todoLoad>0?e("Loading"):e("i",{staticClass:"taskfont"},[t._v("\uE7B7")])],1):t._e(),t.msgData.modify?e("div",{staticClass:"modify"},[e("i",{staticClass:"taskfont"},[t._v("\uE779")])]):t._e(),t.msgData.error===!0?e("div",{staticClass:"error",on:{click:t.onError}},[e("Icon",{attrs:{type:"ios-alert"}})],1):t.isLoading?e("Loading",{attrs:{delay:300}}):[t.timeShow?e("div",{staticClass:"time",on:{click:function(i){t.timeShow=!1}}},[t._v(t._s(t.msgData.created_at))]):e("div",{staticClass:"time",attrs:{title:t.msgData.created_at},on:{click:function(i){t.timeShow=!0}}},[t._v(t._s(t.$A.timeFormat(t.msgData.created_at)))]),t.hidePercentage?t._e():[t.msgData.send>1||t.dialogType==="group"?e("div",{staticClass:"percent",on:{click:t.openReadPercentage}},[e("EPopover",{ref:"percent",attrs:{"popper-class":"dialog-wrapper-read-poptip",placement:t.isRightMsg?"bottom-end":"bottom-start"},model:{value:t.percentageShow,callback:function(i){t.percentageShow=i},expression:"percentageShow"}},[e("div",{staticClass:"read-poptip-content"},[e("Scrollbar",{attrs:{"class-name":"read"}},[e("div",{staticClass:"read-title"},[e("em",[t._v(t._s(t.readList.length))]),t._v(" "+t._s(t.$L("\u5DF2\u8BFB"))+" ")]),e("ul",t._l(t.readList,function(i){return e("li",[e("UserAvatar",{attrs:{userid:i.userid,size:26,showName:""}})],1)}),0)]),e("Scrollbar",{attrs:{"class-name":"unread"}},[e("div",{staticClass:"read-title"},[e("em",[t._v(t._s(t.unreadList.length))]),t._v(" "+t._s(t.$L("\u672A\u8BFB"))+" ")]),e("ul",t._l(t.unreadList,function(i){return e("li",[e("UserAvatar",{attrs:{userid:i.userid,size:26,showName:""}})],1)}),0)])],1),e("div",{staticClass:"popover-reference",attrs:{slot:"reference"},slot:"reference"})]),t.percentageLoad>0?e("Loading"):e("WCircle",{attrs:{percent:t.msgData.percentage,size:14}})],1):t.msgData.percentage===100?e("Icon",{staticClass:"done",attrs:{type:"md-done-all"}}):e("Icon",{staticClass:"done",attrs:{type:"md-checkmark"}})]]],2)])},pa=[];const ma={name:"DialogView",components:{UnknownMsg:ua,LoadMsg:oa,TemplateMsg:Zi,VoteMsg:Ie,WordChainMsg:Ce,MeetingMsg:_e,LocationMsg:ue,RecordMsg:oe,TextMsg:Qt,FileMsg:Zt,WCircle:Rt},directives:{longpress:y},props:{msgData:{type:Object,default:()=>({})},dialogType:{type:String,default:""},hidePercentage:{type:Boolean,default:!1},hideReply:{type:Boolean,default:!1},hideForward:{type:Boolean,default:!1},operateVisible:{type:Boolean,default:!1},operateAction:{type:Boolean,default:!1},pointerMouse:{type:Boolean,default:!1},isRightMsg:{type:Boolean,default:!1}},data(){return{timeShow:!1,operateEnter:!1,percentageLoad:0,percentageShow:!1,percentageList:[],todoLoad:0,todoShow:!1,todoList:[],emojiUsersNum:5,voteData:{},dotClicks:[],unfoldWordChainData:[]}},mounted(){this.emojiUsersNum=Math.min(6,Math.max(2,Math.floor((this.windowWidth-180)/52))),Object.keys(this.voteData).length===0&&(this.voteData=JSON.parse(window.localStorage.getItem("__cache:vote__"))||{}),this.unfoldWordChainData.length===0&&(this.unfoldWordChainData=JSON.parse(window.localStorage.getItem("__cache:unfoldWordChain__"))||[])},beforeDestroy(){var t;this.$store.dispatch("audioStop",(t=this.msgData.msg)==null?void 0:t.path)},computed:{...m(["loads"]),..._t(["isLoad"]),isLoading(){return this.msgData.created_at?this.isLoad(`msg-${this.msgData.id}`):!0},viewClass(){const{msgData:t,operateAction:s,operateEnter:e,pointerMouse:i}=this,a=[];return t.type&&a.push(t.type),s&&(a.push("operate-action"),e&&a.push("pointer-mouse")),i&&a.indexOf("pointer-mouse")===-1&&a.push("pointer-mouse"),a},readList(){return this.percentageList.filter(({read_at:t})=>t)},unreadList(){return this.percentageList.filter(({read_at:t})=>!t)},todoDoneList(){return this.todoList.filter(({done_at:t})=>t)},todoUndoneList(){return this.todoList.filter(({done_at:t})=>!t)},headClass(){const{id:t,reply_id:s,type:e,msg:i,emoji:a,dot:o}=this.msgData,r=[];return o&&!this.dotClicks.includes(t)&&r.push("dot"),s===0&&$A.arrayLength(a)===0&&e==="text"&&(/^<img\s+class="emoticon"[^>]*?>$/.test(i.text)||/^\s*<p>\s*([\uD800-\uDBFF][\uDC00-\uDFFF]){1,3}\s*<\/p>\s*$/.test(i.text))&&r.push("transparent"),r},contentClass(){const{type:t,msg:s}=this.msgData,e=[];return t==="text"&&(/^<img\s+class="emoticon"[^>]*?>$/.test(s.text)?e.push("an-emoticon"):/^\s*<p>\s*([\uD800-\uDBFF][\uDC00-\uDFFF]){3}\s*<\/p>\s*$/.test(s.text)?e.push("three-emoji"):/^\s*<p>\s*([\uD800-\uDBFF][\uDC00-\uDFFF]){2}\s*<\/p>\s*$/.test(s.text)?e.push("two-emoji"):/^\s*<p>\s*[\uD800-\uDBFF][\uDC00-\uDFFF]\s*<\/p>\s*$/.test(s.text)&&e.push("an-emoji")),e}},watch:{operateAction(t){this.operateEnter=!1,t&&setTimeout(s=>this.operateEnter=!0,500)},voteData:{handler(t){const s=JSON.parse(window.localStorage.getItem("__cache:vote__"))||{};for(const e in t)s[e]=t[e];Object.keys(s).length>0&&window.localStorage.setItem("__cache:vote__",JSON.stringify(s))},deep:!0}},methods:{handleLongpress(t,s){this.$emit("on-longpress",{event:t,el:s,msgData:this.msgData})},handleClick(){this.msgData.dot&&(this.dotClicks.push(this.msgData.id),this.$store.dispatch("dialogMsgDot",this.msgData))},openTodo(){if(!(this.todoLoad>0)){if(this.todoShow){this.todoShow=!1;return}this.todoLoad++,this.$store.dispatch("call",{url:"dialog/msg/todolist",data:{msg_id:this.msgData.id}}).then(({data:t})=>{this.todoList=t}).catch(()=>{this.todoList=[]}).finally(t=>{setTimeout(()=>{this.todoLoad--,this.todoShow=!0},100)})}},handleTodoAdd(){this.$refs.todo.doClose(),this.$emit("on-other",{event:"todoAdd",data:{msg_id:this.msgData.id,userids:this.todoList.map(({userid:t})=>t)}})},openReadPercentage(){if(!(this.percentageLoad>0)){if(this.percentageShow){this.percentageShow=!1;return}this.percentageLoad++,this.$store.dispatch("call",{url:"dialog/msg/readlist",data:{msg_id:this.msgData.id}}).then(({data:t})=>{this.percentageList=t}).catch(()=>{this.percentageList=[]}).finally(t=>{setTimeout(()=>{this.percentageLoad--,this.percentageShow=!0},100)})}},playRecord(){this.operateVisible||!this.msgData.created_at||this.$store.dispatch("audioPlay",this.msgData.msg.path)},openMeeting(){this.operateVisible||_.Store.set("addMeeting",{type:"join",name:this.msgData.msg.name,meetingid:this.msgData.msg.meetingid,meetingdisabled:!0})},openDialog(t){this.$store.dispatch("openDialogUserid",t).then(s=>{this.goForward({name:"manage-messenger"})}).catch(({msg:s})=>{$A.modalError(s)})},showReplyData(t){return $A.isJson(t)?t.userid:!1},showForwardData(t){return $A.isJson(t)?t.show&&t.userid:!1},viewReply(){this.$emit("on-view-reply",{msg_id:this.msgData.id,reply_id:this.msgData.reply_id})},viewText(t){this.$emit("on-view-text",t,this.$refs.content)},viewFile(){!this.msgData.created_at||this.$emit("on-view-file",this.msgData)},downFile(){!this.msgData.created_at||this.$emit("on-down-file",this.msgData)},replyList(){this.$emit("on-reply-list",{msg_id:this.msgData.id})},onError(){this.$emit("on-error",this.msgData)},onEmoji(t){this.$emit("on-emoji",{msg_id:this.msgData.id,symbol:t})},onShowEmojiUser(t){this.$emit("on-show-emoji-user",t)},unfoldWordChain(t){if(this.unfoldWordChainData.indexOf(t.id)==-1){const s=JSON.parse(window.localStorage.getItem("__cache:unfoldWordChain__"))||[];s.push(t.id),window.localStorage.setItem("__cache:unfoldWordChain__",JSON.stringify(s)),this.unfoldWordChainData.push(t.id)}},onWordChain(){this.$store.state.dialogDroupWordChain={type:"participate",dialog_id:this.msgData.dialog_id,msgData:this.msgData}},onVote(t,s){if(t!="vote"){$A.modalConfirm({content:t=="finish"?"\u786E\u5B9A\u7ED3\u675F\u6295\u7968\uFF1F":"\u518D\u6B21\u53D1\u9001\u6295\u7968\uFF1F",cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A",onOk:()=>{this.submitVote(t,s)}});return}this.submitVote(t,s)},submitVote(t,s){this.$set(s.msg,"_loadIng",1),this.$store.dispatch("call",{url:"dialog/msg/vote",method:"post",data:{dialog_id:s.dialog_id,uuid:s.msg.uuid,vote:this.voteData[s.msg.uuid]||[],type:t}}).then(({data:e})=>{t=="again"&&$A.messageSuccess("\u5DF2\u53D1\u9001"),e.forEach(i=>{this.$store.dispatch("saveDialogMsg",i)})}).catch(({msg:e})=>{$A.modalError(e)}).finally(e=>{this.$set(s.msg,"_loadIng",0)})}}},et={};var ga=d(ma,ha,pa,!1,fa,null,null,null);function fa(t){for(let s in et)this[s]=et[s]}var _a=function(){return ga.exports}(),va=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{class:t.classArray},[t.isUnreadStart?e("div",{staticClass:"dialog-unread-label"},[e("em"),e("span",[t._v(t._s(t.$L("\u4EE5\u4E0B\u4E3A\u65B0\u6D88\u606F")))]),e("em")]):t._e(),t.source.type==="tag"?e("div",{staticClass:"dialog-tag",on:{click:t.onViewTag}},[e("div",{staticClass:"tag-user"},[e("UserAvatar",{attrs:{userid:t.source.userid,"show-name":!0,"show-icon":!1}})],1),t._v(" "+t._s(t.$L(t.source.msg.action==="remove"?"\u53D6\u6D88\u6807\u6CE8":"\u6807\u6CE8\u4E86"))+' "'+t._s(t.$A.getMsgSimpleDesc(t.source.msg.data))+'" ')]):t.source.type==="top"?e("div",{staticClass:"dialog-top",on:{click:t.onViewTag}},[e("div",{staticClass:"tag-user"},[e("UserAvatar",{attrs:{userid:t.source.userid,"show-name":!0,"show-icon":!1}})],1),t._v(" "+t._s(t.$L(t.source.msg.action==="remove"?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876\u4E86"))+' "'+t._s(t.$A.getMsgSimpleDesc(t.source.msg.data))+'" ')]):t.source.type==="todo"?e("div",{staticClass:"dialog-todo",on:{click:t.onViewTodo}},[e("div",{staticClass:"todo-user"},[e("UserAvatar",{attrs:{userid:t.source.userid,"show-name":!0,"show-icon":!1}})],1),t._v(" "+t._s(t.$L(t.source.msg.action==="remove"?"\u53D6\u6D88\u5F85\u529E":t.source.msg.action==="done"?"\u5B8C\u6210":"\u8BBE\u5F85\u529E"))+' "'+t._s(t.$A.getMsgSimpleDesc(t.source.msg.data))+'" '),t.formatTodoUser(t.source.msg.data).length>0?e("div",{staticClass:"todo-users"},[e("span",[t._v(t._s(t.$L("\u7ED9")))]),t._l(t.formatTodoUser(t.source.msg.data),function(i,a){return[a<3?e("div",{staticClass:"todo-user"},[e("UserAvatar",{attrs:{userid:i,"show-name":!0,"show-icon":!1}})],1):a==3?e("div",{staticClass:"todo-user"},[t._v("+"+t._s(t.formatTodoUser(t.source.msg.data).length-3))]):t._e()]})],2):t._e()]):t.source.type==="notice"?e("div",{staticClass:"dialog-notice"},[t._v(" "+t._s(t.$L(t.source.msg.notice))+" ")]):[e("div",{staticClass:"dialog-avatar"},[e("UserAvatar",{directives:[{name:"longpress",rawName:"v-longpress",value:{callback:t.onMention,delay:300},expression:"{callback: onMention, delay: 300}"}],attrs:{userid:t.source.userid,size:30},on:{"open-dialog":t.onOpenDialog}})],1),e("DialogView",{attrs:{"msg-data":t.source,"dialog-type":t.dialogData.type,"hide-percentage":t.hidePercentage,"hide-reply":t.hideReply,"hide-forward":t.hideForward,"operate-visible":t.operateVisible,"operate-action":t.operateVisible&&t.source.id===t.operateItem.id,"pointer-mouse":t.pointerMouse,"is-right-msg":t.isRightMsg},on:{"on-longpress":t.onLongpress,"on-view-reply":t.onViewReply,"on-view-text":t.onViewText,"on-view-file":t.onViewFile,"on-down-file":t.onDownFile,"on-reply-list":t.onReplyList,"on-error":t.onError,"on-emoji":t.onEmoji,"on-other":t.onOther,"on-show-emoji-user":t.onShowEmojiUser}})]],2)},$a=[];const ya={name:"DialogItem",components:{DialogView:_a},directives:{longpress:y},props:{source:{type:Object,default(){return{}}},dialogData:{type:Object,default(){return{}}},operateVisible:{type:Boolean,default:!1},operateItem:{type:Object,default(){return{}}},pointerMouse:{type:Boolean,default:!1},simpleView:{type:Boolean,default:!1},isMyDialog:{type:Boolean,default:!1},msgId:{type:Number,default:0},unreadOne:{type:Number,default:0},scrollIng:{type:Number,default:0},readEnabled:{type:Boolean,default:!1}},computed:{...m(["userId"]),isRightMsg(){return this.source.userid==this.$store.state.userId},isReply(){return this.simpleView||this.msgId===this.source.id},isNoRead(){return this.isRightMsg||this.source.read_at},isUnreadStart(){return this.unreadOne===this.source.id},hidePercentage(){return this.simpleView||this.isMyDialog||this.isReply},hideReply(){return this.simpleView||this.msgId>0},hideForward(){return this.simpleView||this.msgId>0},classArray(){return{"dialog-item":!0,"reply-item":this.isReply,"unread-start":this.isUnreadStart,self:this.isRightMsg}}},watch:{readEnabled(){this.msgRead()},windowActive(){this.msgRead()},scrollIng(){this.msgRead()}},methods:{msgRead(){var t;this.isNoRead||!this.readEnabled||!this.windowActive||!((t=this.$el)!=null&&t.parentNode.classList.contains("item-enter"))||this.$store.dispatch("dialogMsgRead",this.source)},formatTodoUser(t){if($A.isJson(t)){const{userids:s}=t;if(s)return s.split(",")}return[]},onViewTag(){this.onViewReply({msg_id:this.source.id,reply_id:this.source.msg.data.id})},onViewTodo(){this.onViewReply({msg_id:this.source.id,reply_id:this.source.msg.data.id})},onOpenDialog(t){var s;(this.dialogData.type=="group"||![(s=this.dialogData.dialog_user)==null?void 0:s.userid,this.userId].includes(t))&&this.$store.dispatch("openDialogUserid",t).then(e=>{this.goForward({name:"manage-messenger"})}).catch(({msg:e})=>{$A.modalError(e)})},onMention(){this.dispatch("on-mention",this.source)},onLongpress(t){this.dispatch("on-longpress",t)},onViewReply(t){this.dispatch("on-view-reply",t)},onViewText(t,s){this.dispatch("on-view-text",t,s)},onViewFile(t){this.dispatch("on-view-file",t)},onDownFile(t){this.dispatch("on-down-file",t)},onReplyList(t){this.dispatch("on-reply-list",t)},onError(t){this.dispatch("on-error",t)},onEmoji(t){this.dispatch("on-emoji",t)},onOther(t){this.dispatch("on-other",t)},onShowEmojiUser(t){this.dispatch("on-show-emoji-user",t)},dispatch(t,...s){if(this.isReply){this.$emit(t,...s);return}let e=this.$parent,i=e.$options.name;for(;e&&(!i||i!=="virtual-list");)e=e.$parent,e&&(i=e.$options.name);e&&e.$emit(t,...s)}}},st={};var wa=d(ya,va,$a,!1,ka,null,null,null);function ka(t){for(let s in st)this[s]=st[s]}var it=function(){return wa.exports}(),Ca=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Upload",{ref:"upload",attrs:{name:"files",action:t.actionUrl,headers:t.headers,data:t.params,multiple:"",format:t.uploadFormat,"show-upload-list":!1,"max-size":t.maxSize,"before-upload":t.handleBeforeUpload,"on-progress":t.handleProgress,"on-success":t.handleSuccess,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize}})},ba=[];const La={name:"DialogUpload",props:{dialogId:{type:Number,default:0},maxSize:{type:Number,default:1024e3}},data(){return{fileMsgCaches:{},uploadFormat:[],actionUrl:$A.apiUrl("dialog/msg/sendfile")}},computed:{...m(["cacheDialogs"]),headers(){return{fd:$A.getSessionStorageString("userWsFd"),token:this.userToken}},params(){return{dialog_id:this.dialogId,reply_id:this.dialogData.extra_quote_id||0}},dialogData(){return this.cacheDialogs.find(({id:t})=>t==this.dialogId)||{}}},methods:{fileMsgName(t){return`${t.name}::${t.size}`},fileMsgData(t,s=void 0){const e=this.fileMsgName(t);if($A.isJson(s)){this.fileMsgCaches[e]=Object.assign(this.fileMsgCaches[e]||{},s);return}s={type:"file",thumb:null,width:-1,height:-1,name:t.name,size:t.size,ext:t.name.split(".").pop()};let{ext:i}=s;i==="docx"?i="doc":i==="xlsx"?i="xls":i==="pptx"&&(i="ppt"),["ai","avi","bmp","cdr","doc","eps","gif","mov","mp3","mp4","pdf","ppt","pr","psd","rar","svg","tif","txt","xls","zip"].includes(i)?s.thumb=$A.mainUrl(`images/ext/${i}.png`):s.thumb=$A.mainUrl("images/ext/file.png"),this.fileMsgCaches[e]=s},handleBeforeUpload(t){return new Promise(s=>{if(this.fileMsgData(t),/\.(jpe?g|webp|png|gif)$/i.test(t.name)){this.$store.dispatch("showSpinner",600),this.imageFileToObject(t).then(e=>{this.fileMsgData(t,e),s()}).finally(()=>{this.$store.dispatch("hiddenSpinner")});return}s()})},handleProgress(t,s){if(s.tempId===void 0){this.$parent.$options.name==="DialogWrapper"?s.tempId=this.$parent.getTempId():s.tempId=$A.randNum(1e9,9999999999),s.msg={};const e=this.fileMsgName(s);this.fileMsgCaches[e]&&(s.msg=this.fileMsgCaches[e],delete this.fileMsgCaches[e])}this.$emit("on-progress",s)},handleSuccess(t,s){t.ret===1?(s.data=t.data,this.$emit("on-success",s),t.data.task_id&&this.$store.dispatch("getTaskFiles",t.data.task_id)):($A.modalWarning({title:"\u53D1\u9001\u5931\u8D25",content:"\u6587\u4EF6 "+s.name+" \u53D1\u9001\u5931\u8D25\uFF0C"+t.msg}),this.$emit("on-error",s),this.$refs.upload.fileList.pop())},handleFormatError(t){$A.modalWarning({title:"\u6587\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E",content:"\u6587\u4EF6 "+t.name+" \u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u4EC5\u652F\u6301\u53D1\u9001\uFF1A"+this.uploadFormat.join(",")})},handleMaxSize(t){$A.modalWarning({title:"\u8D85\u51FA\u6587\u4EF6\u5927\u5C0F\u9650\u5236",content:"\u6587\u4EF6 "+t.name+" \u592A\u5927\uFF0C\u4E0D\u80FD\u53D1\u9001\u8D85\u8FC7"+$A.bytesToSize(this.maxSize*1024)+"\u3002"})},handleClick(){this.$refs.upload.handleClick()},upload(t){this.$refs.upload.upload(t)},cancel(t){return this.$refs.upload.cancel(t)},imageFileToObject(t){return new Promise((s,e)=>{const i=new FileReader;i.onload=({target:a})=>{const o=new Image;o.onload=()=>{const r=document.createElement("canvas"),n=r.getContext("2d"),l=o.width,c=o.height,u=500,h=500;let g=l,v=c;(l>u||c>h)&&(l/c>u/h?(g=u,v=Math.round(u*(c/l))):(v=h,g=Math.round(h*(l/c)))),r.width=g,r.height=v,n.clearRect(0,0,g,v),n.drawImage(o,0,0,g,v),s({type:"img",thumb:r.toDataURL("image/webp",.92),width:r.width,height:r.height})},o.onerror=()=>{e()},o.src=a.result},i.onerror=()=>{e()},i.readAsDataURL(t)})}}},at={};var Da=d(La,Ca,ba,!1,xa,null,null,null);function xa(t){for(let s in at)this[s]=at[s]}var Sa=function(){return Da.exports}(),Ia=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"dialog-group-info"},[e("div",{staticClass:"group-info-title"},[t._v(t._s(t.$L("\u7FA4\u540D")))]),e("div",{staticClass:"group-info-value"},[e("QuickEdit",{attrs:{value:t.dialogData.name,disabled:t.dialogData.owner_id!=t.userId},on:{"on-update":t.updateName}},[t._v(t._s(t.dialogData.name))])],1),e("div",{staticClass:"group-info-title"},[t._v(t._s(t.$L("\u7FA4\u7C7B\u578B")))]),e("div",{staticClass:"group-info-value"},[t._v(t._s(t.$L(t.groupType)))]),e("div",{staticClass:"group-info-search"},[e("Input",{attrs:{prefix:"ios-search",placeholder:t.$L("\u641C\u7D22\u6210\u5458"),clearable:""},model:{value:t.searchKey,callback:function(i){t.searchKey=i},expression:"searchKey"}})],1),e("div",{staticClass:"group-info-user"},[e("ul",[t._l(t.userList,function(i,a){return e("li",{key:a,on:{click:function(o){return t.openUser(i.userid)}}},[e("UserAvatar",{attrs:{userid:i.userid,size:32,showName:""}}),i.userid===t.dialogData.owner_id?e("div",{staticClass:"user-tag"},[t._v(t._s(t.$L("\u7FA4\u4E3B")))]):t.operableExit(i)?e("div",{staticClass:"user-exit",on:{click:function(o){return o.stopPropagation(),t.onExit(i)}}},[e("Icon",{attrs:{type:"md-exit"}})],1):t._e()],1)}),t.userList.length===0?e("li",{staticClass:"no"},[t.loadIng>0?e("Loading"):e("span",[t._v(t._s(t.$L("\u6CA1\u6709\u7B26\u5408\u6761\u4EF6\u7684\u6570\u636E")))])],1):t._e()],2)]),t.operableAdd?e("div",{staticClass:"group-info-button"},[t.dialogData.owner_id==t.userId||t.dialogData.owner_id==0?e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.openAdd}},[t._v(t._s(t.$L("\u6DFB\u52A0\u6210\u5458")))]):t._e()],1):t._e(),e("Modal",{attrs:{title:t.$L("\u6DFB\u52A0\u7FA4\u6210\u5458"),"mask-closable":!1},model:{value:t.addShow,callback:function(i){t.addShow=i},expression:"addShow"}},[e("Form",t._b({attrs:{model:t.addData},nativeOn:{submit:function(i){i.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{prop:"userids",label:t.$L("\u65B0\u589E\u6210\u5458")}},[e("UserSelect",{attrs:{disabledChoice:t.addData.disabledChoice,"multiple-max":100,"show-bot":"",title:t.$L("\u9009\u62E9\u6210\u5458")},model:{value:t.addData.userids,callback:function(i){t.$set(t.addData,"userids",i)},expression:"addData.userids"}}),t.dialogData.group_type==="department"?e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6B64\u64CD\u4F5C\u4EC5\u52A0\u5165\u7FA4\u6210\u5458\u5E76\u4E0D\u4F1A\u52A0\u5165\u90E8\u95E8")))]):t.dialogData.group_type==="project"?e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6B64\u64CD\u4F5C\u4EC5\u52A0\u5165\u7FA4\u6210\u5458\u5E76\u4E0D\u4F1A\u52A0\u5165\u9879\u76EE")))]):t.dialogData.group_type==="task"?e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6B64\u64CD\u4F5C\u4EC5\u52A0\u5165\u7FA4\u6210\u5458\u5E76\u4E0D\u4F1A\u52A0\u5165\u4EFB\u52A1\u8D1F\u8D23\u4EBA")))]):t._e()],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.addShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.addLoad>0},on:{click:t.onAdd}},[t._v(t._s(t.$L("\u786E\u5B9A\u6DFB\u52A0")))])],1)],1)],1)},Ma=[];const Ta={name:"DialogGroupInfo",components:{UserSelect:vt},props:{dialogId:{type:Number,default:0}},data(){return{searchKey:"",loadIng:0,dialogUser:[],addShow:!1,addData:{},addLoad:0,openIng:!1}},computed:{...m(["cacheDialogs","cacheUserBasic","userIsAdmin","formOptions"]),dialogData(){return this.cacheDialogs.find(({id:t})=>t==this.dialogId)||{}},groupType(){const{group_type:t}=this.dialogData;return t==="department"?"\u90E8\u95E8\u7FA4\u7EC4":t==="project"?"\u9879\u76EE\u7FA4\u7EC4":t==="task"?"\u4EFB\u52A1\u7FA4\u7EC4":t==="user"?"\u4E2A\u4EBA\u7FA4\u7EC4":t==="all"?"\u5168\u5458\u7FA4\u7EC4":t==="okr"?"OKR\u7FA4\u7EC4":"\u672A\u77E5"},userList(){const{dialogUser:t,searchKey:s,cacheUserBasic:e,dialogData:i}=this;return t.map(o=>{const r=e.find(n=>n.userid==o.userid);return r&&(o.nickname=r.nickname,o.email=r.email),o}).filter(o=>!(s&&o.nickname&&!$A.strExists(o.nickname,s)&&!$A.strExists(o.email,s))).sort((o,r)=>o.userid===i.owner_id||r.userid===i.owner_id?(o.userid===i.owner_id?0:1)-(r.userid===i.owner_id?0:1):$A.dayjs(o.created_at)-$A.dayjs(r.created_at))}},watch:{dialogId:{handler(){this.getDialogUser()},immediate:!0}},methods:{updateName(t,s){if(!t){s();return}this.$store.dispatch("call",{url:"dialog/group/edit",data:{dialog_id:this.dialogId,chat_name:t}}).then(({data:e})=>{this.$store.dispatch("saveDialog",e),s()}).catch(({msg:e})=>{$A.modalError(e),s()})},getDialogUser(){this.dialogId<=0||(this.loadIng++,this.$store.dispatch("call",{url:"dialog/user",data:{dialog_id:this.dialogId}}).then(({data:t})=>{this.dialogUser=t,this.$store.dispatch("saveDialog",{id:this.dialogId,people:t.length})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))},operableAdd(){const{owner_id:t,group_type:s}=this.dialogData;return s=="all"?this.userIsAdmin:[0,this.userId].includes(t)},openAdd(){this.addData={dialog_id:this.dialogId,userids:[],disabledChoice:this.dialogUser.map(t=>t.userid)},this.addShow=!0},onAdd(){this.addLoad++,this.$store.dispatch("call",{url:"dialog/group/adduser",data:this.addData}).then(({msg:t})=>{$A.messageSuccess(t),this.addShow=!1,this.addData={},this.getDialogUser()}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.addLoad--})},operableExit(t){const{owner_id:s,group_type:e}=this.dialogData;return e=="all"?this.userIsAdmin:s==this.userId||t.inviter==this.userId},onExit(t){let s="\u4F60\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u5417\uFF1F",e=[];$A.isJson(t)&&t.userid!=this.userId&&(s=`\u4F60\u786E\u5B9A\u8981\u5C06\u3010${t.nickname}\u3011\u79FB\u51FA\u7FA4\u7EC4\u5417\uFF1F`,e=[t.userid]),$A.modalConfirm({content:s,loading:!0,onOk:()=>new Promise((i,a)=>{this.$store.dispatch("call",{url:"dialog/group/deluser",data:{dialog_id:this.dialogId,userids:e}}).then(({msg:o})=>{i(o),e.length>0?this.getDialogUser():(this.$store.dispatch("forgetDialog",this.dialogId),this.goForward({name:"manage-messenger"}))}).catch(({msg:o})=>{a(o)})})})},openUser(t){this.openIng||(this.openIng=!0,this.$store.dispatch("openDialogUserid",t).then(s=>{this.$emit("on-close")}).catch(({msg:s})=>{$A.modalError(s)}).finally(s=>{this.openIng=!1}))}}},ot={};var Aa=d(Ta,Ia,Ma,!1,Ea,null,null,null);function Ea(t){for(let s in ot)this[s]=ot[s]}var ja=function(){return Aa.exports}(),Fa=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"dialog-respond"},[e("div",{staticClass:"respond-title"},[e("em",{staticClass:"no-dark-content"},[t._v(t._s(t.respondData.symbol))]),t._v(t._s(t.$L("\u56DE\u5E94\u8BE6\u60C5"))+" ("+t._s(t.respondData.userids.length)+")")]),e("div",{staticClass:"respond-user"},[e("ul",t._l(t.respondData.userids,function(i,a){return e("li",{key:a,on:{click:function(o){return t.openUser(i)}}},[e("UserAvatar",{attrs:{userid:i,size:32,showName:""}})],1)}),0)])])},Ra=[];const Oa={name:"DialogRespond",props:{respondData:{type:Object,default:()=>({})}},data(){return{openIng:!1}},methods:{openUser(t){this.openIng||(this.openIng=!0,this.$store.dispatch("openDialogUserid",t).then(s=>{this.$emit("on-close")}).catch(({msg:s})=>{$A.modalError(s)}).finally(s=>{this.openIng=!1}))}}},rt={};var Va=d(Oa,Fa,Ra,!1,Ba,null,null,null);function Ba(t){for(let s in rt)this[s]=rt[s]}var Pa=function(){return Va.exports}(),qa=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"chat-emoji-wrapper"},[e("div",{staticClass:"chat-emoji-box"},[t.type==="emosearch"?e("div",{staticClass:"chat-emoji-emosearch"},[e("Input",{attrs:{clearable:"",placeholder:t.$L("\u641C\u7D22\u8868\u60C5")},model:{value:t.emosearchKey,callback:function(i){t.emosearchKey=i},expression:"emosearchKey"}},[e("Icon",{class:{"icon-loading":t.emosearchLoad},attrs:{slot:"prefix",type:t.emosearchLoad?"ios-loading":"ios-search"},slot:"prefix"})],1)],1):t.type==="emoji"?e("div",{staticClass:"chat-emoji-nav"},t._l(t.emojiNavList,function(i){var a;return e("div",{key:i.type,class:(a={},a[`i-${i.name}`]=!0,a.active=i.type===t.emojiNavActive,a),domProps:{innerHTML:t._s(i.content)},on:{click:function(o){t.emojiNavActive=i.type}}})}),0):t._e(),e("Scrollbar",[e("ul",{class:[t.type,"no-dark-content"]},t._l(t.list,function(i){return e("li",{on:{click:function(a){return t.onSelect(a,i)}}},[i.type==="emoticon"?e("img",{attrs:{src:i.src,title:i.name,alt:i.name}}):e("span",{attrs:{title:i.name},domProps:{innerHTML:t._s(i.html)}})])}),0)])],1),t.onlyEmoji?t._e():e("ul",{ref:"chatEmojiMenuRef",staticClass:"chat-emoji-menu",style:t.chatEmojiMenuStyle,on:{scroll:t.onHandleScroll}},[t.showEmojiMenuScrollLeftBtn?e("li",{staticClass:"left-btn",on:{click:function(i){return t.onEmojiMenuScroll("left")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE72D")])]):t._e(),e("li",{class:{active:t.type==="emosearch"},on:{click:function(i){t.type="emosearch"}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F8")])]),e("li",{class:{active:t.type==="emoji"},on:{click:function(i){t.type="emoji"}}},[e("span",{staticClass:"no-dark-content"},[t._v("\u{1F600}")])]),t._l(t.emoticonData,function(i){return e("li",{class:{active:t.type==="emoticon"&&t.emoticonPath==i.path},on:{click:function(a){return t.onEmoticon(i.path)}}},[e("img",{attrs:{title:i.name,alt:i.name,src:i.src}})])}),t.showEmojiMenuScrollRightBtn?e("li",{staticClass:"right-btn",on:{click:function(i){return t.onEmojiMenuScroll("right")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE733")])]):t._e()],2)])},Ua=[];const Na={name:"ChatEmoji",props:{searchKey:{type:String,default:""},onlyEmoji:{type:Boolean,default:!1}},data(){return{type:"emoji",emojiNavActive:"p",emojiNavList:[{type:"p",name:"people",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM256 432C332.1 432 396.2 382 415.2 314.1C419.1 300.4 407.8 288 393.6 288H118.4C104.2 288 92.92 300.4 96.76 314.1C115.8 382 179.9 432 256 432V432zM176.4 160C158.7 160 144.4 174.3 144.4 192C144.4 209.7 158.7 224 176.4 224C194 224 208.4 209.7 208.4 192C208.4 174.3 194 160 176.4 160zM336.4 224C354 224 368.4 209.7 368.4 192C368.4 174.3 354 160 336.4 160C318.7 160 304.4 174.3 304.4 192C304.4 209.7 318.7 224 336.4 224z" /></svg>'},{type:"n",name:"nature",content:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M332.7 19.85C334.6 8.395 344.5 0 356.1 0C363.6 0 370.6 3.52 375.1 9.502L392 32H444.1C456.8 32 469.1 37.06 478.1 46.06L496 64H552C565.3 64 576 74.75 576 88V112C576 156.2 540.2 192 496 192H426.7L421.6 222.5L309.6 158.5L332.7 19.85zM448 64C439.2 64 432 71.16 432 80C432 88.84 439.2 96 448 96C456.8 96 464 88.84 464 80C464 71.16 456.8 64 448 64zM416 256.1V480C416 497.7 401.7 512 384 512H352C334.3 512 320 497.7 320 480V364.8C295.1 377.1 268.8 384 240 384C211.2 384 184 377.1 160 364.8V480C160 497.7 145.7 512 128 512H96C78.33 512 64 497.7 64 480V249.8C35.23 238.9 12.64 214.5 4.836 183.3L.9558 167.8C-3.331 150.6 7.094 133.2 24.24 128.1C41.38 124.7 58.76 135.1 63.05 152.2L66.93 167.8C70.49 182 83.29 191.1 97.97 191.1H303.8L416 256.1z" /></svg>
`},{type:"d",name:"food",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M481.9 270.1C490.9 279.1 496 291.3 496 304C496 316.7 490.9 328.9 481.9 337.9C472.9 346.9 460.7 352 448 352H64C51.27 352 39.06 346.9 30.06 337.9C21.06 328.9 16 316.7 16 304C16 291.3 21.06 279.1 30.06 270.1C39.06 261.1 51.27 256 64 256H448C460.7 256 472.9 261.1 481.9 270.1zM475.3 388.7C478.3 391.7 480 395.8 480 400V416C480 432.1 473.3 449.3 461.3 461.3C449.3 473.3 432.1 480 416 480H96C79.03 480 62.75 473.3 50.75 461.3C38.74 449.3 32 432.1 32 416V400C32 395.8 33.69 391.7 36.69 388.7C39.69 385.7 43.76 384 48 384H464C468.2 384 472.3 385.7 475.3 388.7zM50.39 220.8C45.93 218.6 42.03 215.5 38.97 211.6C35.91 207.7 33.79 203.2 32.75 198.4C31.71 193.5 31.8 188.5 32.99 183.7C54.98 97.02 146.5 32 256 32C365.5 32 457 97.02 479 183.7C480.2 188.5 480.3 193.5 479.2 198.4C478.2 203.2 476.1 207.7 473 211.6C469.1 215.5 466.1 218.6 461.6 220.8C457.2 222.9 452.3 224 447.3 224H64.67C59.73 224 54.84 222.9 50.39 220.8zM372.7 116.7C369.7 119.7 368 123.8 368 128C368 131.2 368.9 134.3 370.7 136.9C372.5 139.5 374.1 141.6 377.9 142.8C380.8 143.1 384 144.3 387.1 143.7C390.2 143.1 393.1 141.6 395.3 139.3C397.6 137.1 399.1 134.2 399.7 131.1C400.3 128 399.1 124.8 398.8 121.9C397.6 118.1 395.5 116.5 392.9 114.7C390.3 112.9 387.2 111.1 384 111.1C379.8 111.1 375.7 113.7 372.7 116.7V116.7zM244.7 84.69C241.7 87.69 240 91.76 240 96C240 99.16 240.9 102.3 242.7 104.9C244.5 107.5 246.1 109.6 249.9 110.8C252.8 111.1 256 112.3 259.1 111.7C262.2 111.1 265.1 109.6 267.3 107.3C269.6 105.1 271.1 102.2 271.7 99.12C272.3 96.02 271.1 92.8 270.8 89.88C269.6 86.95 267.5 84.45 264.9 82.7C262.3 80.94 259.2 79.1 256 79.1C251.8 79.1 247.7 81.69 244.7 84.69V84.69zM116.7 116.7C113.7 119.7 112 123.8 112 128C112 131.2 112.9 134.3 114.7 136.9C116.5 139.5 118.1 141.6 121.9 142.8C124.8 143.1 128 144.3 131.1 143.7C134.2 143.1 137.1 141.6 139.3 139.3C141.6 137.1 143.1 134.2 143.7 131.1C144.3 128 143.1 124.8 142.8 121.9C141.6 118.1 139.5 116.5 136.9 114.7C134.3 112.9 131.2 111.1 128 111.1C123.8 111.1 119.7 113.7 116.7 116.7L116.7 116.7z" /></svg>'},{type:"s",name:"symbols",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M500.3 7.251C507.7 13.33 512 22.41 512 31.1V175.1C512 202.5 483.3 223.1 447.1 223.1C412.7 223.1 383.1 202.5 383.1 175.1C383.1 149.5 412.7 127.1 447.1 127.1V71.03L351.1 90.23V207.1C351.1 234.5 323.3 255.1 287.1 255.1C252.7 255.1 223.1 234.5 223.1 207.1C223.1 181.5 252.7 159.1 287.1 159.1V63.1C287.1 48.74 298.8 35.61 313.7 32.62L473.7 .6198C483.1-1.261 492.9 1.173 500.3 7.251H500.3zM74.66 303.1L86.5 286.2C92.43 277.3 102.4 271.1 113.1 271.1H174.9C185.6 271.1 195.6 277.3 201.5 286.2L213.3 303.1H239.1C266.5 303.1 287.1 325.5 287.1 351.1V463.1C287.1 490.5 266.5 511.1 239.1 511.1H47.1C21.49 511.1-.0019 490.5-.0019 463.1V351.1C-.0019 325.5 21.49 303.1 47.1 303.1H74.66zM143.1 359.1C117.5 359.1 95.1 381.5 95.1 407.1C95.1 434.5 117.5 455.1 143.1 455.1C170.5 455.1 191.1 434.5 191.1 407.1C191.1 381.5 170.5 359.1 143.1 359.1zM440.3 367.1H496C502.7 367.1 508.6 372.1 510.1 378.4C513.3 384.6 511.6 391.7 506.5 396L378.5 508C372.9 512.1 364.6 513.3 358.6 508.9C352.6 504.6 350.3 496.6 353.3 489.7L391.7 399.1H336C329.3 399.1 323.4 395.9 321 389.6C318.7 383.4 320.4 376.3 325.5 371.1L453.5 259.1C459.1 255 467.4 254.7 473.4 259.1C479.4 263.4 481.6 271.4 478.7 278.3L440.3 367.1zM116.7 219.1L19.85 119.2C-8.112 90.26-6.614 42.31 24.85 15.34C51.82-8.137 93.26-3.642 118.2 21.83L128.2 32.32L137.7 21.83C162.7-3.642 203.6-8.137 231.6 15.34C262.6 42.31 264.1 90.26 236.1 119.2L139.7 219.1C133.2 225.6 122.7 225.6 116.7 219.1H116.7z" /></svg>'},{type:"a",name:"activity",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M16.17 337.5c0 44.98 7.565 83.54 13.98 107.9C35.22 464.3 50.46 496 174.9 496c9.566 0 19.59-.4707 29.84-1.271L17.33 307.3C16.53 317.6 16.17 327.7 16.17 337.5zM495.8 174.5c0-44.98-7.565-83.53-13.98-107.9c-4.688-17.54-18.34-31.23-36.04-35.95C435.5 27.91 392.9 16 337 16c-9.564 0-19.59 .4707-29.84 1.271l187.5 187.5C495.5 194.4 495.8 184.3 495.8 174.5zM26.77 248.8l236.3 236.3c142-36.1 203.9-150.4 222.2-221.1L248.9 26.87C106.9 62.96 45.07 177.2 26.77 248.8zM256 335.1c0 9.141-7.474 16-16 16c-4.094 0-8.188-1.564-11.31-4.689L164.7 283.3C161.6 280.2 160 276.1 160 271.1c0-8.529 6.865-16 16-16c4.095 0 8.189 1.562 11.31 4.688l64.01 64C254.4 327.8 256 331.9 256 335.1zM304 287.1c0 9.141-7.474 16-16 16c-4.094 0-8.188-1.564-11.31-4.689L212.7 235.3C209.6 232.2 208 228.1 208 223.1c0-9.141 7.473-16 16-16c4.094 0 8.188 1.562 11.31 4.688l64.01 64.01C302.5 279.8 304 283.9 304 287.1zM256 175.1c0-9.141 7.473-16 16-16c4.094 0 8.188 1.562 11.31 4.688l64.01 64.01c3.125 3.125 4.688 7.219 4.688 11.31c0 9.133-7.468 16-16 16c-4.094 0-8.189-1.562-11.31-4.688l-64.01-64.01C257.6 184.2 256 180.1 256 175.1z" /></svg>'},{type:"t",name:"travel",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M39.61 196.8L74.8 96.29C88.27 57.78 124.6 32 165.4 32H346.6C387.4 32 423.7 57.78 437.2 96.29L472.4 196.8C495.6 206.4 512 229.3 512 256V448C512 465.7 497.7 480 480 480H448C430.3 480 416 465.7 416 448V400H96V448C96 465.7 81.67 480 64 480H32C14.33 480 0 465.7 0 448V256C0 229.3 16.36 206.4 39.61 196.8V196.8zM109.1 192H402.9L376.8 117.4C372.3 104.6 360.2 96 346.6 96H165.4C151.8 96 139.7 104.6 135.2 117.4L109.1 192zM96 256C78.33 256 64 270.3 64 288C64 305.7 78.33 320 96 320C113.7 320 128 305.7 128 288C128 270.3 113.7 256 96 256zM416 320C433.7 320 448 305.7 448 288C448 270.3 433.7 256 416 256C398.3 256 384 270.3 384 288C384 305.7 398.3 320 416 320z" /></svg>'},{type:"o",name:"objects",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438 0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1h-160L112.1 454.3zM191.4 .0132C89.44 .3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8c16.53 18.84 42.34 58.23 52.22 91.45c.0313 .25 .0938 .5166 .125 .7823h160.2c.0313-.2656 .0938-.5166 .125-.7823c9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1C368 78.61 288.9-.2837 191.4 .0132zM192 96.01c-44.13 0-80 35.89-80 79.1C112 184.8 104.8 192 96 192S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1c8.844 0 16 7.159 16 16S200.8 96.01 192 96.01z" /></svg>'},{type:"f",name:"flags",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 496C64 504.8 56.75 512 48 512h-32C7.25 512 0 504.8 0 496V32c0-17.75 14.25-32 32-32s32 14.25 32 32V496zM476.3 0c-6.365 0-13.01 1.35-19.34 4.233c-45.69 20.86-79.56 27.94-107.8 27.94c-59.96 0-94.81-31.86-163.9-31.87C160.9 .3055 131.6 4.867 96 15.75v350.5c32-9.984 59.87-14.1 84.85-14.1c73.63 0 124.9 31.78 198.6 31.78c31.91 0 68.02-5.971 111.1-23.09C504.1 355.9 512 344.4 512 332.1V30.73C512 11.1 495.3 0 476.3 0z" /></svg>'}],emoticonPath:"",emosearchKey:"",emosearchCache:null,emosearchLoad:!1,emosearchTimer:null,emosearchList:[],emojiData:[],emoticonData:[],emojiMenuScrollLeft:0}},mounted(){var t;this.initData(),(t=this.$store)!=null&&t.state.windowPortrait||this.onMonitorWheel()},watch:{type(){this.onEmosearch()},emosearchKey(){this.onEmosearch()},searchKey:{handler(t){this.emosearchKey=t},immediate:!0}},computed:{list(){if(this.type==="emoji")return this.emojiData.filter(t=>t.category===this.emojiNavActive);if(this.type==="emosearch")return this.emosearchList;if(this.type==="emoticon"){const t=this.emoticonData.find(({path:s})=>s===this.emoticonPath);if(t)return t.list}return[]},chatEmojiMenuStyle(){return{paddingLeft:this.showEmojiMenuScrollLeftBtn?"34px":0,paddingRight:this.showEmojiMenuScrollRightBtn?"34px":0}},showEmojiMenuScrollLeftBtn(){return this.emojiMenuScrollLeft>34},showEmojiMenuScrollRightBtn(){var e;const t=this.$refs.chatEmojiMenuRef,s=((e=t==null?void 0:t.querySelector("li"))==null?void 0:e.offsetWidth)||48;return this.emojiMenuScrollLeft<this.emoticonData.length*s-(this.$store.state.windowPortrait?34:0)}},methods:{initData(){$A.loadScriptS(["js/emoji.all.js","js/emoticon.all.js"]).then(t=>{const s=$A.mainUrl("images/emoticon");$A.isArray(window.emojiData)&&(this.emojiData=window.emojiData.sort(function(e,i){return e.emoji_order-i.emoji_order}).map(e=>({type:"emoji",name:e.name,category:e.category,html:e.code_decimal}))),$A.isArray(window.emoticonData)&&(this.emoticonData=window.emoticonData.map(e=>Object.assign(e,{src:`${s}/${e.path}/${e.icon}`,list:e.list.map(i=>Object.assign(i,{type:"emoticon",asset:`images/emoticon/${e.path}/${i.path}`,src:`${s}/${e.path}/${i.path}`}))})))})},onEmosearch(){this.type!=="emosearch"||this.emosearchCache===this.emosearchKey||(this.emosearchCache=this.emosearchKey,this.emosearchLoad=!0,this.emosearchTimer&&clearTimeout(this.emosearchTimer),this.emosearchTimer=setTimeout(t=>{this.$store.dispatch("call",{url:"dialog/sticker/search",data:{key:this.emosearchKey}}).then(({data:s})=>{this.emosearchList=[];const e=s.list;e.length>0&&(this.emosearchList=e.map(i=>({type:"emoticon",asset:"emosearch",name:i.name,src:i.src,height:i.height,width:i.width}))),this.emosearchList.length===0&&$A.messageWarning("\u6CA1\u6709\u641C\u7D22\u5230\u4EFB\u4F55\u8868\u60C5")}).catch(s=>{this.emosearchList=[],$A.messageWarning("\u641C\u7D22\u7ED3\u679C\u4E3A\u7A7A")}).finally(s=>{this.emosearchLoad=!1})},300))},onEmoticon(t){this.type="emoticon",this.emoticonPath=t},onSelect(t,s){s.type==="emoji"?this.$emit("on-select",{type:"emoji",text:t.target.innerText}):this.$emit("on-select",s)},onMonitorWheel(){const t=this.$refs.chatEmojiMenuRef;t==null||t.addEventListener("wheel",s=>{s.preventDefault(),t.scrollLeft=t.scrollLeft+s.deltaY})},onEmojiMenuScroll(t){const s=this.$refs.chatEmojiMenuRef,e=s.offsetWidth-68,i=t=="right"?s.scrollLeft+e:s.scrollLeft-e;s.scrollTo({left:i,behavior:"smooth"})},onHandleScroll(t){this.emojiMenuScrollLeft=t.target.scrollLeft}}},nt={};var za=d(Na,qa,Ua,!1,Wa,null,null,null);function Wa(t){for(let s in nt)this[s]=nt[s]}var wt=function(){return za.exports}();const lt="ontouchend"in document;var Ha={bind(t,s){let e=!1;t.__touchEvent__={start:i=>{i.preventDefault(),e=!0,s.value("down",i)},move:i=>{e&&s.value("move",i)},end:i=>{e&&(e=!1,s.value("up"))},click:i=>{s.value("click",i)}},lt?(t.addEventListener("touchstart",t.__touchEvent__.start),t.addEventListener("touchmove",t.__touchEvent__.move),t.addEventListener("touchend",t.__touchEvent__.end)):(t.addEventListener("mousedown",t.__touchEvent__.start,{passive:!1}),document.addEventListener("mousemove",t.__touchEvent__.move),document.addEventListener("mouseup",t.__touchEvent__.end)),t.addEventListener("click",t.__touchEvent__.click)},update(){},unbind(t){lt?(t.removeEventListener("touchstart",t.__touchEvent__.start),t.removeEventListener("touchmove",t.__touchEvent__.move),t.removeEventListener("touchend",t.__touchEvent__.end)):(t.removeEventListener("mousedown",t.__touchEvent__.start),document.removeEventListener("mousemove",t.__touchEvent__.move),document.removeEventListener("mouseup",t.__touchEvent__.end)),t.removeEventListener("click",t.__touchEvent__.click),delete t.__touchEvent__}};const ct="ontouchend"in document;var kt={bind(t,s){if(ct){const e={move:!1,time:0,x:0,y:0};t.__touchEvent__={start:i=>{i.preventDefault(),e.move=!1,e.time=$A.dayjs().valueOf(),e.x=i.touches?i.touches[0].clientX:i.clientX,e.y=i.touches?i.touches[0].clientY:i.clientY},move:i=>{if(e.time>0){const a=i.touches?i.touches[0].clientX:i.clientX,o=i.touches?i.touches[0].clientY:i.clientY;(Math.abs(a-e.x)>5||Math.abs(o-e.y)>5)&&(e.move=!0)}},end:i=>{e.time>0&&(!e.move&&$A.dayjs().valueOf()-e.time<300&&s.value(),e.time=0)}},t.addEventListener("touchstart",t.__touchEvent__.start),t.addEventListener("touchmove",t.__touchEvent__.move),t.addEventListener("touchend",t.__touchEvent__.end)}else t.__clickEvent__=e=>{e.preventDefault(),s.value()},t.addEventListener("click",t.__clickEvent__)},update(){},unbind(t){ct?(t.removeEventListener("touchstart",t.__touchEvent__.start),t.removeEventListener("touchmove",t.__touchEvent__.move),t.removeEventListener("touchend",t.__touchEvent__.end),delete t.__touchEvent__):(t.removeEventListener("click",t.__clickEvent__),delete t.__clickEvent__)}};function f(t){return t===void 0&&(t=document.body),t===!0?document.body:t instanceof window.Node?t:document.querySelector(t)}const Qa={inserted(t,{value:s},e){if(t.dataset&&t.dataset.transfer!=="true")return!1;t.className=t.className?t.className+" v-transfer-dom":"v-transfer-dom";const i=t.parentNode;if(!i)return;const a=document.createComment("");let o=!1;s!==!1&&(i.replaceChild(a,t),f(s).appendChild(t),o=!0),t.__transferDomData||(t.__transferDomData={parentNode:i,home:a,target:f(s),hasMovedOut:o})},componentUpdated(t,{value:s}){if(t.dataset&&t.dataset.transfer!=="true")return!1;const e=t.__transferDomData;if(!e)return;const i=e.parentNode,a=e.home,o=e.hasMovedOut;!o&&s?(i.replaceChild(a,t),f(s).appendChild(t),t.__transferDomData=Object.assign({},t.__transferDomData,{hasMovedOut:!0,target:f(s)})):o&&s===!1?(i.replaceChild(t,a),t.__transferDomData=Object.assign({},t.__transferDomData,{hasMovedOut:!1,target:f(s)})):s&&f(s).appendChild(t)},unbind(t){if(t.dataset&&t.dataset.transfer!=="true")return!1;t.className=t.className.replace("v-transfer-dom",""),t.__transferDomData&&(t.__transferDomData.hasMovedOut===!0&&t.__transferDomData.parentNode&&t.__transferDomData.parentNode.appendChild(t),t.__transferDomData=null)}},p={};function dt(t,s){!t||typeof p[t]=="undefined"?p[t]=[]:p[t]=p[t].filter(e=>e!==s),p[t].push(s)}function ut(t,s){!t||typeof p[t]=="undefined"||(p[t]=p[t].filter(e=>e!==s))}function Ga(t,s){return typeof p[t]=="undefined"?!1:p[t][p[t].length-1]===s}function Ka(){return new Promise(t=>{const s=new xt({render(a){return a(St.exports.Modal,{class:"chat-emoji-one-modal",props:{fullscreen:!0,footerHide:!0},on:{"on-visible-change":o=>{o||setTimeout(r=>{document.body.removeChild(this.$el)},500)}}},[a(wt,{attrs:{onlyEmoji:!0},on:{"on-select":o=>{this.$children[0].visible=!1,o.type==="emoji"&&t(o.text)}}})])}}),e=s.$mount();document.body.appendChild(e.$el);const i=s.$children[0];i.visible=!0,i.$el.lastChild.addEventListener("click",({target:a})=>{a.classList.contains("ivu-modal-body")&&(i.visible=!1)})})}var Ja=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.hidePopover,expression:"hidePopover"}],staticClass:"chat-input-box",class:t.boxClass},[e("div",{staticClass:"chat-input-quick-emoji"},[e("EPopover",{ref:"emojiQuickRef",attrs:{visibleArrow:!1,transition:"",placement:"top-end",popperClass:"chat-quick-emoji-popover"},model:{value:t.emojiQuickShow,callback:function(i){t.emojiQuickShow=i},expression:"emojiQuickShow"}},[e("div",{attrs:{slot:"reference"},slot:"reference"}),e("Scrollbar",{ref:"emojiWrapper",attrs:{tag:"ul","enable-x":!0,"enable-y":!1,"touch-content-blur":!1,"class-name":"chat-quick-emoji-wrapper scrollbar-hidden"}},t._l(t.emojiQuickItems,function(i){return e("li",{on:{click:function(a){return t.onEmojiQuick(i)}}},[e("img",{attrs:{title:i.name,alt:i.name,src:i.src}})])}),0)],1)],1),e("div",{ref:"inputWrapper",staticClass:"chat-input-wrapper",on:{click:function(i){return i.stopPropagation(),t.focus.apply(null,arguments)}}},[t.quoteData?e("div",{staticClass:"chat-quote"},[t.quoteUpdate?e("div",{staticClass:"quote-label"},[t._v(t._s(t.$L("\u7F16\u8F91\u6D88\u606F")))]):e("UserAvatar",{attrs:{userid:t.quoteData.userid,userResult:t.onQuoteUserResult,"show-icon":!1,"show-name":!0}}),e("div",{staticClass:"quote-desc no-dark-content"},[t._v(t._s(t.$A.getMsgSimpleDesc(t.quoteData)))]),e("i",{directives:[{name:"touchclick",rawName:"v-touchclick",value:t.cancelQuote,expression:"cancelQuote"}],staticClass:"taskfont"},[t._v("\uE6E5")])],1):t._e(),e("div",{ref:"editor",staticClass:"no-dark-content",on:{click:function(i){return i.stopPropagation(),t.onClickEditor.apply(null,arguments)},paste:t.handlePaste}}),e("div",{staticClass:"chat-space"},[e("input",{staticClass:"space-input",on:{focus:t.onSpaceInputFocus}})]),e("ul",{staticClass:"chat-toolbar",on:{click:function(i){i.stopPropagation()}}},[e("li",[t.emojiBottom?e("ETooltip",{ref:"emojiTip",attrs:{disabled:t.$isEEUiApp||t.windowTouch||t.showEmoji,placement:"top",enterable:!1,content:t.$L("\u8868\u60C5")}},[e("i",{staticClass:"taskfont",on:{click:function(i){t.showEmoji=!t.showEmoji}}},[t._v("\uE7AD")])]):e("EPopover",{ref:"emoji",attrs:{visibleArrow:!1,placement:"top",popperClass:"chat-input-emoji-popover"},model:{value:t.showEmoji,callback:function(i){t.showEmoji=i},expression:"showEmoji"}},[e("ETooltip",{ref:"emojiTip",attrs:{slot:"reference",disabled:t.$isEEUiApp||t.windowTouch||t.showEmoji,placement:"top",enterable:!1,content:t.$L("\u8868\u60C5")},slot:"reference"},[e("i",{staticClass:"taskfont"},[t._v("\uE7AD")])]),t.showEmoji?e("ChatEmoji",{attrs:{searchKey:t.emojiQuickKey},on:{"on-select":t.onSelectEmoji}}):t._e()],1)],1),e("li",[e("ETooltip",{attrs:{placement:"top",disabled:t.$isEEUiApp||t.windowTouch,enterable:!1,content:t.$L("\u9009\u62E9\u6210\u5458")}},[e("i",{staticClass:"taskfont",on:{click:function(i){return t.onToolbar("user")}}},[t._v("\uE78F")])])],1),e("li",[e("ETooltip",{attrs:{placement:"top",disabled:t.$isEEUiApp||t.windowTouch,enterable:!1,content:t.$L("\u9009\u62E9\u4EFB\u52A1")}},[e("i",{staticClass:"taskfont",on:{click:function(i){return t.onToolbar("task")}}},[t._v("\uE7D6")])])],1),e("li",[e("EPopover",{ref:"more",attrs:{visibleArrow:!1,placement:"top",popperClass:"chat-input-more-popover"},model:{value:t.showMore,callback:function(i){t.showMore=i},expression:"showMore"}},[e("ETooltip",{ref:"moreTip",attrs:{slot:"reference",disabled:t.$isEEUiApp||t.windowTouch||t.showMore,placement:"top",enterable:!1,content:t.$L("\u5C55\u5F00")},slot:"reference"},[e("i",{staticClass:"taskfont"},[t._v("\uE790")])]),t.recordReady?e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("meeting")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7C1")]),t._v(" "+t._s(t.$L("\u65B0\u4F1A\u8BAE"))+" ")]):t._e(),t.canCall?e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("call")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7BA")]),t._v(" "+t._s(t.$L("\u62E8\u6253\u7535\u8BDD"))+" ")]):t._e(),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("image")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7BC")]),t._v(" "+t._s(t.$L("\u53D1\u9001\u56FE\u7247"))+" ")]),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("file")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7C0")]),t._v(" "+t._s(t.$L("\u4E0A\u4F20\u6587\u4EF6"))+" ")]),t.canAnon?e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("anon")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE690")]),t._v(" "+t._s(t.$L("\u533F\u540D\u6D88\u606F"))+" ")]):t._e(),t.dialogData.type=="group"?e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("word-chain")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE80A")]),t._v(" "+t._s(t.$L("\u53D1\u8D77\u63A5\u9F99"))+" ")]):t._e(),t.dialogData.type=="group"?e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("vote")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7FD")]),t._v(" "+t._s(t.$L("\u53D1\u8D77\u6295\u7968"))+" ")]):t._e(),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onToolbar("full")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6A7")]),t._v(" "+t._s(t.$L("\u5168\u5C4F\u8F93\u5165"))+" ")])],1)],1),e("li",{directives:[{name:"touchmouse",rawName:"v-touchmouse",value:t.clickSend,expression:"clickSend"},{name:"longpress",rawName:"v-longpress",value:{callback:t.onShowMenu,delay:300},expression:"{callback: onShowMenu, delay: 300}"}],ref:"chatSend",staticClass:"chat-send",class:t.sendClass},[e("EPopover",{ref:"menu",attrs:{visibleArrow:!1,trigger:"manual",placement:"top",popperClass:"chat-input-more-popover"},model:{value:t.showMenu,callback:function(i){t.showMenu=i},expression:"showMenu"}},[e("ETooltip",{ref:"sendTip",attrs:{slot:"reference",placement:"top",disabled:t.$isEEUiApp||t.windowTouch||t.showMenu,enterable:!1,content:t.$L(t.sendContent)},slot:"reference"},[t.loading?e("div",[e("div",{staticClass:"chat-load"},[e("Loading")],1)]):e("div",[e("transition",{attrs:{name:"mobile-send"}},[t.sendClass==="recorder"?e("i",{staticClass:"taskfont"},[t._v("\uE609")]):t._e()]),e("transition",{attrs:{name:"mobile-send"}},[t.sendClass!=="recorder"?e("i",{staticClass:"taskfont"},[t._v("\uE606")]):t._e()])],1)]),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onSend("silence")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7D7")]),t._v(" "+t._s(t.$L("\u65E0\u58F0\u53D1\u9001"))+" ")]),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onSend("md")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE647")]),t._v(" "+t._s(t.$L("MD \u683C\u5F0F\u53D1\u9001"))+" ")]),e("div",{staticClass:"chat-input-popover-item",on:{click:function(i){return t.onSend("normal")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE71B")]),t._v(" "+t._s(t.$L("\u666E\u901A\u683C\u5F0F\u53D1\u9001"))+" ")])],1)],1)]),e("div",{staticClass:"chat-record"},[e("div",{ref:"recwave"})]),e("div",{staticClass:"chat-cover",on:{click:function(i){return i.stopPropagation(),t.onClickCover.apply(null,arguments)}}})]),t.emojiBottom&&t.showEmoji?e("ChatEmoji",{attrs:{searchKey:t.emojiQuickKey},on:{"on-select":t.onSelectEmoji}}):t._e(),e("transition",{attrs:{name:"fade"}},[["ready","ing"].includes(t.recordState)?e("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}],staticClass:"chat-input-record-transfer",class:{cancel:t.touchLimitY},style:t.recordTransferStyle,attrs:{"data-transfer":!0},on:{click:t.stopRecord}},[t.recordDuration>0?e("div",{staticClass:"record-duration"},[t._v(t._s(t.recordFormatDuration))]):e("div",{staticClass:"record-loading"},[e("Loading",{attrs:{type:"pure"}})],1),e("div",{staticClass:"record-cancel",on:{click:function(i){return i.stopPropagation(),t.stopRecord(!0)}}},[t._v(t._s(t.$L(t.touchLimitY?"\u677E\u5F00\u53D6\u6D88":"\u5411\u4E0A\u6ED1\u52A8\u53D6\u6D88")))])]):t._e()]),e("Modal",{attrs:{"mask-closable":!1,beforeClose:t.onFullBeforeClose,"class-name":"chat-input-full-input","footer-hide":"",fullscreen:""},model:{value:t.fullInput,callback:function(i){t.fullInput=i},expression:"fullInput"}},[e("div",{staticClass:"chat-input-box",style:t.chatInputBoxStyle},[e("div",{staticClass:"chat-input-wrapper"},[e("div",{ref:"editorFull",staticClass:"no-dark-content"})]),e("ul",{staticClass:"chat-input-menu",class:{activation:t.fullSelection.length>0}},t._l(t.fullTools,function(i,a){return e("li",{key:a,on:{touchstart:function(o){o.preventDefault()},touchend:function(o){return o.preventDefault(),t.onFullMenu(i.label,i.type)},click:function(o){return t.onFullMenu(i.label,i.type)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(i.icon)}})])}),0)]),e("i",{staticClass:"taskfont",attrs:{slot:"close"},slot:"close"},[t._v("\uE6AB")])])],1)},Ya=[];const Xa={name:"ChatInput",components:{ChatEmoji:wt},directives:{touchmouse:Ha,touchclick:kt,TransferDom:Qa,clickoutside:bt,longpress:y},props:{value:{type:[String,Number],default:""},dialogId:{type:Number,default:0},taskId:{type:Number,default:0},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1},disabledRecord:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},emojiBottom:{type:Boolean,default:!1},sendMenu:{type:Boolean,default:!0},simpleMode:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},toolbar:{type:Array,default:()=>["bold","strike","italic","underline","blockquote","link",{list:"ordered"},{list:"bullet"},{list:"check"}]},maxlength:{type:Number},defaultMenuOrientation:{type:String,default:"top"},replyMsgAutoMention:{type:Boolean,default:!0}},data(){return{quill:null,isFocus:!1,rangeIndex:0,_content:"",_options:{},mentionMode:"",userList:null,userCache:null,taskList:null,fileList:{},showMenu:!1,showMore:!1,showEmoji:!1,emojiQuickShow:!1,emojiQuickKey:"",emojiQuickItems:[],recordReady:!1,recordRec:null,recordBlob:null,recordWave:null,recordInter:null,recordState:"stop",recordDuration:0,touchStart:{},touchFocus:!1,touchLimitX:!1,touchLimitY:!1,pasteClean:!0,changeLoad:0,isSpecVersion:this.checkIOSVersion(),emojiTimer:null,scrollTimer:null,textTimer:null,fileTimer:null,moreTimer:null,selectTimer:null,selectRange:null,fullInput:!1,fullQuill:null,fullSelection:{index:0,length:0},fullTools:[{label:"bold",type:"",icon:"&#xe891;"},{label:"strike",type:"",icon:"&#xe892;"},{label:"italic",type:"",icon:"&#xe896;"},{label:"underline",type:"",icon:"&#xe88e;"},{label:"blockquote",type:"",icon:"&#xe88d;"},{label:"link",type:"",icon:"&#xe885;"},{label:"list",type:"ordered",icon:"&#xe886;"},{label:"list",type:"bullet",icon:"&#xe894;"},{label:"list",type:"unchecked",icon:"&#xe88c;"}],viewportHeight:0,iOSDevices:$A.isIos()}},created(){dt(this.dialogId,this._uid)},mounted(){this.init(),window.visualViewport&&window.visualViewport.addEventListener("resize",this.visualViewportResize),this.recordInter=setInterval(t=>{this.recordState==="ing"&&(this.__recordDuration&&this.__recordDuration===this.recordDuration?(this.__recordDuration=null,this.stopRecord(!0),$A.messageWarning("\u5F55\u97F3\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")):this.__recordDuration=this.recordDuration)},1e3),this.$isEEUiApp&&(window.__onPermissionRequest=(t,s)=>{t==="recordAudio"&&s===!1&&this.stopRecord(!0)}),$A.loadScript("js/emoticon.all.js")},beforeDestroy(){var t;ut(this.dialogId,this._uid),this.quill&&((t=this.quill.getModule("mention"))==null||t.hideMentionList(),this.quill=null),this.recordRec&&(this.recordRec=null),this.recordInter&&clearInterval(this.recordInter),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.visualViewportResize)},computed:{...m(["cacheProjects","cacheTasks","cacheUserBasic","cacheDialogs","dialogMsgs","cacheKeyboard"]),isEnterSend({cacheKeyboard:t}){return this.$isEEUiApp?t.send_button_app==="enter":t.send_button_desktop==="enter"},canCall(){return this.dialogData.type==="user"&&!this.dialogData.bot&&this.$isEEUiApp},canAnon(){return this.dialogData.type==="user"&&!this.dialogData.bot},recordTransferStyle(){const{windowScrollY:t}=this;return t>0?{marginTop:t/2+"px"}:null},boxClass(){const t=[];return["ready","ing"].includes(this.recordState)&&(this.recordState==="ing"&&this.recordDuration>0?t.push("record-progress"):t.push("record-ready")),this.simpleMode&&t.push("simple-mode"),this.showMenu&&t.push("show-menu"),this.showMore&&t.push("show-more"),this.showEmoji&&t.push("show-emoji"),this.mentionMode&&t.push(this.mentionMode),t},sendClass(){return this.filterInvalidLine(this.value)?"sender":this.recordReady?"recorder":""},sendContent(){const{sendTip:t}=this.$refs;return t&&t.$refs.popper&&(t.$refs.popper.style.visibility="hidden",t.showPopper=!1,setTimeout(s=>{t.$refs.popper&&(t.$refs.popper.style.visibility="visible")},300)),this.sendClass==="recorder"?"\u957F\u6309\u5F55\u97F3":"\u53D1\u9001"},recordFormatDuration(){const{recordDuration:t}=this;let s=Math.floor(t/6e4),e=Math.floor(t/1e3)%60,i=("00"+t%1e3).substr(-2);return s<10&&(s=`0${s}`),e<10&&(e=`0${e}`),`${s}:${e}\u2033${i}`},dialogData(){return this.dialogId>0?this.cacheDialogs.find(({id:t})=>t==this.dialogId)||{}:{}},quoteUpdate(){return this.dialogData.extra_quote_type==="update"},quoteData(){const{extra_quote_id:t}=this.dialogData;return t?this.dialogMsgs.find(s=>s.id===t):null},chatInputBoxStyle({iOSDevices:t,fullInput:s,viewportHeight:e}){const i={};return t&&s&&e>0&&(i.height=Math.max(100,e-70)+"px"),i}},watch:{value(t){this.quill&&(t&&t!==this._content?(this._content=t,this.setContent(t)):t||this.quill.setText("")),this.simpleMode||this.$store.dispatch("saveDialogDraft",{id:this.dialogId,extra_draft_content:this.filterInvalidLine(t)})},disabled(t){var s;(s=this.quill)==null||s.enable(!t)},dialogId(t,s){this.userList=null,this.userCache=null,this.taskList=null,this.fileList={},this.loadInputDraft(),dt(t,this._uid),ut(s,this._uid)},taskId(){this.userList=null,this.userCache=null,this.taskList=null,this.fileList={},this.loadInputDraft()},"dialogData.extra_draft_content"(){this.isFocus||this.loadInputDraft()},showMenu(t){t&&(this.showMore=!1,this.showEmoji=!1,this.emojiQuickShow=!1)},showMore(t){t&&(this.showMenu=!1,this.showEmoji=!1,this.emojiQuickShow=!1)},showEmoji(t){if(this.emojiBottom&&(t?this.quill.enable(!1):this.disabled||this.quill.enable(!0)),t){let s=this.value.replace(/&nbsp;/g," ").replace(/<[^>]+>/g,"");if(s&&s.indexOf(" ")===-1&&s.length>=1&&s.length<=8?this.emojiQuickKey=s:this.emojiQuickKey="",this.showMenu=!1,this.showMore=!1,this.emojiQuickShow=!1,this.quill){const e=this.quill.selection.savedRange;this.rangeIndex=e?e.index:0}}else this.rangeIndex>0&&this.quill.setSelection(this.rangeIndex)},emojiQuickShow(t){t&&(this.showMenu=!1,this.showMore=!1,this.showEmoji=!1)},isFocus(t){this.scrollTimer&&clearInterval(this.scrollTimer),t?(this.$emit("on-focus"),this.hidePopover(),this.isSpecVersion||this.windowPortrait&&(this.scrollTimer=setInterval(()=>{var s;(s=this.quill)!=null&&s.hasFocus()?this.windowScrollY>0&&$A.scrollIntoViewIfNeeded(this.$refs.editor):clearInterval(this.scrollTimer)},200))):this.$emit("on-blur")},recordState(t){t==="ing"?this.recordWave=window.Recorder.FrequencyHistogramView({elem:this.$refs.recwave,lineCount:90,position:0,minHeight:1,stripeEnable:!1}):(this.recordWave=null,this.$refs.recwave.innerHTML=""),this.$emit("on-record-state",t)},fullInput(t){var s;(s=this.quill)==null||s.enable(!t)},windowScrollY(t){this.fullInput&&t>0&&window.scrollTo(0,0)}},methods:{init(){this._options=Object.assign({theme:"bubble",bubbleTooltipTop:!0,formats:["bold","strike","italic","underline","blockquote","list","link","image","mention"],readOnly:!1,placeholder:this.placeholder,modules:{toolbar:this.$isEEUiApp||this.windowTouch?!1:this.toolbar,keyboard:this.simpleMode?{}:{bindings:{"short enter":{key:"Enter",shortKey:!0,handler:t=>this.isEnterSend?!0:(this.onSend(),!1)},enter:{key:"Enter",shiftKey:!1,handler:t=>this.isEnterSend?(this.onSend(),!1):!0},esc:{key:"Escape",shiftKey:!1,handler:t=>this.emojiQuickShow?(this.emojiQuickShow=!1,!1):!0}}},mention:this.quillMention()}},this.options),this.quill=new $(this.$refs.editor,this._options),this.quill.enable(!this.disabled),this.value?this.setContent(this.value):this.loadInputDraft(),this.quill.on("selection-change",t=>{if(t)this.selectRange=t;else if(this.selectRange&&document.activeElement&&/(ql-editor|ql-clipboard)/.test(document.activeElement.className)){this.selectTimer&&clearTimeout(this.selectTimer),this.selectTimer=setTimeout(s=>{this.quill.setSelection(this.selectRange.index,this.selectRange.length)},100);return}this.isFocus=!!t}),this.quill.on("text-change",t=>{if(this.isFocus){const{index:s}=this.quill.getSelection();if(this.quill.getText(s-1,1)==="\r"){this.quill.insertText(s,`
`),this.quill.deleteText(s-1,1);return}}this.textTimer?clearTimeout(this.textTimer):this.changeLoad++,this.textTimer=setTimeout(s=>{this.textTimer=null,this.changeLoad--,this.maxlength>0&&this.quill.getLength()>this.maxlength&&this.quill.deleteText(this.maxlength,this.quill.getLength());const e=this.$refs.editor.firstChild.innerHTML;this.updateEmojiQuick(e),this._content=e,this.$emit("input",this._content)},100)}),this.quill.clipboard.addMatcher(Node.ELEMENT_NODE,(t,s)=>(this.pasteClean&&(s.ops=s.ops.map(e=>{const i={insert:e.insert};try{typeof i.insert.mention=="object"&&t.innerHTML&&(i.insert=t.innerHTML.replace(/<[^>]+>/g,""))}catch{}return e.attributes&&["bold","strike","italic","underline","list","blockquote","link"].some(a=>{e.attributes[a]&&(typeof i.attributes=="undefined"&&(i.attributes={}),i.attributes[a]=e.attributes[a])}),i})),s)),this.$nextTick(t=>{this.$isEEUiApp&&this.cacheKeyboard.send_button_app==="enter"&&this.quill.root.setAttribute("enterkeyhint","send")}),this.$emit("on-ready",this.quill),this.disabledRecord||$A.loadScriptS(["js/recorder/recorder.mp3.min.js","js/recorder/lib.fft.js","js/recorder/frequency.histogram.view.js"]).then(t=>{typeof window.Recorder=="function"&&(this.recordRec=window.Recorder({type:"mp3",bitRate:64,sampleRate:32e3,audioTrackSet:null,disableEnvInFix:!1,onProcess:(s,e,i,a,o,r)=>{var n;(n=this.recordWave)==null||n.input(s[s.length-1],e,a),this.recordDuration=i,i>=3*60*1e3&&this.stopRecord(!1)}}),window.Recorder.Support()&&(this.recordReady=!0))})},quillMention(){return{allowedChars:/^\S*$/,mentionDenotationChars:["@","#","~"],defaultMenuOrientation:this.defaultMenuOrientation,isolateCharacter:!0,positioningStrategy:"fixed",renderItem:t=>{if(t.disabled===!0)return`<div class="mention-item-disabled">${t.value}</div>`;if(t.id===0)return`<div class="mention-item-at">@</div><div class="mention-item-name">${t.value}</div><div class="mention-item-tip">${t.tip}</div>`;if(t.avatar){const s=t.bot?'<div class="taskfont mention-item-bot">&#xe68c;</div>':"";return`<div class="mention-item-img${t.online?" online":""}"><img src="${t.avatar}"/><em></em></div>${s}<div class="mention-item-name">${t.value}</div>`}return t.tip?`<div class="mention-item-name" title="${t.value}">${t.value}</div><div class="mention-item-tip">${t.tip}</div>`:`<div class="mention-item-name" title="${t.value}">${t.value}</div>`},renderLoading:()=>"Loading...",source:(t,s,e)=>{const i=e=="@"?"user-mention":e=="#"?"task-mention":"file-mention",a=document.getElementsByClassName("ql-mention-list-container");for(let r=0;r<a.length;r++)a[r].classList.remove("user-mention"),a[r].classList.remove("task-mention"),a[r].classList.remove("file-mention"),a[r].classList.add(i),$A.scrollPreventThrough(a[r]);let o=null;this.getMentionSource(e,t,r=>{const n=[];r.some(l=>{let c=l.list;t&&(c=c.filter(({value:u})=>$A.strExists(u,t))),c.length>0&&(l.label&&n.push(...l.label),n.push(...c))}),$A.jsonStringify(n.map(({id:l})=>l))!==o&&(o=$A.jsonStringify(n.map(({id:l})=>l)),s(n,t))})}}},updateEmojiQuick(t){if(!this.isFocus||!t){this.emojiQuickShow=!1;return}this.emojiTimer&&clearTimeout(this.emojiTimer),this.emojiTimer=setTimeout(s=>{if(this.emojiTimer=null,/<img/i.test(t)){this.emojiQuickShow=!1;return}if(t=t.replace(/&nbsp;/g," ").replace(/<[^>]+>/g,""),t&&t.indexOf(" ")===-1&&t.length>=1&&t.length<=8&&$A.isArray(window.emoticonData)){this.emojiQuickItems=[];const e=$A.mainUrl("images/emoticon");if(window.emoticonData.some(i=>{let a=0;if(i.list.some(o=>{const r=[o.name];if(o.key&&r.push(...`${o.key}`.split(" ")),r.includes(t)&&(this.emojiQuickItems.push(Object.assign(o,{type:"emoticon",asset:`images/emoticon/${i.path}/${o.path}`,name:o.name,src:`${e}/${i.path}/${o.path}`})),++a>=2))return!0}),this.emojiQuickItems.length>=20)return!0}),this.emojiQuickItems.length>0){this.$refs.emojiWrapper.$el.style.maxWidth=`${Math.min(500,this.$refs.inputWrapper.clientWidth)}px`,this.$nextTick(i=>{this.emojiQuickShow=!0,this.$refs.emojiQuickRef.updatePopper()});return}}this.emojiQuickShow=!1},100)},getText(){return this.quill?`${this.quill.getText()}`.replace(/^\s+|\s+$/g,""):""},setText(t){this.quill&&this.quill.setText(t)},setContent(t){this.quill&&this.quill.setContents(this.quill.clipboard.convert({html:t}))},setPasteMode(t){this.pasteClean=t},loadInputDraft(){const{extra_draft_content:t}=this.dialogData;if(this.simpleMode||!t){this.$emit("input","");return}this.pasteClean=!1,this.$emit("input",t),this.$nextTick(s=>this.pasteClean=!0)},onClickEditor(){this.clearSearchKey(),this.updateEmojiQuick(this.value)},clearSearchKey(){this.$parent.$options.name==="DialogWrapper"&&(this.$store.state.messengerSearchKey.dialog!=""||this.$store.state.messengerSearchKey.contacts!="")&&setTimeout(t=>{this.$parent.onActive()},10),this.$store.state.messengerSearchKey={dialog:"",contacts:""}},focus(){this.$nextTick(()=>{this.quill&&(this.quill.setSelection(this.quill.getLength()),this.quill.focus())})},blur(){this.$nextTick(()=>{this.quill&&this.quill.blur()})},clickSend(t,s){var e;if(!this.loading)switch(t){case"down":if(this.touchFocus=(e=this.quill)==null?void 0:e.hasFocus(),this.touchLimitX=!1,this.touchLimitY=!1,this.touchStart=s.type==="touchstart"?s.touches[0]:s,(s.button===void 0||s.button===0)&&this.startRecord())return;s.button===2&&this.onShowMenu();break;case"move":const i=s.type==="touchmove"?s.touches[0]:s;this.touchLimitX=(this.touchStart.clientX-i.clientX)/window.innerWidth>.1,this.touchLimitY=(this.touchStart.clientY-i.clientY)/window.innerHeight>.1;break;case"up":if(this.showMenu||this.stopRecord(this.touchLimitY)||this.touchLimitY||this.touchLimitX)return;this.onSend();break;case"click":this.touchFocus&&(this.quill.blur(),this.quill.focus());break}},onShowMenu(){this.sendClass==="recorder"||!this.sendMenu||(this.showMenu=!0)},onSend(t="auto"){this.emojiTimer&&clearTimeout(this.emojiTimer),this.emojiQuickShow=!1,setTimeout(s=>{this.filterInvalidLine(this.value)!==""&&(this.hidePopover("send"),this.rangeIndex=0,this.clearSearchKey(),t==="auto"&&(t=Lt(this.value)?"md":""),t==="normal"&&(t=""),t?this.$emit("on-send",null,t):this.$emit("on-send"))},this.changeLoad>0?100:0)},startRecord(){return this.sendClass==="recorder"?(this.$store.dispatch("audioStop",!0),this.recordDuration=0,this.recordState="ready",this.$nextTick(t=>{this.recordRec.open(s=>{this.recordState==="ready"?(this.recordState="ing",this.recordBlob=null,setTimeout(e=>{this.recordRec.start()},300)):this.recordRec.close()},s=>{this.recordState="stop",$A.messageError(s||"\u6253\u5F00\u5F55\u97F3\u5931\u8D25")})}),!0):!1},stopRecord(t){switch(this.recordState){case"ing":return this.recordState="stop",this.recordRec.stop((s,e)=>{this.recordRec.close(),t!==!0&&(e<600?$A.messageWarning("\u8BF4\u8BDD\u65F6\u95F4\u592A\u77ED"):(this.recordBlob=s,this.uploadRecord(e)))},s=>{this.recordRec.close(),$A.messageError(s||"\u5F55\u97F3\u5931\u8D25")}),!0;case"ready":return this.recordState="stop",!0;default:return this.recordState="stop",!1}},hidePopover(t){this.showMenu=!1,this.showMore=!1,t!=="send"&&(this.showEmoji=!1,this.emojiQuickShow=!1)},onClickCover(){this.hidePopover(),this.$nextTick(t=>{var s;(s=this.quill)==null||s.focus()})},uploadRecord(t){if(this.recordBlob===null)return;const s=new FileReader;s.onloadend=()=>{this.$emit("on-record",{type:this.recordBlob.type,base64:s.result,duration:t})},s.readAsDataURL(this.recordBlob)},onEmojiQuick(t){t.type==="online"?(this.$emit("input",""),this.$emit("on-send",`<img src="${t.src}"/>`)):(this.$emit("input",""),this.$emit("on-send",`<img class="emoticon" data-asset="${t.asset}" data-name="${t.name}" src="${t.src}"/>`)),this.emojiQuickShow=!1,this.focus()},onSelectEmoji(t){!this.quill||(t.type==="emoji"?(this.quill.insertText(this.rangeIndex,t.text),this.rangeIndex+=t.text.length,this.windowLandscape&&(this.showEmoji=!1)):t.type==="emoticon"&&(this.$emit("on-send",`<img class="emoticon" data-asset="${t.asset}" data-name="${t.name}" src="${t.src}"/>`),t.asset==="emosearch"&&this.$emit("input",""),this.windowLandscape&&(this.showEmoji=!1)))},onToolbar(t){switch(this.hidePopover(),t){case"user":this.openMenu("@");break;case"task":this.openMenu("#");break;case"meeting":_.Store.set("addMeeting",{type:"create",dialog_id:this.dialogId,userids:[this.userId]});break;case"full":this.onFullInput();break;case"image":case"file":case"call":case"anon":this.$emit("on-more",t);break;case"word-chain":this.$store.state.dialogDroupWordChain={type:"create",dialog_id:this.dialogId};break;case"vote":this.$store.state.dialogGroupVote={type:"create",dialog_id:this.dialogId};break}},onFullInput(){this.disabled||(this.fullInput=!this.fullInput,this.fullInput&&this.$nextTick(t=>{this.fullQuill=new $(this.$refs.editorFull,Object.assign({theme:"bubble",readOnly:!1,placeholder:this.placeholder,modules:{toolbar:!1,mention:this.quillMention()}},this.options)),this.fullQuill.on("selection-change",s=>{this.fullSelection=s||{index:0,length:0}}),this.fullQuill.on("text-change",s=>{this.fullSelection=this.fullQuill.getSelection()}),this.fullQuill.enable(!0),this.$refs.editorFull.firstChild.innerHTML=this.$refs.editor.firstChild.innerHTML,this.$nextTick(s=>{this.fullQuill.setSelection(this.fullQuill.getLength()),this.fullQuill.focus()})}))},onFullBeforeClose(){return new Promise(t=>{var s;(s=this.$refs.editorFull)!=null&&s.firstChild&&(this.$refs.editor.firstChild.innerHTML=this.$refs.editorFull.firstChild.innerHTML),t()})},onFullMenu(t,s){const{length:e}=this.fullQuill.getSelection(!0);if(e===0){$A.messageWarning("\u8BF7\u9009\u62E9\u6587\u5B57\u540E\u518D\u64CD\u4F5C");return}switch(t){case"bold":this.fullQuill.format("bold",!this.fullQuill.getFormat().bold);break;case"strike":this.fullQuill.format("strike",!this.fullQuill.getFormat().strike);break;case"italic":this.fullQuill.format("italic",!this.fullQuill.getFormat().italic);break;case"underline":this.fullQuill.format("underline",!this.fullQuill.getFormat().underline);break;case"blockquote":this.fullQuill.format("blockquote",!this.fullQuill.getFormat().blockquote);break;case"link":if(this.fullQuill.getFormat().link){this.fullQuill.format("link",!1);return}$A.modalInput({title:"\u63D2\u5165\u94FE\u63A5",placeholder:"\u8BF7\u8F93\u5165\u5B8C\u6574\u7684\u94FE\u63A5\u5730\u5740",onOk:i=>{if(!i)return!1;this.fullQuill.format("link",i)}});break;case"list":this.fullQuill.format("list",this.fullQuill.getFormat().list===s?!1:s);break}},setQuote(t,s="reply"){this.dialogId>0&&this.$store.dispatch("saveDialog",{id:this.dialogId,extra_quote_id:t,extra_quote_type:s==="update"?"update":"reply"})},cancelQuote(){if(this.quoteUpdate)this.$emit("input","");else if(this.quoteData&&this.$refs.editor.firstChild.querySelectorAll("img").length===0){const t=document.createElement("div");t.innerHTML=this.$refs.editor.firstChild.innerHTML,t.querySelectorAll("span.mention").forEach(s=>{s.getAttribute("data-id")==this.quoteData.userid&&(s.innerHTML="")}),t.innerText.replace(/\s/g,"")||this.$emit("input","")}this.setQuote(0)},onQuoteUserResult(t){this.dialogData.type==="group"&&(this.quoteUpdate||!this.quoteData||!this.replyMsgAutoMention||t.bot&&!$A.rightExists(t.email,"@bot.system")||this.userId===t.userid||this.quoteData.userid!==t.userid||new RegExp(`<span[^>]+?class="mention"[^>]+?data-id="${t.userid}"[^>]*?>`).test(this.$refs.editor.firstChild.innerHTML)||this.addMention({denotationChar:"@",id:t.userid,value:t.nickname}))},onSpaceInputFocus(){var t;this.selectRange&&((t=this.quill)==null||t.setSelection(this.selectRange.index,this.selectRange.length))},openMenu(t){if(!!this.quill)if(this.value.length===0||this.value.endsWith("<p><br></p>"))this.quill.getModule("mention").openMenu(t);else{let s=this.value.replace(/<[^>]+>/g,"");s.length===0||s.endsWith(" ")?this.quill.getModule("mention").openMenu(t):this.quill.getModule("mention").openMenu(` ${t}`)}},addMention(t){if(!this.quill||!Ga(this.dialogId,this._uid))return;const{index:s}=this.quill.getSelection(!0);this.quill.insertEmbed(s,"mention",t,$.sources.USER),this.quill.insertText(s+1," ",$.sources.USER),this.quill.setSelection(s+2,$.sources.USER)},getProjectId(){let t=null;if(this.dialogId>0){if(t=this.cacheProjects.find(({dialog_id:s})=>s==this.dialogId),t)return t.id;if(t=this.cacheTasks.find(({dialog_id:s})=>s==this.dialogId),t)return t.project_id}else if(this.taskId>0&&(t=this.cacheTasks.find(({id:s})=>s==this.taskId),t))return t.project_id;return 0},getMentionSource(t,s,e){switch(t){case"@":this.mentionMode="user-mention";const i=n=>{this.getMoreUser(s,n.map(l=>l.id)).then(l=>{let c=this.cacheDialogs.filter((u,h)=>u.type=="user"&&u.bot==0&&u.last_at);c.sort((u,h)=>u.last_at>h.last_at?-1:u.last_at<h.last_at?1:0),c=c.filter((u,h)=>h<5),l.forEach(u=>{u.last_at="1990-01-01 00:00:00",c.forEach(h=>{var g;((g=h.dialog_user)==null?void 0:g.userid)==u.id&&(u.last_at=h.last_at)})}),l.sort((u,h)=>u.last_at>h.last_at?-1:u.last_at<h.last_at?1:0),this.userList=n,this.userCache=[],l.length>0?(n.length>2&&this.userCache.push({label:null,list:[{id:0,value:this.$L("\u6240\u6709\u4EBA.All"),tip:""}]}),this.userCache.push({label:[{id:0,value:this.$L("\u7FA4\u5185\u6210\u5458"),disabled:!0}],list:n},{label:[{id:0,value:this.$L("\u7FA4\u5916\u6210\u5458"),disabled:!0}],list:l})):n.length>2?this.userCache.push({label:null,list:[{id:0,value:this.$L("\u6240\u6709\u4EBA.All"),tip:""}]},{label:[{id:0,value:this.$L("\u7FA4\u6210\u5458"),disabled:!0}],list:n}):this.userCache.push({label:null,list:n}),e(this.userCache)})};if(this.dialogData.people&&$A.arrayLength(this.userList)!==this.dialogData.people&&(this.userList=null,this.userCache=null),this.userCache!==null&&e(this.userCache),this.userList!==null){i(this.userList);return}const a=[];if(this.dialogId>0)this.$store.dispatch("call",{url:"dialog/user",data:{dialog_id:this.dialogId,getuser:1}}).then(({data:n})=>{this.cacheDialogs.find(({id:l})=>l==this.dialogId)&&this.$store.dispatch("saveDialog",{id:this.dialogId,people:n.length}),n.length>0&&a.push(...n.map(l=>({id:l.userid,value:l.nickname,avatar:l.userimg,online:l.online,bot:l.bot}))),i(a)}).catch(n=>{i(a)});else if(this.taskId>0){const n=this.cacheTasks.find(({id:l})=>l==this.taskId);n&&$A.isArray(n.task_user)&&n.task_user.some(l=>{const c=this.cacheUserBasic.find(({userid:u})=>u==l.userid);c&&a.push({id:c.userid,value:c.nickname,avatar:c.userimg,online:c.online,bot:c.bot})}),i(a)}break;case"#":if(this.mentionMode="task-mention",this.taskList!==null){e(this.taskList);return}const o=n=>{this.taskList=[],n.length>0&&(n=n.map(u=>({id:u.id,value:u.name,tip:u.complete_at?this.$L("\u5DF2\u5B8C\u6210"):null})).splice(0,100),this.taskList.push({label:[{id:0,value:this.$L("\u9879\u76EE\u4EFB\u52A1"),disabled:!0}],list:n}));let l=this.$store.getters.transforTasks(this.$store.getters.dashboardTask.all);l.length>0&&(l=l.sort((u,h)=>$A.dayjs(u.end_at||"2099-12-31 23:59:59")-$A.dayjs(h.end_at||"2099-12-31 23:59:59")).splice(0,100),this.taskList.push({label:[{id:0,value:this.$L("\u6211\u7684\u5F85\u5B8C\u6210\u4EFB\u52A1"),disabled:!0}],list:l.map(u=>({id:u.id,value:u.name}))}));let c=this.$store.getters.assistTask;c.length>0&&(c=c.sort((u,h)=>$A.dayjs(u.end_at||"2099-12-31 23:59:59")-$A.dayjs(h.end_at||"2099-12-31 23:59:59")).splice(0,100),this.taskList.push({label:[{id:0,value:this.$L("\u6211\u534F\u52A9\u7684\u4EFB\u52A1"),disabled:!0}],list:c.map(u=>({id:u.id,value:u.name}))})),e(this.taskList)},r=this.getProjectId();if(r>0){this.$store.dispatch("getTaskForProject",r).then(n=>{const l=this.cacheTasks.filter(c=>c.archived_at?!1:c.project_id==r&&c.parent_id===0&&!c.archived_at).sort((c,u)=>$A.dayjs(u.complete_at||"2099-12-31 23:59:59")-$A.dayjs(c.complete_at||"2099-12-31 23:59:59"));l.length>0?o(l):o([])}).catch(n=>{o([])});return}o([]);break;case"~":if(this.mentionMode="file-mention",$A.isArray(this.fileList[s])){e(this.fileList[s]);return}this.fileTimer&&clearTimeout(this.fileTimer),this.fileTimer=setTimeout(n=>{this.$store.dispatch("searchFiles",s).then(({data:l})=>{this.fileList[s]=[{label:[{id:0,value:this.$L("\u6587\u4EF6\u5206\u4EAB\u67E5\u770B"),disabled:!0}],list:l.filter(c=>c.type!=="folder").map(c=>({id:c.id,value:c.ext?`${c.name}.${c.ext}`:c.name}))}],e(this.fileList[s])}).catch(()=>{e([])})},300);break;default:e([]);break}},getMoreUser(t,s){return new Promise(e=>{const{owner_id:i,type:a}=this.dialogData,o=a==="group"&&[0,this.userId].includes(i);this.taskId>0||o?(this.moreTimer&&clearTimeout(this.moreTimer),this.moreTimer=setTimeout(r=>{this.$store.dispatch("call",{url:"users/search",data:{keys:{key:t},state:1,take:30}}).then(({data:n})=>{const l=n.filter(c=>!s.includes(c.userid));e(l.map(c=>({id:c.userid,value:c.nickname,avatar:c.userimg,online:!!c.online})))}).catch(n=>{e([])})},this.userCache===null?0:600)):e([])})},checkIOSVersion(){let s=(window&&window.navigator&&window.navigator.userAgent).match(/OS ((\d+_?){2,3})\s/i);const i=(s?s[1].replace(/_/g,"."):"unknown").split(".");return+i[0]==11&&+i[1]>=0&&+i[1]<3},handlePaste(t){const s=Array.prototype.slice.call(t.clipboardData.files);s.filter(i=>!$A.leftExists(i.type,"image/")).length>0&&(t.preventDefault(),this.$emit("on-file",s))},filterInvalidLine(t){return(t+"").replace(/^(<p>\s*<\/p>)+|(<p>\s*<\/p>)+$/gi,"").replace(/^(<p><br\/*><\/p>)+|(<p><br\/*><\/p>)+$/gi,"")},updateTools(){var s,e,i,a;this.showEmoji&&((s=this.$refs.emoji)==null||s.updatePopper()),this.showMore&&((e=this.$refs.more)==null||e.updatePopper()),this.showMenu&&((i=this.$refs.menu)==null||i.updatePopper());const t=(a=this.quill)==null?void 0:a.getModule("mention");t.isOpen&&t.setMentionContainerPosition()},visualViewportResize(){var t;this.viewportHeight=((t=window.visualViewport)==null?void 0:t.height)||0}}},ht={};var Za=d(Xa,Ja,Ya,!1,to,null,null,null);function to(t){for(let s in ht)this[s]=ht[s]}var eo=function(){return Za.exports}(),so=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{"class-name":"dialog-droup-word-chain","mask-closable":!1,title:t.dialogDroupWordChain.type=="create"?t.$L("\u53D1\u8D77\u63A5\u9F99"):t.$L("\u63A5\u9F99\u7ED3\u679C"),closable:!t.isFullscreen,fullscreen:t.isFullscreen,"footer-hide":t.isFullscreen},scopedSlots:t._u([{key:"header",fn:function(){return[t.isFullscreen?e("div",{staticClass:"chain-modal-header"},[e("div",{staticClass:"chain-modal-close",on:{click:function(i){t.show=!1}}},[t._v(" "+t._s(t.$L("\u53D6\u6D88"))+" ")]),e("div",{staticClass:"chain-modal-title"},[e("span",[t._v(t._s(t.dialogDroupWordChain.type=="create"?t.$L("\u53D1\u8D77\u63A5\u9F99"):t.$L("\u63A5\u9F99\u7ED3\u679C")))])]),e("div",{staticClass:"chain-modal-submit",class:{disabled:!t.isEdit},on:{click:t.onSend}},[t.loadIng>0?e("div",{staticClass:"submit-loading"},[e("Loading")],1):t._e(),t._v(" "+t._s(t.$L("\u53D1\u9001"))+" ")])]):t._e()]},proxy:!0},{key:"close",fn:function(){return[e("i",{staticClass:"ivu-icon ivu-icon-ios-close"})]},proxy:!0}]),model:{value:t.show,callback:function(i){t.show=i},expression:"show"}},[e("div",{ref:"wordChainBodyRef",staticClass:"word-chain-body"},[t.dialogDroupWordChain.type=="create"?e("div",{staticClass:"source"},[t._v(" "+t._s(t.$L("\u6765\u81EA"))+" "),e("span",[t._v(t._s(t.dialog.name))])]):t._e(),e("div",{staticClass:"initiate"},[e("span",[t._v(t._s(t.$L("\u7531")))]),e("UserAvatar",{attrs:{userid:t.createId,size:22,showName:!0}}),e("span",[t._v(" "+t._s(t.$L("\u53D1\u8D77\uFF0C\u53C2\u4E0E\u63A5\u9F99\u76EE\u524D\u5171"+t.num+"\u4EBA")))])],1),e("div",{staticClass:"textarea"},[e("Input",{ref:"wordChainTextareaRef",attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},disabled:t.dialogDroupWordChain.type!="create",placeholder:t.$L("\u8BF7\u8F93\u5165\u63A5\u9F99\u4E3B\u9898")},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}})],1),e("ul",{ref:"wordChainListRef"},[t._l(t.list,function(i){return i.type=="case"&&(t.dialogDroupWordChain.type=="create"||i.text)?e("li",[e("span",[t._v(t._s(t.$L("\u4F8B")))]),e("Input",{attrs:{placeholder:t.$L("\u53EF\u586B\u5199\u63A5\u9F99\u683C\u5F0F"),disabled:t.dialogDroupWordChain.type!="create"},model:{value:i.text,callback:function(a){t.$set(i,"text",a)},expression:"item.text"}})],1):t._e()}),t._l(t.list.filter(function(i){return i.type!="case"}),function(i,a){return e("li",[e("span",[t._v(t._s(a+1))]),e("Input",{attrs:{disabled:i.userid!=t.userId,placeholder:t.$L("\u8BF7\u8F93\u5165\u63A5\u9F99\u5185\u5BB9")},model:{value:i.text,callback:function(o){t.$set(i,"text",o)},expression:"item.text"}})],1)}),e("li",{staticClass:"add"},[e("i",{staticClass:"taskfont",on:{click:t.onAdd}},[t._v("\uE78C")])])],2)]),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0,disabled:!t.isEdit},on:{click:t.onSend}},[t._v(t._s(t.$L("\u53D1\u9001")))])],1)])},io=[];const ao={name:"DialogDroupWordChain",data(){return{show:!1,createId:0,value:"#"+this.$L("\u63A5\u9F99")+` 
`,list:[],oldData:"",loadIng:0}},computed:{...m(["dialogDroupWordChain","userInfo","dialogMsgs","cacheDialogs"]),isFullscreen({windowWidth:t}){return t<576},num(){var t;return((t=this.list.filter(s=>s.type!="case"))==null?void 0:t.length)||0},allList(){var e;const t=((e=this.dialogDroupWordChain.msgData)==null?void 0:e.msg)||{};let s=JSON.parse(JSON.stringify(t.list||[]));return this.dialogMsgs.filter(i=>{var a;return i.type=="word-chain"&&((a=i.msg)==null?void 0:a.uuid)==t.uuid}).forEach(i=>{(i.msg.list||[]).forEach(a=>{a.type!="case"&&s.map(o=>o.id).indexOf(a.id)==-1&&s.push(a)})}),s.filter(i=>(i.text||"").trim())},isEdit(){return this.oldData!=JSON.stringify(this.list)},dialog(){return this.cacheDialogs.find(t=>t.id==this.dialogDroupWordChain.dialog_id)||{}}},watch:{show(t){t?(this.dialogDroupWordChain.type=="create"&&this.$nextTick(()=>{this.$refs.wordChainTextareaRef.focus()}),this.scrollTo()):(this.value="#"+this.$L("\u63A5\u9F99")+` 
`,this.list=[])},dialogDroupWordChain(t){t.type=="create"&&t.dialog_id&&(this.show=!0,this.createId=this.userId,this.list=[],this.list.push({id:Date.now(),type:"case",userid:this.userId,text:""}),this.list.push({id:Date.now()+1,type:"text",userid:this.userId,text:this.userInfo.nickname})),t.type=="participate"&&t.dialog_id&&t.msgData&&(this.show=!0,this.createId=t.msgData.msg.createid||t.msgData.msg.userid,this.value=t.msgData.msg.text,this.list=this.allList,this.oldData=JSON.stringify(this.list))}},methods:{onAdd(){this.list.push({id:Date.now(),type:"text",userid:this.userId,text:this.userInfo.nickname}),this.scrollTo()},scrollTo(){this.$nextTick(()=>{this.$refs.wordChainListRef.scrollTo(0,99999)})},onSend(){if(!this.isEdit)return;if(!this.value){$A.messageError("\u8BF7\u8F93\u5165\u63A5\u9F99\u4E3B\u9898");return}const t=this.list.map(s=>s.text);if(t.length!=[...new Set(t)].length){$A.modalConfirm({content:"\u91CD\u590D\u5185\u5BB9\u5C06\u4E0D\u518D\u8BA1\u5165\u63A5\u9F99\u7ED3\u679C",cancelText:"\u8FD4\u56DE\u7F16\u8F91",okText:"\u7EE7\u7EED\u53D1\u9001",onOk:()=>{this.send()}});return}this.send()},send(){var s,e;const t=[];this.list.forEach(i=>{(i.text||i.type!="case")&&t.map(a=>a.text).indexOf(i.text)==-1&&t.push(i)}),this.loadIng++,this.$store.dispatch("call",{url:"dialog/msg/wordchain",method:"post",data:{dialog_id:this.dialogDroupWordChain.dialog_id,text:this.value,list:t,uuid:((e=(s=this.dialogDroupWordChain.msgData)==null?void 0:s.msg)==null?void 0:e.uuid)||""}}).then(({data:i})=>{this.show=!1,this.$store.dispatch("saveDialogMsg",i)}).catch(({msg:i})=>{if(i.indexOf("System error")!==-1){$A.modalInfo({title:"\u7248\u672C\u8FC7\u4F4E",content:"\u670D\u52A1\u5668\u7248\u672C\u8FC7\u4F4E\uFF0C\u8BF7\u5347\u7EA7\u670D\u52A1\u5668\u3002"});return}$A.modalError(i)}).finally(i=>{this.loadIng--})}}},pt={};var oo=d(ao,so,io,!1,ro,null,null,null);function ro(t){for(let s in pt)this[s]=pt[s]}var no=function(){return oo.exports}(),lo=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{"class-name":"dialog-droup-word-chain","mask-closable":!1,title:t.dialogGroupVote.type=="create"?t.$L("\u53D1\u8D77\u6295\u7968"):t.$L("\u6295\u7968\u7ED3\u679C"),closable:!t.isFullscreen,fullscreen:t.isFullscreen,"footer-hide":t.isFullscreen},scopedSlots:t._u([{key:"header",fn:function(){return[t.isFullscreen?e("div",{staticClass:"chain-modal-header"},[e("div",{staticClass:"chain-modal-close",on:{click:function(i){t.show=!1}}},[t._v(" "+t._s(t.$L("\u53D6\u6D88"))+" ")]),e("div",{staticClass:"chain-modal-title"},[e("span",[t._v(t._s(t.dialogGroupVote.type=="create"?t.$L("\u53D1\u8D77\u6295\u7968"):t.$L("\u6295\u7968\u7ED3\u679C")))])]),e("div",{staticClass:"chain-modal-submit",class:{disabled:!t.isEdit},on:{click:t.onSend}},[t.loadIng>0?e("div",{staticClass:"submit-loading"},[e("Loading")],1):t._e(),t._v(" "+t._s(t.$L("\u53D1\u9001"))+" ")])]):t._e()]},proxy:!0},{key:"close",fn:function(){return[e("i",{staticClass:"ivu-icon ivu-icon-ios-close"})]},proxy:!0}]),model:{value:t.show,callback:function(i){t.show=i},expression:"show"}},[e("div",{ref:"wordChainBodyRef",staticClass:"word-chain-body"},[t.dialogGroupVote.type=="create"?e("div",{staticClass:"source"},[t._v(" "+t._s(t.$L("\u6765\u81EA"))+" "),e("span",[t._v(t._s(t.dialog.name))])]):t._e(),e("div",{staticClass:"initiate"},[e("span",[t._v(t._s(t.$L("\u7531")))]),e("UserAvatar",{attrs:{userid:t.createId,size:22,showName:!0,tooltipDisabled:""}}),e("span",[t._v(" "+t._s(t.$L("\u53D1\u8D77")))])],1),e("div",{staticClass:"textarea"},[e("Input",{ref:"wordChainTextareaRef",attrs:{type:"textarea",placeholder:t.$L("\u8BF7\u8F93\u5165\u6295\u7968\u4E3B\u9898"),autosize:{minRows:3,maxRows:5},disabled:t.dialogGroupVote.type!="create"},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}})],1),e("ul",{ref:"wordChainListRef"},[t._l(t.list,function(i,a){return e("li",[e("i",{staticClass:"taskfont",class:{disabled:t.list.length<=2},on:{click:function(o){return t.onDel(a)}}},[t._v("\uE680")]),e("Input",{attrs:{placeholder:t.$L("\u8BF7\u8F93\u5165\u9009\u9879\u5185\u5BB9")},model:{value:i.text,callback:function(o){t.$set(i,"text",o)},expression:"item.text"}})],1)}),e("li",{staticClass:"add"},[e("i",{staticClass:"taskfont",on:{click:t.onAdd}},[t._v("\uE78C")])])],2),t.dialogGroupVote.type=="create"?e("div",{staticClass:"switch-row"},[e("span",{staticClass:"label"},[t._v(t._s(t.$L("\u5141\u8BB8\u591A\u9009")))]),e("iSwitch",{attrs:{"true-value":1,"false-value":0},model:{value:t.multiple,callback:function(i){t.multiple=i},expression:"multiple"}})],1):t._e(),t.dialogGroupVote.type=="create"?e("div",{staticClass:"switch-row"},[e("span",{staticClass:"label"},[t._v(t._s(t.$L("\u533F\u540D\u6295\u7968")))]),e("iSwitch",{attrs:{"true-value":1,"false-value":0},model:{value:t.anonymous,callback:function(i){t.anonymous=i},expression:"anonymous"}})],1):t._e()]),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0,disabled:!t.isEdit},on:{click:t.onSend}},[t._v(t._s(t.$L("\u53D1\u9001")))])],1)])},co=[];const uo={name:"DialogGroupVote",data(){return{show:!1,createId:0,value:"",list:[],multiple:0,anonymous:0,oldData:"",loadIng:0}},computed:{...m(["dialogGroupVote","userInfo","dialogMsgs","cacheDialogs"]),isFullscreen({windowWidth:t}){return t<576},allList(){var e;const t=((e=this.dialogGroupVote.msgData)==null?void 0:e.msg)||{};let s=JSON.parse(JSON.stringify(t.list||[]));return this.dialogMsgs.filter(i=>{var a;return i.type=="word-chain"&&((a=i.msg)==null?void 0:a.uuid)==t.uuid}).forEach(i=>{(i.msg.list||[]).forEach(a=>{s.map(o=>o.id).indexOf(a.id)==-1&&s.push(a)})}),s},isEdit(){return this.oldData!=JSON.stringify(this.list)},dialog(){return this.cacheDialogs.find(t=>t.id==this.dialogGroupVote.dialog_id)||{}}},watch:{show(t){t?(this.dialogGroupVote.type=="create"&&this.$nextTick(()=>{this.$refs.wordChainTextareaRef.focus()}),this.scrollTo()):(this.value="",this.list=[])},dialogGroupVote(t){t.type=="create"&&t.dialog_id&&(this.show=!0,this.createId=this.userId,this.list=[{id:Date.now(),text:""},{id:Date.now()+1,text:""}]),t.type=="participate"&&t.dialog_id&&t.msgData&&(this.show=!0,this.createId=t.msgData.msg.userid,this.value=t.msgData.msg.text,this.list=this.allList,this.oldData=JSON.stringify(this.list))}},methods:{onAdd(){this.list.push({id:Date.now(),text:""}),this.scrollTo()},onDel(t){this.list.length>2&&this.list.splice(t,1)},scrollTo(){this.$nextTick(()=>{this.$refs.wordChainListRef.scrollTo(0,99999)})},onSend(){var t,s;if(!!this.isEdit){if(!this.value){$A.messageError("\u8BF7\u8F93\u5165\u6295\u7968\u4E3B\u9898");return}if(this.list.find(e=>!e.text)){$A.messageError("\u8BF7\u8F93\u5165\u9009\u9879\u5185\u5BB9");return}this.loadIng++,this.$store.dispatch("call",{url:"dialog/msg/vote",method:"post",data:{dialog_id:this.dialogGroupVote.dialog_id,text:this.value,list:this.list,uuid:((s=(t=this.dialogGroupVote.msgData)==null?void 0:t.msg)==null?void 0:s.uuid)||"",multiple:this.multiple,anonymous:this.anonymous}}).then(({data:e})=>{this.show=!1,this.$store.dispatch("saveDialogMsg",e)}).catch(({msg:e})=>{if(e.indexOf("System error")!==-1){$A.modalInfo({title:"\u7248\u672C\u8FC7\u4F4E",content:"\u670D\u52A1\u5668\u7248\u672C\u8FC7\u4F4E\uFF0C\u8BF7\u5347\u7EA7\u670D\u52A1\u5668\u3002"});return}$A.modalError(e)}).finally(e=>{this.loadIng--})}}}},mt={};var ho=d(uo,lo,co,!1,po,null,null,null);function po(t){for(let s in mt)this[s]=mt[s]}var mo=function(){return ho.exports}(),go=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"dialog-complaint-info"},[e("div",{staticClass:"group-complaint-title"},[t._v(t._s(t.$L("\u533F\u540D\u4E3E\u62A5")))]),e("div",{staticClass:"group-complaint-warp"},[e("div",{staticClass:"group-complaint-title underline required"},[t._v(t._s(t.$L("\u8BF7\u9009\u62E9\u4E3E\u62A5\u7C7B\u578B"))+":")]),e("div",{staticClass:"group-complaint-list"},[e("List",t._l(t.typeList,function(i,a){return e("ListItem",{key:a,class:{active:t.typeId==i.id}},[e("div",{staticClass:"text",on:{click:function(o){return t.onSelectType(i)}}},[t._v(t._s(t.$L(i.label)))]),e("RadioGroup",{model:{value:t.typeId,callback:function(o){t.typeId=o},expression:"typeId"}},[e("Radio",{attrs:{label:i.id,"model-value":t.typeId}},[t._v("\xA0")])],1)],1)}),1)],1),e("div",{staticClass:"group-complaint-title required"},[t._v(t._s(t.$L("\u8BF7\u8F93\u5165\u4E3E\u62A5\u539F\u56E0"))+":")]),e("div",{staticClass:"group-complaint-reason"},[e("Input",{attrs:{type:"textarea",maxlength:"500",autosize:{minRows:4,maxRows:8},placeholder:t.$L("\u8BF7\u8F93\u5165\u586B\u5199\u8BE6\u7EC6\u7684\u4E3E\u62A5\u539F\u56E0\uFF0C\u4EE5\u4F7F\u6211\u4EEC\u66F4\u597D\u7684\u5E2E\u52A9\u4F60\u89E3\u51B3\u95EE\u9898")},model:{value:t.reason,callback:function(i){t.reason=i},expression:"reason"}})],1),e("div",{staticClass:"group-complaint-img"},[e("ImgUpload",{attrs:{num:5,width:512,height:512,whcut:1},model:{value:t.imgs,callback:function(i){t.imgs=i},expression:"imgs"}})],1)]),e("div",{staticClass:"group-info-button"},[e("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.onSubmit}},[t._v(t._s(t.$L("\u63D0\u4EA4")))])],1)])},fo=[];const _o={name:"DialogComplaint",components:{ImgUpload:$t},props:{dialogId:{type:Number,default:0}},data(){return{typeList:[{id:10,label:"\u8BC8\u9A97\u8BF1\u5BFC\u8F6C\u8D26"},{id:20,label:"\u5F15\u6D41\u4E0B\u8F7D\u5176\u4ED6APP\u4ED8\u8D39"},{id:30,label:"\u6572\u8BC8\u52D2\u7D22"},{id:40,label:"\u7167\u7247\u4E0E\u672C\u4EBA\u4E0D\u4E00\u81F4"},{id:50,label:"\u8272\u60C5\u4F4E\u4FD7"},{id:60,label:"\u9891\u7E41\u5E7F\u544A\u9A9A\u6270"},{id:70,label:"\u5176\u4ED6\u95EE\u9898"}],typeId:0,reason:"",imgs:[]}},methods:{onSelectType(t){this.typeId==t.id?this.typeId=0:this.typeId=t.id},onSubmit(){if(!this.typeId)return $A.modalError("\u8BF7\u9009\u62E9\u4E3E\u62A5\u7C7B\u578B");if(!this.reason)return $A.modalError("\u8BF7\u586B\u5199\u4E3E\u62A5\u539F\u56E0");this.$store.dispatch("call",{url:"complaint/submit",data:{dialog_id:this.dialogId,reason:this.reason,type:this.typeId,imgs:this.imgs}}).then(({data:t})=>{$A.modalSuccess("\u4E3E\u62A5\u6210\u529F"),this.$emit("on-close")}).catch(({msg:t})=>{$A.modalError(t)})}}},gt={};var vo=d(_o,go,fo,!1,$o,null,null,null);function $o(t){for(let s in gt)this[s]=gt[s]}var yo=function(){return vo.exports}(),wo=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.isReady?e("div",{staticClass:"dialog-wrapper",class:t.wrapperClass,on:{drop:function(i){return i.preventDefault(),t.chatPasteDrag(i,"drag")},dragover:function(i){return i.preventDefault(),t.chatDragOver(!0,i)},dragleave:function(i){return i.preventDefault(),t.chatDragOver(!1,i)},touchstart:t.onTouchStart,pointerover:t.onPointerover}},[e("div",{ref:"nav",staticClass:"dialog-nav"},[t._t("head",function(){return[e("div",{staticClass:"nav-wrapper",class:t.navClass},[e("div",{staticClass:"dialog-back",on:{click:t.onBack}},[e("i",{staticClass:"taskfont"},[t._v("\uE676")]),t.msgUnreadOnly?e("div",{staticClass:"back-num"},[t._v(t._s(t.msgUnreadOnly))]):t._e()]),e("div",{staticClass:"dialog-block"},[e("div",{staticClass:"dialog-avatar",on:{click:t.onViewAvatar}},[t.dialogData.type=="group"?[t.dialogData.avatar?e("EAvatar",{staticClass:"img-avatar",attrs:{src:t.dialogData.avatar,size:42}}):t.dialogData.group_type=="department"?e("i",{staticClass:"taskfont icon-avatar department"},[t._v("\uE75C")]):t.dialogData.group_type=="project"?e("i",{staticClass:"taskfont icon-avatar project"},[t._v("\uE6F9")]):t.dialogData.group_type=="task"?e("i",{staticClass:"taskfont icon-avatar task"},[t._v("\uE6F4")]):t.dialogData.group_type=="okr"?e("i",{staticClass:"taskfont icon-avatar task"},[t._v("\uE6F4")]):e("Icon",{staticClass:"icon-avatar",attrs:{type:"ios-people"}})]:t.dialogData.dialog_user?e("div",{staticClass:"user-avatar"},[e("UserAvatarTip",{attrs:{online:t.dialogData.online_state,userid:t.dialogData.dialog_user.userid,size:42},on:{"update:online":function(i){return t.$set(t.dialogData,"online_state",i)}}},[t.dialogData.type==="user"&&t.dialogData.online_state!==!0?e("p",{attrs:{slot:"end"},slot:"end"},[t._v(" "+t._s(t.$L(t.dialogData.online_state))+" ")]):t._e()])],1):e("Icon",{staticClass:"icon-avatar",attrs:{type:"md-person"}})],2),e("div",{staticClass:"dialog-title"},[e("div",{staticClass:"main-title"},[t._l(t.$A.dialogTags(t.dialogData),function(i){return i.color!="success"?[e("Tag",{attrs:{color:i.color,fade:!1}},[t._v(t._s(t.$L(i.text)))])]:t._e()}),e("h2",[t._v(t._s(t.dialogData.name))]),t.peopleNum>0?e("em",{on:{click:function(i){return t.onDialogMenu("groupInfo")}}},[t._v("("+t._s(t.peopleNum)+")")]):t._e(),t.dialogData.bot?e("Tag",{staticClass:"after",attrs:{fade:!1}},[t._v(t._s(t.$L("\u673A\u5668\u4EBA")))]):t._e(),t.dialogData.type==="user"&&t.approvaUserStatus?e("Tag",{staticClass:"after",attrs:{color:"red",fade:!1}},[t._v(t._s(t.$L(t.approvaUserStatus)))]):t._e(),t.dialogData.group_type=="all"?e("Tag",{staticClass:"after pointer",attrs:{fade:!1},on:{"on-click":function(i){return t.onDialogMenu("groupInfo")}}},[t._v(t._s(t.$L("\u5168\u5458")))]):t.dialogData.group_type=="department"?e("Tag",{staticClass:"after pointer",attrs:{fade:!1},on:{"on-click":function(i){return t.onDialogMenu("groupInfo")}}},[t._v(t._s(t.$L("\u90E8\u95E8")))]):t._e(),t.msgLoadIng>0&&t.allMsgs.length>0?e("div",{staticClass:"load"},[e("Loading")],1):t._e()],2),e("ul",{staticClass:"title-desc"},[t.dialogData.type==="user"?e("li",{class:[t.dialogData.online_state===!0?"online":"offline"]},[t._v(" "+t._s(t.$L(t.dialogData.online_state===!0?"\u5728\u7EBF":t.dialogData.online_state))+" ")]):t._e()]),t.tagShow?e("ul",{staticClass:"title-tags scrollbar-hidden"},t._l(t.msgTags,function(i){var a;return e("li",{key:i.type,class:(a={},a[i.type||"msg"]=!0,a.active=t.msgType===i.type,a),on:{click:function(o){return t.onMsgType(i.type)}}},[e("i",{staticClass:"no-dark-content"}),e("span",[t._v(t._s(t.$L(i.label)))])])}),0):t._e()])]),e("EDropdown",{staticClass:"dialog-menu",attrs:{trigger:"click"},on:{command:t.onDialogMenu}},[e("i",{staticClass:"taskfont dialog-menu-icon"},[t._v("\uE6E9")]),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("EDropdownItem",{attrs:{command:"searchMsg"}},[e("div",[t._v(t._s(t.$L("\u641C\u7D22\u6D88\u606F")))])]),t.dialogData.type==="user"?[t.isManageBot?e("EDropdownItem",{attrs:{command:"modifyNormal"}},[e("div",[t._v(t._s(t.$L("\u4FEE\u6539\u8D44\u6599")))])]):t._e(),e("EDropdownItem",{attrs:{command:"openCreate"}},[e("div",[t._v(t._s(t.$L("\u521B\u5EFA\u7FA4\u7EC4")))])]),t.dialogData.bot==0?e("EDropdownItem",{attrs:{command:"report"}},[e("div",[t._v(t._s(t.$L("\u4E3E\u62A5\u6295\u8BC9")))])]):t._e()]:[e("EDropdownItem",{attrs:{command:"groupInfo"}},[e("div",[t._v(t._s(t.$L("\u7FA4\u7EC4\u8BBE\u7F6E")))])]),t.dialogData.owner_id!=t.userId?[t.dialogData.group_type==="all"&&t.userIsAdmin?e("EDropdownItem",{attrs:{command:"modifyAdmin"}},[e("div",[t._v(t._s(t.$L("\u4FEE\u6539\u8D44\u6599")))])]):t._e(),e("EDropdownItem",{attrs:{command:"report"}},[e("div",[t._v(t._s(t.$L("\u4E3E\u62A5\u6295\u8BC9")))])]),e("EDropdownItem",{attrs:{command:"exit"}},[e("div",{staticStyle:{color:"#f00"}},[t._v(t._s(t.$L("\u9000\u51FA\u7FA4\u7EC4")))])])]:t.dialogData.group_type==="user"?[e("EDropdownItem",{attrs:{command:"modifyNormal"}},[e("div",[t._v(t._s(t.$L("\u4FEE\u6539\u8D44\u6599")))])]),e("EDropdownItem",{attrs:{command:"transfer"}},[e("div",[t._v(t._s(t.$L("\u8F6C\u8BA9\u7FA4\u4E3B")))])]),e("EDropdownItem",{attrs:{command:"report"}},[e("div",[t._v(t._s(t.$L("\u4E3E\u62A5\u6295\u8BC9")))])]),e("EDropdownItem",{attrs:{command:"disband"}},[e("div",{staticStyle:{color:"#f00"}},[t._v(t._s(t.$L("\u89E3\u6563\u7FA4\u7EC4")))])])]:t._e()]],2)],1),t.searchShow?e("div",{staticClass:"dialog-search"},[e("div",{staticClass:"search-location"},[e("i",{staticClass:"taskfont",on:{click:function(i){return t.onSearchSwitch("prev")}}},[t._v("\uE702")]),e("i",{staticClass:"taskfont",on:{click:function(i){return t.onSearchSwitch("next")}}},[t._v("\uE705")])]),e("div",{staticClass:"search-input"},[e("div",{staticClass:"search-pre"},[t.searchLoad>0?e("Loading"):e("Icon",{attrs:{type:"ios-search"}})],1),e("Input",{ref:"searchInput",attrs:{placeholder:t.$L("\u641C\u7D22\u6D88\u606F"),clearable:""},on:{"on-keyup":t.onSearchKeyup},model:{value:t.searchKey,callback:function(i){t.searchKey=i},expression:"searchKey"}}),t.searchLoad===0&&t.searchResult.length>0?e("div",{staticClass:"search-total"},[t._v(t._s(t.searchLocation)+"/"+t._s(t.searchResult.length))]):t._e()],1),e("div",{staticClass:"search-cancel",on:{click:function(i){return t.onSearchKeyup(null)}}},[t._v(t._s(t.$L("\u53D6\u6D88")))])]):t._e()],1)]})],2),t.topShow?e("div",{staticClass:"dialog-top-message",on:{click:t.onPosTop}},[e("div",{staticClass:"dialog-top-message-warp"},[t._m(0),e("div",{staticClass:"dialog-top-message-content"},[e("p",{staticClass:"content"},[e("UserAvatar",{attrs:{userid:t.topMsg.userid,showName:"",showIcon:!1}}),t._v(": "),e("span",[t._v(t._s(t.$A.getMsgSimpleDesc(t.topMsg)))])],1),e("p",{staticClass:"personnel"},[t._v(" "+t._s(t.$L("\u7F6E\u9876\u4EBA\u5458"))+" "),e("UserAvatar",{attrs:{userid:t.dialogData.top_userid,showName:"",showIcon:!1}})],1)]),e("div",{staticClass:"dialog-top-message-btn"},[t.topPosLoad>0?e("Loading",{attrs:{type:"pure"}}):e("i",{staticClass:"taskfont"},[t._v("\uEE15")]),e("i",{staticClass:"taskfont",on:{click:function(i){return i.stopPropagation(),t.onCancelTop(t.topMsg)}}},[t._v("\uE6E5")])],1)])]):t._e(),e("div",{ref:"msgs",staticClass:"dialog-msgs"},[t.positionShow&&t.positionMsg?e("div",{staticClass:"dialog-position"},[e("div",{staticClass:"position-label",on:{click:function(i){return t.onPositionMark(t.positionMsg.msg_id)}}},[t.positionLoad>0?e("Icon",{staticClass:"icon-loading",attrs:{type:"ios-loading"}}):e("i",{staticClass:"taskfont"},[t._v("\uE624")]),t._v(" "+t._s(t.positionMsg.label)+" ")],1)]):t._e(),e("VirtualList",{ref:"scroller",staticClass:"dialog-scroller scrollbar-virtual",attrs:{"active-prefix":"item","data-key":"id","data-sources":t.allMsgs,"data-component":t.msgItem,"extra-props":{dialogData:t.dialogData,operateVisible:t.operateVisible,operateItem:t.operateItem,pointerMouse:t.pointerMouse,isMyDialog:t.isMyDialog,msgId:t.msgId,unreadOne:t.unreadOne,scrollIng:t.scrollIng,readEnabled:t.readEnabled},"estimate-size":t.dialogData.type=="group"?105:77,keeps:t.dialogMsgKeep,disabled:t.scrollDisabled},on:{activity:t.onActivity,scroll:t.onScroll,range:t.onRange,totop:t.onPrevPage,"on-mention":t.onMention,"on-longpress":t.onLongpress,"on-view-reply":t.onViewReply,"on-view-text":t.onViewText,"on-view-file":t.onViewFile,"on-down-file":t.onDownFile,"on-reply-list":t.onReplyList,"on-error":t.onError,"on-emoji":t.onEmoji,"on-other":t.onOther,"on-show-emoji-user":t.onShowEmojiUser},scopedSlots:t._u([t.isChildComponent?null:{key:"header",fn:function(){return[e("div",{staticClass:"dialog-item head-box"},[t.loadIng>0||t.prevId>0?e("div",{staticClass:"loading",class:{filled:t.allMsgs.length===0}},[t.scrollOffset<100?e("span"):t._e()]):t.allMsgs.length===0?e("div",{staticClass:"describe filled"},[t._v(t._s(t.$L("\u6682\u65E0\u6D88\u606F")))]):t._e()])]},proxy:!0}],null,!0)})],1),e("div",{ref:"footer",staticClass:"dialog-footer",on:{click:t.onActive}},[t.scrollTail>500||t.msgNew>0&&t.allMsgs.length>0?e("div",{directives:[{name:"touchclick",rawName:"v-touchclick",value:t.onToBottom,expression:"onToBottom"}],staticClass:"dialog-goto"},[e("Badge",{attrs:{"overflow-count":999,count:t.msgNew}},[e("i",{staticClass:"taskfont"},[t._v("\uE72B")])])],1):t._e(),e("DialogUpload",{ref:"chatUpload",staticClass:"chat-upload",attrs:{"dialog-id":t.dialogId,maxSize:t.maxSize},on:{"on-progress":function(i){return t.chatFile("progress",i)},"on-success":function(i){return t.chatFile("success",i)},"on-error":function(i){return t.chatFile("error",i)}}}),t.todoShow?e("div",{staticClass:"chat-bottom-menu"},[e("div",{staticClass:"bottom-menu-label"},[t._v(t._s(t.$L("\u5F85\u529E"))+":")]),e("ul",{staticClass:"scrollbar-hidden"},t._l(t.todoList,function(i){return e("li",{on:{click:function(a){return a.stopPropagation(),t.onViewTodo(i)}}},[e("div",{staticClass:"bottom-menu-desc no-dark-content"},[t._v(t._s(t.$A.getMsgSimpleDesc(i.msg_data)))])])}),0)]):t.quickShow?e("div",{staticClass:"chat-bottom-menu"},[e("ul",{staticClass:"scrollbar-hidden"},t._l(t.quickMsgs,function(i){return e("li",{on:{click:function(a){return a.stopPropagation(),t.sendQuick(i)}}},[e("div",{staticClass:"bottom-menu-desc no-dark-content",style:i.style||null},[t._v(t._s(i.label))])])}),0)]):t._e(),t.isMute?e("div",{staticClass:"chat-mute"},[t._v(" "+t._s(t.$L("\u7981\u8A00\u53D1\u8A00"))+" ")]):e("ChatInput",{ref:"input",attrs:{"dialog-id":t.dialogId,"emoji-bottom":t.windowPortrait,maxlength:2e5,placeholder:t.$L("\u8F93\u5165\u6D88\u606F..."),"reply-msg-auto-mention":t.replyMsgAutoMention},on:{"on-focus":t.onEventFocus,"on-blur":t.onEventBlur,"on-more":t.onEventMore,"on-file":t.sendFileMsg,"on-send":t.sendMsg,"on-record":t.sendRecord,"on-record-state":t.onRecordState},model:{value:t.msgText,callback:function(i){t.msgText=i},expression:"msgText"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.operateVisible,expression:"operateVisible"}],staticClass:"operate-position",style:t.operateStyles},[e("Dropdown",{ref:"operate",attrs:{trigger:"custom",placement:"top",visible:t.operateVisible,transferClassName:"dialog-wrapper-operate",transfer:""},on:{"on-clickoutside":function(i){t.operateVisible=!1}}},[e("div",{style:{userSelect:t.operateVisible?"none":"auto",height:t.operateStyles.height}}),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t.operateItem.created_at?[e("DropdownItem",{attrs:{name:"action"}},[e("ul",{staticClass:"operate-action"},[t.msgId===0?e("li",{on:{click:function(i){return t.onOperate("reply")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),e("span",[t._v(t._s(t.$L("\u56DE\u590D")))])]):t._e(),t.operateItem.userid==t.userId&&t.operateItem.type==="text"?e("li",{on:{click:function(i){return t.onOperate("update")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE779")]),e("span",[t._v(t._s(t.$L("\u7F16\u8F91")))])]):t._e(),t.actionPermission(t.operateItem,"voice2text")?e("li",{on:{click:function(i){return t.onOperate("voice2text")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE628")]),e("span",[t._v(t._s(t.$L("\u8F6C\u6587\u5B57")))])]):t._e(),t.actionPermission(t.operateItem,"translation")?e("li",{on:{click:function(i){return t.onOperate("translation")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE795")]),e("span",[t._v(t._s(t.$L("\u7FFB\u8BD1")))])]):t._e(),t._l(t.operateCopys,function(i){return e("li",{on:{click:function(a){return t.onOperate("copy",i)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(i.icon)}}),e("span",[t._v(t._s(t.$L(i.label)))])])}),t.actionPermission(t.operateItem,"forward")?e("li",{on:{click:function(i){return t.onOperate("forward")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE638")]),e("span",[t._v(t._s(t.$L("\u8F6C\u53D1")))])]):t._e(),t.operateItem.userid==t.userId?e("li",{on:{click:function(i){return t.onOperate("withdraw")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE637")]),e("span",[t._v(t._s(t.$L("\u64A4\u56DE")))])]):t._e(),t.operateItem.type==="file"?[e("li",{on:{click:function(i){return t.onOperate("view")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE77B")]),e("span",[t._v(t._s(t.$L("\u67E5\u770B")))])]),e("li",{on:{click:function(i){return t.onOperate("down")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7A8")]),e("span",[t._v(t._s(t.$L("\u4E0B\u8F7D")))])])]:t._e(),e("li",{on:{click:function(i){return t.onOperate("tag")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE61E")]),e("span",[t._v(t._s(t.$L(t.operateItem.tag?"\u53D6\u6D88\u6807\u6CE8":"\u6807\u6CE8")))])]),t.actionPermission(t.operateItem,"newTask")?e("li",{on:{click:function(i){return t.onOperate("newTask")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7B8")]),e("span",[t._v(t._s(t.$L("\u65B0\u4EFB\u52A1")))])]):t._e(),e("li",{on:{click:function(i){return t.onOperate("todo")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE7B7")]),e("span",[t._v(t._s(t.$L(t.operateItem.todo?"\u53D6\u6D88\u5F85\u529E":"\u8BBE\u5F85\u529E")))])]),e("li",{on:{click:function(i){return t.onOperate("top")}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(t.dialogData.top_msg_id==t.operateItem.id?"&#xe7e3;":"&#xe7e6;")}}),e("span",[t._v(t._s(t.$L(t.dialogData.top_msg_id==t.operateItem.id?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876")))])]),t.msgType!==""?e("li",{on:{click:function(i){return t.onOperate("pos")}}},[e("i",{staticClass:"taskfont"},[t._v("\uEE15")]),e("span",[t._v(t._s(t.$L("\u5B8C\u6574\u5BF9\u8BDD")))])]):t._e()],2)]),e("DropdownItem",{staticClass:"dropdown-emoji",attrs:{name:"emoji"}},[e("ul",{staticClass:"operate-emoji scrollbar-hidden"},[t._l(t.operateEmojis,function(i,a){return e("li",{key:a,staticClass:"no-dark-content",domProps:{innerHTML:t._s(i)},on:{click:function(o){return t.onOperate("emoji",i)}}})}),e("li"),e("li",{staticClass:"more-emoji",on:{click:function(i){return t.onOperate("emoji","more")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE790")])])],2)])]:[e("DropdownItem",{attrs:{name:"action"}},[e("ul",{staticClass:"operate-action cancel"},[e("li",{on:{click:function(i){return t.onOperate("cancel")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),e("span",[t._v(t._s(t.$L("\u53D6\u6D88\u53D1\u9001")))])])])])]],2)],1)],1),t.dialogDrag?e("div",{staticClass:"drag-over",on:{click:function(i){t.dialogDrag=!1}}},[e("div",{staticClass:"drag-text"},[t._v(t._s(t.$L("\u62D6\u52A8\u5230\u8FD9\u91CC\u53D1\u9001")))])]):t._e(),e("Modal",{attrs:{title:t.$L(t.pasteTitle),"cancel-text":t.$L("\u53D6\u6D88"),"ok-text":t.$L("\u53D1\u9001"),"enter-ok":!0,closable:!1,"mask-closable":!1},on:{"on-ok":t.pasteSend},model:{value:t.pasteShow,callback:function(i){t.pasteShow=i},expression:"pasteShow"}},[e("ul",{staticClass:"dialog-wrapper-paste",class:t.pasteClass},t._l(t.pasteItem,function(i){return e("li",[i.type=="image"?e("img",{attrs:{src:i.result}}):e("div",[t._v(t._s(t.$L("\u6587\u4EF6"))+": "+t._s(i.name)+" ("+t._s(t.$A.bytesToSize(i.size))+")")])])}),0)]),e("Modal",{attrs:{title:t.$L("\u4FEE\u6539\u8D44\u6599"),"mask-closable":!1},model:{value:t.modifyShow,callback:function(i){t.modifyShow=i},expression:"modifyShow"}},[e("Form",t._b({attrs:{model:t.modifyData},nativeOn:{submit:function(i){i.preventDefault()}}},"Form",t.formOptions,!1),[t.modifyData.system_name?e("Alert",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"error"}},[t._v(t._s(t.$L(`\u6B63\u5728\u4FEE\u6539\u7CFB\u7EDF\u673A\u5668\u4EBA\uFF1A${t.modifyData.system_name}`)))]):t._e(),e("FormItem",{attrs:{prop:"avatar",label:t.$L("\u5934\u50CF")}},[e("ImgUpload",{attrs:{num:1,width:512,height:512,whcut:1},model:{value:t.modifyData.avatar,callback:function(i){t.$set(t.modifyData,"avatar",i)},expression:"modifyData.avatar"}})],1),typeof t.modifyData.name!="undefined"?e("FormItem",{attrs:{prop:"name",label:t.$L("\u540D\u79F0")}},[e("Input",{attrs:{maxlength:20},model:{value:t.modifyData.name,callback:function(i){t.$set(t.modifyData,"name",i)},expression:"modifyData.name"}})],1):t._e(),t.dialogData.bot==t.userId?[typeof t.modifyData.clear_day!="undefined"?e("FormItem",{attrs:{prop:"clear_day",label:t.$L("\u6D88\u606F\u4FDD\u7559")}},[e("Input",{attrs:{maxlength:3,type:"number"},model:{value:t.modifyData.clear_day,callback:function(i){t.$set(t.modifyData,"clear_day",i)},expression:"modifyData.clear_day"}},[e("div",{attrs:{slot:"append"},slot:"append"},[t._v(t._s(t.$L("\u5929")))])])],1):t._e(),typeof t.modifyData.webhook_url!="undefined"?e("FormItem",{attrs:{prop:"webhook_url",label:"Webhook"}},[e("Input",{attrs:{maxlength:255},model:{value:t.modifyData.webhook_url,callback:function(i){t.$set(t.modifyData,"webhook_url",i)},expression:"modifyData.webhook_url"}})],1):t._e()]:t._e()],2),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.modifyShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.modifyLoad>0},on:{click:t.onModify}},[t._v(t._s(t.$L("\u4FDD\u5B58")))])],1)],1),e("UserSelect",{ref:"forwardSelect",attrs:{"multiple-max":50,title:t.$L("\u8F6C\u53D1"),"before-submit":t.onForwardBefore,"show-select-all":!1,"show-dialog":"",module:""}}),e("Modal",{attrs:{title:`${t.$L("\u8F6C\u53D1\u7ED9")}:`,"class-name":"common-user-select-modal dialog-forward-message-modal","mask-closable":!1,width:"420"},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",{staticClass:"dialog-wrapper-forward-footer",class:{selected:!t.forwardSource},on:{click:function(i){t.forwardSource=!t.forwardSource}}},[e("Icon",{staticClass:"user-modal-icon",attrs:{type:t.forwardSource?"ios-radio-button-off":"ios-checkmark-circle"}}),e("span",{staticClass:"forward-text-tip"},[t._v(t._s(t.$L("\u4E0D\u663E\u793A\u539F\u53D1\u9001\u8005\u4FE1\u606F")))])],1),e("Button",{attrs:{type:"primary",loading:t.forwardLoad>0},on:{click:t.onForwardAffirm}},[t._v(" "+t._s(t.$L("\u786E\u5B9A"))+" "),t.forwardData.length>0?[t._v("("+t._s(t.forwardData.length)+")")]:t._e()],2)]},proxy:!0}],null,!1,3006296953),model:{value:t.forwardhow,callback:function(i){t.forwardhow=i},expression:"forwardhow"}},[e("div",{staticClass:"user-modal-search"},[e("Scrollbar",{staticClass:"search-selected",attrs:{"enable-x":"","enable-y":!1}},[e("ul",t._l(t.forwardData,function(i){return e("li",{attrs:{"data-id":i.userid}},[i.type=="group"?e("div",{staticClass:"user-modal-avatar"},[i.avatar?e("EAvatar",{staticClass:"img-avatar",attrs:{src:i.avatar,size:32}}):i.group_type=="department"?e("i",{staticClass:"taskfont icon-avatar department"},[t._v("\uE75C")]):i.group_type=="project"?e("i",{staticClass:"taskfont icon-avatar project"},[t._v("\uE6F9")]):i.group_type=="task"?e("i",{staticClass:"taskfont icon-avatar task"},[t._v("\uE6F4")]):i.group_type=="okr"?e("i",{staticClass:"taskfont icon-avatar task"},[t._v("\uE6F4")]):e("Icon",{staticClass:"icon-avatar",attrs:{type:"ios-people"}}),t.forwardData.length==1?e("div",{staticClass:"avatar-name"},[e("span",[t._v(t._s(i.name))])]):t._e()],1):e("UserAvatar",{attrs:{userid:i.userid,size:32,"show-name":t.forwardData.length==1}})],1)}),0)])],1),e("div",{staticClass:"twice-affirm-body-extend"},[e("div",{staticClass:"dialog-wrapper-forward-body"},[e("div",{staticClass:"dialog-wrapper inde-list"},[e("Scrollbar",{attrs:{"class-name":"dialog-scroller"}},[e("DialogItem",{attrs:{source:t.operateItem,simpleView:""},on:{"on-view-text":t.onViewText,"on-view-file":t.onViewFile,"on-down-file":t.onDownFile,"on-emoji":t.onEmoji,"on-other":t.onOther}})],1)],1),e("div",{staticClass:"leave-message"},[t.forwardDialogId>0?e("ChatInput",{attrs:{"dialog-id":t.forwardDialogId,"emoji-bottom":t.windowPortrait,maxlength:2e5,placeholder:t.$L("\u7559\u8A00"),"disabled-record":"","simple-mode":""},model:{value:t.forwardMessage,callback:function(i){t.forwardMessage=i},expression:"forwardMessage"}}):e("Input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:3},maxlength:2e5,placeholder:t.$L("\u7559\u8A00"),clearable:""},model:{value:t.forwardMessage,callback:function(i){t.forwardMessage=i},expression:"forwardMessage"}})],1)])])]),e("Modal",{attrs:{title:t.$L("\u8BBE\u7F6E\u5F85\u529E"),"mask-closable":!1},model:{value:t.todoSettingShow,callback:function(i){t.todoSettingShow=i},expression:"todoSettingShow"}},[e("Form",t._b({ref:"todoSettingForm",attrs:{model:t.todoSettingData},nativeOn:{submit:function(i){i.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{prop:"type",label:t.$L("\u5F53\u524D\u4F1A\u8BDD")}},[e("RadioGroup",{on:{"on-change":t.onTypeChange},model:{value:t.todoSettingData.type,callback:function(i){t.$set(t.todoSettingData,"type",i)},expression:"todoSettingData.type"}},[e("Radio",{attrs:{label:"all"}},[t._v(t._s(t.$L("\u6240\u6709\u6210\u5458")))]),e("Radio",{attrs:{label:"user"}},[t._v(t._s(t.$L("\u6307\u5B9A\u6210\u5458")))]),e("Radio",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"quick_select"}})],1),e("CheckboxGroup",{on:{"on-change":t.onQuickChange},model:{value:t.todoSettingData.quick_value,callback:function(i){t.$set(t.todoSettingData,"quick_value",i)},expression:"todoSettingData.quick_value"}},t._l(t.todoSettingData.quick_list,function(i){return e("Checkbox",{key:i,attrs:{label:i}},[e("div",{staticClass:"dialog-wrapper-todo"},[e("div",[e("UserAvatar",{attrs:{userid:i,"show-icon":!1,"show-name":!0}}),i==t.userId?e("Tag",[t._v(t._s(t.$L("\u81EA\u5DF1")))]):t._e()],1)])])}),1)],1),t.todoSettingData.type==="user"?e("FormItem",{attrs:{prop:"userids",label:t.$L("\u6307\u5B9A\u6210\u5458")}},[e("UserSelect",{ref:"userSelect",attrs:{"dialog-id":t.dialogId,title:t.$L("\u9009\u62E9\u6307\u5B9A\u6210\u5458")},model:{value:t.todoSettingData.userids,callback:function(i){t.$set(t.todoSettingData,"userids",i)},expression:"todoSettingData.userids"}})],1):t._e()],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.todoSettingShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.todoSettingLoad>0},on:{click:function(i){return t.onTodo("submit")}}},[t._v(t._s(t.$L("\u786E\u5B9A")))])],1)],1),t.todoSpecifyShow?e("UserSelect",{ref:"todoSpecifySelect",attrs:{"dialog-id":t.dialogId,title:t.$L("\u9009\u62E9\u6307\u5B9A\u6210\u5458"),module:"",border:"","before-submit":t.onTodoSpecify},model:{value:t.todoSpecifyData.userids,callback:function(i){t.$set(t.todoSpecifyData,"userids",i)},expression:"todoSpecifyData.userids"}}):t._e(),e("DrawerOverlay",{attrs:{placement:"right",size:400},model:{value:t.groupInfoShow,callback:function(i){t.groupInfoShow=i},expression:"groupInfoShow"}},[t.groupInfoShow?e("DialogGroupInfo",{attrs:{dialogId:t.dialogId},on:{"on-close":function(i){t.groupInfoShow=!1}}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:500},model:{value:t.reportShow,callback:function(i){t.reportShow=i},expression:"reportShow"}},[t.reportShow?e("DialogComplaint",{attrs:{dialogId:t.dialogId},on:{"on-close":function(i){t.reportShow=!1}}}):t._e()],1),e("Modal",{attrs:{title:t.$L("\u8F6C\u8BA9\u7FA4\u4E3B\u8EAB\u4EFD"),"mask-closable":!1},model:{value:t.groupTransferShow,callback:function(i){t.groupTransferShow=i},expression:"groupTransferShow"}},[e("Form",t._b({attrs:{model:t.groupTransferData},nativeOn:{submit:function(i){i.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{prop:"userid",label:t.$L("\u65B0\u7684\u7FA4\u4E3B")}},[e("UserSelect",{attrs:{disabledChoice:t.groupTransferData.disabledChoice,"multiple-max":1,title:t.$L("\u9009\u62E9\u65B0\u7684\u7FA4\u4E3B")},model:{value:t.groupTransferData.userid,callback:function(i){t.$set(t.groupTransferData,"userid",i)},expression:"groupTransferData.userid"}})],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(i){t.groupTransferShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.groupTransferLoad>0},on:{click:function(i){return t.onDialogMenu("transferConfirm")}}},[t._v(t._s(t.$L("\u786E\u5B9A\u8F6C\u8BA9")))])],1)],1),e("DrawerOverlay",{attrs:{placement:"right","class-name":"dialog-wrapper-drawer-list",size:500},model:{value:t.replyListShow,callback:function(i){t.replyListShow=i},expression:"replyListShow"}},[t.replyListShow?e("DialogWrapper",{staticClass:"inde-list",attrs:{dialogId:t.dialogId,msgId:t.replyListId,isChildComponent:""}},[e("div",{staticClass:"drawer-title",attrs:{slot:"head"},slot:"head"},[t._v(t._s(t.$L("\u56DE\u590D\u6D88\u606F")))])]):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:400},model:{value:t.respondShow,callback:function(i){t.respondShow=i},expression:"respondShow"}},[t.respondShow?e("DialogRespond",{attrs:{"respond-data":t.respondData},on:{"on-close":function(i){t.respondShow=!1}}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right","class-name":"dialog-wrapper-drawer-list",size:500},model:{value:t.todoViewShow,callback:function(i){t.todoViewShow=i},expression:"todoViewShow"}},[e("div",{staticClass:"dialog-wrapper inde-list"},[e("div",{staticClass:"dialog-nav"},[e("div",{staticClass:"drawer-title"},[t._v(t._s(t.$L("\u5F85\u529E\u6D88\u606F")))])]),e("Scrollbar",{attrs:{"class-name":"dialog-scroller"}},[t.todoViewMsg?[e("DialogItem",{attrs:{source:t.todoViewMsg,simpleView:""},on:{"on-view-text":t.onViewText,"on-view-file":t.onViewFile,"on-down-file":t.onDownFile,"on-emoji":t.onEmoji,"on-other":t.onOther}}),e("Button",{staticClass:"original-button",attrs:{icon:"md-exit",type:"text",loading:t.todoViewPosLoad},on:{click:t.onPosTodo}},[t._v(t._s(t.$L("\u56DE\u5230\u539F\u6587")))])]:e("div",{staticClass:"dialog-float-loading"},[e("Loading")],1)],2),e("div",{staticClass:"todo-button"},[e("Button",{attrs:{type:"primary",size:"large",icon:"md-checkbox-outline",loading:t.todoViewLoad,long:""},on:{click:t.onDoneTodo}},[t._v(t._s(t.$L("\u5B8C\u6210")))])],1)],1)]),e("DialogGroupWordChain"),e("DialogGroupVote")],1):t._e()},ko=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"dialog-top-message-font"},[e("i",{staticClass:"taskfont"},[t._v("\uE7E6")])])}];const Co={name:"DialogWrapper",components:{UserAvatarTip:Mt,UserSelect:vt,ImgUpload:$t,DialogRespond:Pa,DialogItem:it,VirtualList:It,ChatInput:eo,DialogGroupInfo:ja,DrawerOverlay:Dt,DialogUpload:Sa,DialogGroupWordChain:no,DialogGroupVote:mo,DialogComplaint:yo},directives:{touchclick:kt},props:{dialogId:{type:Number,default:0},msgId:{type:Number,default:0},autoFocus:{type:Boolean,default:!1},location:{type:String,default:""},isChildComponent:{type:Boolean,default:!1},beforeBack:Function},data(){return{loadIng:0,msgItem:it,msgText:"",msgNew:0,msgType:"",msgActivity:!1,msgPrepared:!1,focusLazy:!1,focusTimer:null,allMsgs:[],tempMsgs:[],tempId:$A.randNum(1e9,9999999999),msgLoadIng:0,msgActiveId:0,pasteShow:!1,pasteFile:[],pasteItem:[],searchShow:!1,searchKey:"",searchLoad:0,searchLocation:1,searchResult:[],modifyShow:!1,modifyData:{},modifyLoad:0,forwardhow:!1,forwardData:[],forwardLoad:0,forwardDialogId:0,forwardMessage:"",forwardSource:!0,openId:0,errorId:0,dialogDrag:!1,groupInfoShow:!1,reportShow:!1,groupTransferShow:!1,groupTransferLoad:0,groupTransferData:{userid:[],disabledChoice:[]},operateClient:{x:0,y:0},operateVisible:!1,operatePreventScroll:0,operateCopys:[],operateStyles:{},operateItem:{},recordState:"",pointerMouse:!1,scrollTail:0,scrollOffset:0,replyListShow:!1,replyListId:0,respondShow:!1,respondData:{},todoSettingShow:!1,todoSettingLoad:0,todoSettingData:{type:"all",userids:[],quick_value:[]},todoSpecifyShow:!1,todoSpecifyData:{type:"user",userids:[]},todoViewLoad:!1,todoViewPosLoad:!1,todoViewShow:!1,todoViewData:{},todoViewMid:0,todoViewId:0,scrollDisabled:!1,scrollDirection:null,scrollAction:0,scrollTmp:0,scrollIng:0,scrollGroup:null,approvaUserStatus:"",observers:[],msgChangeCache:{},unreadOne:0,topPosLoad:0,positionLoad:0,positionShow:!1,preventMoreLoad:!1,preventToBottom:!1,scrollToBottomRefresh:!1,androidKeyboardVisible:!1,replyMsgAutoMention:!1,waitUnreadData:{}}},mounted(){this.subMsgListener(),this.msgSubscribe=_.Store.subscribe("dialogMsgChange",this.onMsgChange)},beforeDestroy(){this.subMsgListener(!0),this.isChildComponent||(this.$store.dispatch("forgetInDialog",this._uid),this.$store.dispatch("closeDialog",this.dialogId)),this.msgSubscribe&&(this.msgSubscribe.unsubscribe(),this.msgSubscribe=null),this.observers.forEach(({observer:s})=>s.disconnect()),this.observers=[];const t=this.$refs.scroller;t&&t.virtual.destroy()},computed:{...m(["systemConfig","userIsAdmin","taskId","dialogSearchMsgId","dialogMsgs","dialogTodos","dialogMsgTops","dialogMsgTransfer","dialogMsgKeep","dialogIns","cacheDialogs","wsOpenNum","touchBackInProgress","cacheUserBasic","fileLinks","cacheEmojis","readLoadNum","readTimeout","keyboardType","keyboardHeight","safeAreaBottom","formOptions","cacheTranslationLanguage"]),..._t(["isLoad"]),isReady(){return this.dialogId>0&&this.dialogData.id>0},dialogData(){const t=this.cacheDialogs.find(({id:s})=>s==this.dialogId)||{};return this.unreadOne===0&&(this.unreadOne=t.unread_one||0),t},dialogList(){return this.cacheDialogs.filter(t=>!(t.name===void 0||t.dialog_delete===1)).sort((t,s)=>t.top_at||s.top_at?$A.dayjs(s.top_at)-$A.dayjs(t.top_at):t.todo_num>0||s.todo_num>0?s.todo_num-t.todo_num:$A.dayjs(s.last_at)-$A.dayjs(t.last_at))},dialogMsgList(){return this.isReady?this.dialogMsgs.filter(t=>t.dialog_id==this.dialogId):[]},tempMsgList(){return this.isReady?this.tempMsgs.filter(t=>t.dialog_id==this.dialogId):[]},allMsgList(){const t=[];if(t.push(...this.dialogMsgList.filter(s=>this.msgFilter(s))),this.msgId>0){const s=this.dialogMsgs.find(e=>e.id==this.msgId);s&&t.unshift(s)}if(this.tempMsgList.length>0){const s=t.map(({id:i})=>i),e=this.tempMsgList.filter(i=>!s.includes(i.id)&&this.msgFilter(i));e.length>0&&t.push(...e)}return t.sort((s,e)=>s.id-e.id)},loadMsg(){return this.isLoad(`msg::${this.dialogId}-${this.msgId}-${this.msgType}`)},prevId(){return this.allMsgs.length>0?$A.runNum(this.allMsgs[0].prev_id):0},peopleNum(){return this.dialogData.type==="group"?$A.runNum(this.dialogData.people):0},pasteTitle(){const{pasteItem:t}=this;let s=t.find(({type:i})=>i=="image"),e=t.find(({type:i})=>i!="image");return s&&e?"\u53D1\u9001\u6587\u4EF6/\u56FE\u7247":s?"\u53D1\u9001\u56FE\u7247":"\u53D1\u9001\u6587\u4EF6"},msgTags({dialogData:t}){const s=[{type:"",label:"\u6D88\u606F"}];return t.has_tag&&s.push({type:"tag",label:"\u6807\u6CE8"}),t.has_todo&&s.push({type:"todo",label:"\u4E8B\u9879"}),t.has_image&&s.push({type:"image",label:"\u56FE\u7247"}),t.has_file&&s.push({type:"file",label:"\u6587\u4EF6"}),t.has_link&&s.push({type:"link",label:"\u94FE\u63A5"}),t.group_type==="project"&&s.push({type:"project",label:"\u6253\u5F00\u9879\u76EE"}),t.group_type==="task"&&s.push({type:"task",label:"\u6253\u5F00\u4EFB\u52A1"}),t.group_type==="okr"&&s.push({type:"okr",label:"\u6253\u5F00OKR"}),s},topMsg(){return this.dialogData.top_msg_id&&this.dialogMsgTops.find(({id:t})=>t==this.dialogData.top_msg_id)},quickMsgs(){return this.dialogData.quick_msgs||[]},todoList(){return this.dialogData.todo_num?this.dialogTodos.filter(t=>!t.done_at&&t.dialog_id==this.dialogId).sort((t,s)=>s.id-t.id):[]},isDefaultSize(){return this.windowScrollY===0&&!this.androidKeyboardVisible},quickShow(){return this.quickMsgs.length>0&&this.isDefaultSize&&this.quoteId===0},todoShow(){return this.todoList.length>0&&this.isDefaultSize&&this.quoteId===0},tagShow(){return this.msgTags.length>1&&this.isDefaultSize&&!this.searchShow},topShow(){return this.topMsg&&this.isDefaultSize&&!this.searchShow&&this.msgType===""},wrapperClass(){return["ready","ing"].includes(this.recordState)?"record-ready":null},navClass(){return{completed:$A.dialogCompleted(this.dialogData),tagged:this.tagShow}},pasteClass(){return this.pasteItem.find(({type:t})=>t!=="image")?["multiple"]:[]},footerPaddingBottom({keyboardType:t,keyboardHeight:s,safeAreaBottom:e,windowScrollY:i,location:a,focusLazy:o}){return i<2&&a&&o&&t==="show"&&s>0&&s<120?s+e+(a==="modal"?15:0):0},msgUnreadOnly(){let t=0;return this.cacheDialogs.some(s=>{t+=$A.getDialogNum(s)}),t<=0?"":(t>999&&(t="999+"),String(t))},isMyDialog(){const{dialogData:t,userId:s}=this;return t.dialog_user&&t.dialog_user.userid==s},isManageBot(){const{dialogData:t,userId:s,userIsAdmin:e}=this;return t.bot?t.bot==s?!0:t.dialog_user&&t.dialog_user.userid==t.bot&&e:!1},isMute(){return this.dialogData.dialog_mute==="close"?!this.userIsAdmin:!1},quoteId(){return this.msgId>0?this.msgId:this.dialogData.extra_quote_id||0},quoteData(){return this.quoteId?this.allMsgs.find(({id:t})=>t===this.quoteId):null},todoViewMsg(){if(this.todoViewMid){const t=this.allMsgs.find(s=>s.id==this.todoViewMid);if(t)return t;if(this.todoViewData.id===this.todoViewMid)return this.todoViewData}return null},positionMsg({msgNew:t,dialogData:s,allMsgs:e}){const{unread:i,unread_one:a,mention:o,mention_ids:r}=s,n=i-t,l=[];return a&&l.push({type:"unread",label:this.$L(`\u672A\u8BFB\u6D88\u606F${n}\u6761`),msg_id:a}),r&&r.length>0&&l.push(...r.map(c=>({type:"mention",label:this.$L("@\u6211\u7684\u6D88\u606F"),msg_id:c}))),n<=0||l.length===0||e.length===0?null:l.find(c=>c.type===(o===0?"unread":"mention"))||l[0]},operateEmojis({cacheEmojis:t}){const s=t.slice(0,3);return Object.values(["\u{1F44C}","\u{1F44D}","\u{1F602}","\u{1F389}","\u2764\uFE0F","\u{1F973}\uFE0F","\u{1F970}","\u{1F625}","\u{1F62D}"]).some(e=>{s.includes(e)||s.push(e)}),s},maxSize({systemConfig:t}){return t!=null&&t.file_upload_limit?t.file_upload_limit*1024:1024e3},readEnabled({msgActivity:t,msgPrepared:s}){return t===0&&s},stickToBottom({windowActive:t,scrollTail:s,preventToBottom:e}){return t&&s<=0&&!e}},watch:{$route:{handler(t){const{name:s,params:e}=t||{};s=="manage-messenger"&&e.dialog_id&&e.open&&["word-chain","vote"].includes(e.open)&&this.$nextTick(i=>{this.$store.state[e.open=="word-chain"?"dialogDroupWordChain":"dialogGroupVote"]={type:"create",dialog_id:e.dialog_id},e.open=""})},immediate:!0},dialogId:{handler(t,s){this.getDialogBase(t,s),this.$store.dispatch("closeDialog",s),window.localStorage.removeItem("__cache:vote__"),window.localStorage.removeItem("__cache:unfoldWordChain__")},immediate:!0},loadMsg:{handler(t){t?this.loadIng++:setTimeout(s=>{this.loadIng--},300)},immediate:!0},isReady:{handler(t){!t||this.$nextTick(s=>{if(this.$refs.msgs&&!this.observers.find(({key:e})=>e==="scroller")){const e=new ResizeObserver(this.onResizeEvent);e.observe(this.$refs.msgs),this.observers.push({key:"scroller",observer:e})}if(this.$refs.scroller&&(this.scrollGroup=this.$refs.scroller.$el.querySelector('[role="group"]'),this.scrollGroup&&!this.observers.find(({key:e})=>e==="scrollGroup"))){const e=new ResizeObserver(this.onResizeEvent);e.observe(this.scrollGroup),this.observers.push({key:"scrollGroup",observer:e})}})},immediate:!0},msgType(){this.getMsgs({dialog_id:this.dialogId,msg_id:this.msgId,msg_type:this.msgType,clear_before:!0}).catch(t=>{})},searchKey(t){!t||(this.searchLoad++,setTimeout(s=>{this.searchKey===t&&(this.searchLoad++,this.searchResult=[],this.searchLocation=0,this.$store.dispatch("call",{url:"dialog/msg/search",data:{dialog_id:this.dialogId,key:t}}).then(({data:e})=>{this.searchKey===t&&(e.data.length===0&&$A.messageWarning("\u6CA1\u6709\u627E\u5230\u76F8\u5173\u6D88\u606F"),this.searchResult=e.data,this.searchLocation=this.searchResult.length)}).finally(e=>{this.searchLoad--})),this.searchLoad--},600))},searchLocation(t){if(t===0)return;const s=this.searchResult[t-1];s&&this.onPositionId(s)},dialogSearchMsgId(){this.onSearchMsgId()},dialogMsgTransfer:{handler({time:t,msgFile:s,msgRecord:e,msgText:i,dialogId:a}){t>$A.dayjs().unix()&&a==this.dialogId&&(this.$store.state.dialogMsgTransfer.time=0,this.$nextTick(()=>{$A.isArray(s)&&s.length>0?this.sendFileMsg(s):$A.isJson(e)&&e.duration>0?this.sendRecord(e):i&&this.sendMsg(i)}))},immediate:!0},wsOpenNum(t){if(t<=1)return;const s=this.allMsgs[this.allMsgs.length-1];if($A(this.$refs.scroller.$el).find(`[data-id="${s.id}"]`).length===0){this.scrollToBottomRefresh=!0;return}this.errorId===this.dialogId?this.getDialogBase(this.dialogId):this.onReGetMsg()},allMsgList(t){if(JSON.stringify(t)==JSON.stringify(this.allMsgs))return;const s=this.allMsgs.length,e=s>0?this.allMsgs[s-1].id:0;if($A.isIos()&&t.length!==s&&this.$refs.scroller){const i=this.$refs.scroller.$el;i.style.visibility="hidden",this.allMsgs=t,this.$nextTick(a=>{i.style.visibility="visible"})}else this.allMsgs=t;this.stickToBottom||(this.msgNew+=t.filter(i=>i.id&&i.id>e&&i.userid!=this.userId&&!i.read_at).length)},"allMsgs.length"(){this.stickToBottom&&this.onToBottom()},windowScrollY(t){$A.isIos()&&!this.$slots.head&&(this.$refs.nav.style.marginTop=`${Math.max(0,t)}px`)},windowActive(t){if(t&&this.autoFocus){const s=$A.last(this.dialogIns);s&&s.uid===this._uid&&this.inputFocus()}},windowHeight(){this.androidKeyboardVisible=$A.isAndroid()&&$A.eeuiAppKeyboardStatus(),requestAnimationFrame(this.$refs.input.updateTools)},dialogDrag(t){t&&(this.operateVisible=!1)},msgActiveId(t){var s;if(t>0){this.msgActiveId=0;const e=(s=this.$refs.scroller.$el.querySelector(`[data-id="${t}"]`))==null?void 0:s.querySelector(".dialog-head");e&&($A.scrollIntoViewIfNeeded(e),e.classList.add("common-shake"),setTimeout(i=>e.classList.remove("common-shake"),800))}},footerPaddingBottom(t){this.$refs.footer.style.paddingBottom=`${t}px`,requestAnimationFrame(s=>{this.$refs.input.updateTools()})},readLoadNum(){this.positionShow=!0},operateVisible(t){t||this.pointerMouse||this.focusLazy||document.getSelection().removeAllRanges()}},methods:{getDialogBase(t,s=null){var e,i;if(s){const a=[],o=this.allMsgs.filter(n=>n.read_at===null&&n.userid!=this.userId).map(n=>n.id),r=((e=this.$refs.scroller)==null?void 0:e.$el.querySelectorAll(".item-enter"))||[];for(const n of r){const l=$A.runNum((i=n.querySelector(".dialog-view"))==null?void 0:i.getAttribute("data-id"));l&&!o.includes(l)&&o.push(l)}this.waitUnreadData[s]=$A.getLastSameElements(o,a)}!t||(this.msgNew=0,this.msgType="",this.searchKey="",this.unreadOne=0,this.scrollTail=0,this.scrollOffset=0,this.searchShow=!1,this.positionShow=!1,this.msgPrepared=!1,this.scrollToBottomRefresh=!1,this.replyMsgAutoMention=!1,this.allMsgs=this.allMsgList,this.errorId=0,this.getMsgs({dialog_id:t,msg_id:this.msgId,msg_type:this.msgType}).then(({data:a})=>{if(this.openId=t,this.msgPrepared=!0,this.dialogId!==t){let o=this.waitUnreadData[t]||[];if(o.length>0){const r=[...a.list.map(n=>n.id)].reverse();$A.getLastSameElements(o,r).forEach(n=>{this.$store.dispatch("dialogMsgRead",{id:n,dialog_id:t})})}}setTimeout(o=>{this.onSearchMsgId(),this.positionShow=this.readTimeout===null},100)}).catch(a=>{this.errorId=t}),this.$store.dispatch("saveInDialog",{uid:this._uid,dialog_id:t}),this.autoFocus&&this.inputFocus(),this.getUserApproveStatus())},subMsgListener(t=!1){!$A.isSubElectron||(t?this.$store.dispatch("websocketMsgListener","DialogWrapper"):this.$store.dispatch("websocketMsgListener",{name:"DialogWrapper",callback:s=>{const{type:e,mode:i,data:a}=s;e==="dialog"&&i==="add"&&this.tempMsgs.push(a)}}))},sendMsg(t,s){let e,i="text",a="no",o=!1;if(typeof t=="string"&&t?e=t:(e=this.msgText,o=!0),s==="md"?(e=this.$refs.input.getText(),i="md"):s==="silence"&&(a="yes"),e==""){this.inputFocus();return}if(i==="text"&&(e=e.replace(/<\/span> <\/p>$/,"</span></p>").replace(/(<span\s+class="mention"(.*?)>.*?<\/span>.*?<\/span>.*?<\/span>)(\x20)?/,"$1 ")),this.dialogData.extra_quote_type==="update"){i==="text"&&(e=e.replace(new RegExp(`src=(["'])${$A.mainUrl()}`,"g"),"src=$1{{RemoteURL}}"));const r=this.quoteId;this.$store.dispatch("setLoad",{key:`msg-${r}`,delay:600}),this.cancelQuote(),this.onActive(),this.$store.dispatch("call",{url:"dialog/msg/sendtext",data:{dialog_id:this.dialogId,update_id:r,text:e,text_type:i,silence:a},method:"post",complete:n=>this.$store.dispatch("cancelLoad",`msg-${r}`)}).then(({data:n})=>{this.sendSuccess(n,0,!0),this.onPositionId(r)}).catch(({msg:n})=>{$A.modalError(n)})}else{const r=$A.stringLength(e.replace(/<img[^>]*?>/g,""))>5e3,n={id:this.getTempId(),dialog_id:this.dialogData.id,reply_id:this.quoteId,type:r?"loading":"text",userid:this.userId,msg:{type:i,text:r?"":e,reply_data:this.quoteData}};this.tempMsgs.push(n),this.msgType="",this.cancelQuote(),this.onActive(),this.$nextTick(this.onToBottom),this.$store.dispatch("call",{requestId:n.id,url:"dialog/msg/sendtext",data:{dialog_id:n.dialog_id,reply_id:n.reply_id,text:e,text_type:i,silence:a},method:"post"}).then(({data:l})=>{this.sendSuccess(l,n.id)}).catch(l=>{this.$set(n,"error",!0),this.$set(n,"errorData",{type:"text",mType:s,content:l.msg,msg:e})})}o&&requestAnimationFrame(r=>this.msgText="")},sendRecord(t){const s={id:this.getTempId(),dialog_id:this.dialogData.id,reply_id:this.quoteId,type:"record",userid:this.userId,msg:Object.assign(t,{reply_data:this.quoteData})};this.tempMsgs.push(s),this.msgType="",this.cancelQuote(),this.onActive(),this.$nextTick(this.onToBottom),this.$store.dispatch("call",{requestId:s.id,url:"dialog/msg/sendrecord",data:Object.assign(t,{dialog_id:this.dialogId,reply_id:this.quoteId}),method:"post"}).then(({data:e})=>{this.sendSuccess(e,s.id)}).catch(e=>{this.$set(s,"error",!0),this.$set(s,"errorData",{type:"record",mType:"record",content:e.msg,msg:t})})},sendFileMsg(t){const s=$A.isArray(t)?t:[t];s.length>0&&(this.pasteFile=[],this.pasteItem=[],s.some(e=>{const i={type:$A.getMiddle(e.type,null,"/"),name:e.name,size:e.size,result:null};if(i.type==="image"){const a=new FileReader;a.readAsDataURL(e),a.onload=({target:o})=>{i.result=o.result,this.pasteFile.push(e),this.pasteItem.push(i),this.pasteShow=!0}}else this.pasteFile.push(e),this.pasteItem.push(i),this.pasteShow=!0}))},sendLocationMsg(t){this.$store.dispatch("call",{url:"dialog/msg/sendlocation",data:Object.assign(t,{dialog_id:this.dialogId}),spinner:!0,method:"post"}).then(({data:s})=>{this.sendSuccess(s)}).catch(({msg:s})=>{$A.modalConfirm({icon:"error",title:"\u53D1\u9001\u5931\u8D25",content:s,cancelText:"\u53D6\u6D88\u53D1\u9001",okText:"\u91CD\u65B0\u53D1\u9001",onOk:e=>{this.sendLocationMsg(t)}})})},sendQuick(t){if(t.key==="locat-checkin"){this.$store.dispatch("openAppMapPage",{key:t.config.key,point:`${t.config.lng},${t.config.lat}`}).then(s=>{if(!$A.isJson(s))return;if(s.distance>t.config.radius){$A.modalError(`\u4F60\u9009\u62E9\u7684\u4F4D\u7F6E\u300C${s.title}\u300D\u4E0D\u5728\u7B7E\u5230\u8303\u56F4\u5185`);return}const e=$A.urlAddParams("https://api.map.baidu.com/staticimage/v2",{ak:t.config.key,center:`${s.point.lng},${s.point.lat}`,markers:`${s.point.lng},${s.point.lat}`,width:800,height:480,zoom:19,copyright:1});this.sendLocationMsg({type:"bd",lng:s.point.lng,lat:s.point.lat,title:s.title,distance:s.distance,address:s.address||"",thumb:e})});return}this.sendMsg(`<p><span data-quick-key="${t.key}">${t.label}</span></p>`)},onMsgChange(t){const s=this.allMsgs.find(({type:e,id:i})=>e=="text"&&i==t.id);s&&(typeof this.msgChangeCache[t.id]=="undefined"&&(this.msgChangeCache[t.id]=[],this.msgChangeCache[`${t.id}_load`]=!1),t.type==="append"?this.msgChangeCache[t.id].push(...`${t.text}`.split("").map(e=>({type:"append",text:e}))):t.type==="replace"&&(this.msgChangeCache[t.id]=[{type:"replace",text:t.text}]),this.onMsgOutput(t.id,s.msg))},onMsgOutput(t,s){const e=`${t}_load`,i=this.msgChangeCache[t];if(!(!i||i.length===0)&&this.msgChangeCache[e]!==!0){this.msgChangeCache[e]=!0;try{const a=i.shift();if(!a){this.msgChangeCache[e]=!1;return}const{type:o,text:r}=a,{tail:n}=this.scrollInfo();o==="append"?s.text+=r:o==="replace"&&(s.text=r),this.$nextTick(l=>{if(n<=10&&n!=this.scrollInfo().tail&&(this.operatePreventScroll++,this.$refs.scroller.scrollToBottom(),setTimeout(c=>this.operatePreventScroll--,50)),i.length===0){this.msgChangeCache[e]=!1;return}setTimeout(c=>{this.msgChangeCache[e]=!1,this.onMsgOutput(t,s)},5)})}catch{this.msgChangeCache[e]=!1}}},getTempId(){return this.tempId++},getMsgs(t){return new Promise((s,e)=>{setTimeout(i=>this.msgLoadIng++,2e3),this.$store.dispatch("getDialogMsgs",t).then(s).catch(e).finally(i=>{this.msgLoadIng--})})},msgFilter(t){if(this.msgType){if(this.msgType==="tag"){if(!t.tag)return!1}else if(this.msgType==="todo"){if(!t.todo)return!1}else if(this.msgType==="link"){if(!t.link)return!1}else if(this.msgType!==t.mtype)return!1}return!(this.msgId&&t.reply_id!=this.msgId)},onSearchMsgId(){this.dialogSearchMsgId>0&&this.openId===this.dialogId&&(this.onPositionId(this.dialogSearchMsgId),this.$store.state.dialogSearchMsgId=0)},onPositionId(t,s=0,e=0){return new Promise((i,a)=>{if(t===0){$A.modalError("\u67E5\u770B\u5931\u8D25\uFF1A\u53C2\u6570\u9519\u8BEF"),a();return}if(this.loadMsg||this.msgType!==""){if(this.msgType="",e===0)this.$store.dispatch("showSpinner",600);else if(e>20){this.$store.dispatch("hiddenSpinner"),$A.modalError("\u67E5\u770B\u5931\u8D25\uFF1A\u8BF7\u6C42\u8D85\u65F6"),a();return}e++,setTimeout(n=>{this.onPositionId(t,s,e).then(i).catch(a)},Math.min(800,200*e));return}e>0&&this.$store.dispatch("hiddenSpinner");const o=this.allMsgs.findIndex(n=>n.id===t),r=this.prevId>0?0:-1;o>r?setTimeout(n=>{this.onToIndex(o,t),i()},200):(s>0&&this.$store.dispatch("setLoad",{key:`msg-${s}`,delay:600}),this.getMsgs({dialog_id:this.dialogId,msg_id:this.msgId,msg_type:this.msgType,position_id:t,spinner:2e3,save_before:n=>{this.preventToBottom=!0},save_after:n=>{this.$nextTick(l=>{this.preventToBottom=!1})}}).finally(n=>{const l=this.allMsgs.findIndex(c=>c.id===t);l>-1&&(this.onToIndex(l,t),i()),s>0&&this.$store.dispatch("cancelLoad",`msg-${s}`)}))})},onViewTodo(t){if(this.operateVisible)return;this.todoViewId=t.id,this.todoViewMid=t.msg_id,this.todoViewShow=!0,this.allMsgs.findIndex(e=>e.id===this.todoViewMid)===-1&&this.$store.dispatch("call",{url:"dialog/msg/one",data:{msg_id:this.todoViewMid}}).then(({data:e})=>{this.todoViewData=e})},onCloseTodo(){this.todoViewLoad=!1,this.todoViewShow=!1,this.todoViewData={},this.todoViewMid=0,this.todoViewId=0},onPosTodo(){!this.todoViewMid||(this.todoViewPosLoad=!0,this.onPositionId(this.todoViewMid).then(this.onCloseTodo).finally(t=>{this.todoViewPosLoad=!1}))},onDoneTodo(){!this.todoViewId||this.todoViewLoad||(this.todoViewLoad=!0,this.$store.dispatch("call",{url:"dialog/msg/done",data:{id:this.todoViewId}}).then(({data:t})=>{this.$store.dispatch("saveDialogTodo",{id:this.todoViewId,done_at:$A.daytz().format("YYYY-MM-DD HH:mm:ss")}),this.$store.dispatch("saveDialog",{id:this.dialogId,todo_num:this.todoList.length}),t.add&&this.sendSuccess(t.add),this.todoList.length===0&&this.$store.dispatch("getDialogTodo",this.dialogId),this.onCloseTodo()}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.todoViewLoad=!1}))},inputFocus(){this.$nextTick(t=>{this.$refs.input&&this.$refs.input.focus()})},onRecordState(t){this.recordState=t},chatPasteDrag(t,s){if(this.dialogDrag=!1,$A.dataHasFolder(s==="drag"?t.dataTransfer:t.clipboardData)){t.preventDefault(),$A.modalWarning(`\u6682\u4E0D\u652F\u6301${s==="drag"?"\u62D6\u62FD":"\u7C98\u8D34"}\u6587\u4EF6\u5939\u3002`);return}const e=s==="drag"?t.dataTransfer.files:t.clipboardData.files,i=Array.prototype.slice.call(e);i.length>0&&(t.preventDefault(),this.sendFileMsg(i))},chatDragOver(t,s){let e=this.__dialog_drag=$A.randomString(8);if(!t)setTimeout(()=>{e===this.__dialog_drag&&(this.dialogDrag=t)},150);else{if(s.dataTransfer.effectAllowed==="move"||Array.prototype.slice.call(s.dataTransfer.files).length===0)return;this.dialogDrag=!0}},onTouchStart(){this.androidKeyboardVisible&&$A.eeuiAppSetDisabledUserLongClickSelect(500)},onPointerover({pointerType:t}){this.pointerMouse=t==="mouse"},pasteSend(){this.__paste_send_index||(this.__paste_send_index=1,setTimeout(()=>{this.__paste_send_index=0},300),this.pasteFile.some(t=>{this.$refs.chatUpload.upload(t)}))},chatFile(t,s){switch(t){case"progress":const e=s.showProgress?Math.max(s.percentage,.01):!1,i=this.tempMsgs.find(({id:o})=>o==s.tempId);if(i){i.msg.percentage=e;return}const a={id:s.tempId,file_uid:s.uid,dialog_id:this.dialogData.id,reply_id:this.quoteId,type:"file",userid:this.userId,msg:Object.assign(s.msg||{},{percentage:e})};this.tempMsgs.push(a),this.msgType="",this.cancelQuote(),this.onActive(),this.$nextTick(this.onToBottom);break;case"error":this.forgetTempMsg(s.tempId);break;case"success":this.sendSuccess(s.data,s.tempId);break}},sendSuccess(t,s=0,e=!1){if($A.isArray(t)){t.some(i=>{this.sendSuccess(i,s)});return}if(s>0){const i=this.tempMsgs.findIndex(({id:a})=>a==s);i>-1&&this.tempMsgs.splice(i,1,t),setTimeout(a=>{this.forgetTempMsg(s),this.forgetTempMsg(t.id)},1e3)}this.$store.dispatch("saveDialog",{id:this.dialogId,hide:0}),this.$store.dispatch("saveDialogMsg",t),e||(this.$store.dispatch("increaseTaskMsgNum",t),this.$store.dispatch("increaseMsgReplyNum",t),this.$store.dispatch("updateDialogLastMsg",t)),this.cancelQuote(),this.onActive()},forgetTempMsg(t){this.tempMsgs=this.tempMsgs.filter(({id:s})=>s!=t)},setQuote(t,s){var e;(e=this.$refs.input)==null||e.setQuote(t,s)},cancelQuote(){var t;(t=this.$refs.input)==null||t.cancelQuote()},onEventFocus(){this.focusTimer&&clearTimeout(this.focusTimer),this.focusLazy=!0,this.$emit("on-focus")},onEventBlur(){this.focusTimer=setTimeout(t=>this.focusLazy=!1,10),this.$emit("on-blur")},onEventMore(t){switch(t){case"image":case"file":this.$refs.chatUpload.handleClick();break;case"call":this.onCallTel();break;case"anon":this.onAnon();break}},onCallTel(){$A.modalConfirm({content:`\u662F\u5426\u62E8\u6253\u7535\u8BDD\u7ED9 ${this.dialogData.name}\uFF1F`,onOk:()=>{this.$store.dispatch("call",{url:"dialog/tel",data:{dialog_id:this.dialogId},spinner:600}).then(({data:t})=>{t.tel&&$A.eeuiAppSendMessage({action:"callTel",tel:t.tel}),t.add&&(this.$store.dispatch("saveDialogMsg",t.add),this.$store.dispatch("updateDialogLastMsg",t.add),this.onActive())}).catch(({msg:t})=>{$A.modalError(t)})}})},onAnon(){if(this.dialogData.type!=="user"||this.dialogData.bot){$A.modalWarning("\u533F\u540D\u6D88\u606F\u4EC5\u5141\u8BB8\u53D1\u9001\u7ED9\u4E2A\u4EBA");return}$A.modalInput({title:"\u53D1\u9001\u533F\u540D\u6D88\u606F",placeholder:"\u533F\u540D\u6D88\u606F\u5C06\u901A\u8FC7\u533F\u540D\u6D88\u606F\uFF08\u673A\u5668\u4EBA\uFF09\u53D1\u9001\u7ED9\u5BF9\u65B9\uFF0C\u4E0D\u4F1A\u8BB0\u5F55\u4F60\u7684\u4EFB\u4F55\u8EAB\u4EFD\u4FE1\u606F",inputProps:{type:"textarea",rows:3,autosize:{minRows:3,maxRows:6},maxlength:2e3},okText:"\u533F\u540D\u53D1\u9001",onOk:t=>t?new Promise((s,e)=>{this.$store.dispatch("call",{url:"dialog/msg/sendanon",data:{userid:this.dialogData.dialog_user.userid,text:t},method:"post"}).then(({msg:i})=>{s(i)}).catch(({msg:i})=>{e(i)})}):"\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9"})},onResizeEvent(t){t.some(({target:s,contentRect:e})=>{s===this.$refs.msgs?this.onMsgsResize(e):s===this.scrollGroup&&this.onScrollGroupResize(e)})},onMsgsResize({height:t}){if(this.$refs.scroller.$el.style.height=`${t}px`,typeof this.__msgs_height!="undefined"){const s=this.__msgs_height-t;if(s!==0){const{offset:e,tail:i}=this.scrollInfo();i>0&&this.onToOffset(e+s)}}this.__msgs_height=t},onScrollGroupResize(){this.stickToBottom&&this.onToBottom()},onActive(){this.$emit("on-active")},onToBottom(){this.msgNew=0;const t=this.$refs.scroller;t&&(t.scrollToBottom(),requestAnimationFrame(s=>t.scrollToBottom()))},onToIndex(t,s){const e=this.$refs.scroller;if(e){e.stopToBottom();const i=e.$el.querySelector(`[data-id="${s}"]`);i!=null&&i.parentNode.parentNode.classList.contains("item-enter")||(e.scrollToIndex(t,-80),requestAnimationFrame(a=>e.scrollToIndex(t,-80)))}requestAnimationFrame(i=>this.msgActiveId=s)},onToOffset(t,s=!1){const e=this.$refs.scroller;if(e){const i=e.getOffset()>t;e.stopToBottom(),e.scrollToOffset(t),setTimeout(a=>{i||s?e.virtual.handleFront():e.virtual.handleBehind()},10)}},scrollInfo(){const t=this.$refs.scroller;return t?t.scrollInfo():{offset:0,scale:0,tail:0}},openProject(){!this.dialogData.group_info||(this.windowPortrait&&this.$store.dispatch("openDialog",0),this.goForward({name:"manage-project",params:{projectId:this.dialogData.group_info.id}}))},openTask(){!this.dialogData.group_info||(this.taskId>0&&this.$store.dispatch("openDialog",0),this.$store.dispatch("openTask",{id:this.dialogData.group_info.id,deleted_at:this.dialogData.group_info.deleted_at,archived_at:this.dialogData.group_info.archived_at}))},openOkr(){!this.dialogData.link_id||this.$store.dispatch("openOkr",this.dialogData.link_id)},onReGetMsg(){this.scrollToBottomRefresh=!1,this.getMsgs({dialog_id:this.dialogId,msg_id:this.msgId,msg_type:this.msgType}).catch(t=>{})},onPrevPage(){this.prevId!==0&&this.getMsgs({dialog_id:this.dialogId,msg_id:this.msgId,msg_type:this.msgType,prev_id:this.prevId,save_before:t=>this.scrollDisabled=!0,save_after:t=>this.scrollDisabled=!1}).then(({data:t})=>{const s=t.list.map(e=>e.id);this.$nextTick(()=>{const e=this.$refs.scroller,i=s.reduce((a,o)=>({size:(typeof a=="object"?a.size:e.getSize(a))+e.getSize(o)}));this.onToOffset(e.getOffset()+i.size,!0)})}).catch(()=>{})},onDialogMenu(t){var s;switch(t){case"searchMsg":this.searchShow=!0,this.$nextTick(i=>{this.$refs.searchInput.focus()});break;case"openCreate":const e=[this.userId];this.dialogData.dialog_user&&this.userId!=this.dialogData.dialog_user.userid&&e.push(this.dialogData.dialog_user.userid),_.Store.set("createGroup",e);break;case"modifyNormal":this.modifyData={dialog_id:this.dialogData.id,avatar:this.dialogData.avatar,name:this.dialogData.name},this.dialogData.type==="user"&&(this.modifyData=Object.assign(this.modifyData,{userid:this.dialogData.dialog_user.userid,avatar:(s=this.cacheUserBasic.find(i=>i.userid===this.dialogData.dialog_user.userid))==null?void 0:s.userimg,clear_day:0,webhook_url:"",system_name:""}),this.modifyLoad++,this.$store.dispatch("call",{url:"users/bot/info",data:{id:this.dialogData.dialog_user.userid}}).then(({data:i})=>{this.modifyData.clear_day=i.clear_day,this.modifyData.webhook_url=i.webhook_url,this.modifyData.system_name=i.system_name}).finally(()=>{this.modifyLoad--})),this.modifyShow=!0;break;case"modifyAdmin":this.modifyData={dialog_id:this.dialogData.id,avatar:this.dialogData.avatar,admin:1},this.modifyShow=!0;break;case"groupInfo":this.groupInfoShow=!0;break;case"transfer":this.groupTransferData={dialog_id:this.dialogId,userid:[],disabledChoice:[this.userId]},this.groupTransferShow=!0;break;case"transferConfirm":this.onTransferGroup();break;case"disband":this.onDisbandGroup();break;case"exit":this.onExitGroup();break;case"report":this.reportShow=!0;break}},onTransferGroup(){if(this.groupTransferData.userid.length===0){$A.messageError("\u8BF7\u9009\u62E9\u65B0\u7684\u7FA4\u4E3B");return}this.groupTransferLoad++,this.$store.dispatch("call",{url:"dialog/group/transfer",data:{dialog_id:this.dialogId,userid:this.groupTransferData.userid[0]}}).then(({data:t,msg:s})=>{$A.messageSuccess(s),this.$store.dispatch("saveDialog",t)}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.groupTransferLoad--,this.groupTransferShow=!1})},onDisbandGroup(){$A.modalConfirm({content:`\u4F60\u786E\u5B9A\u8981\u89E3\u6563\u3010${this.dialogData.name}\u3011\u7FA4\u7EC4\u5417\uFF1F`,loading:!0,okText:"\u89E3\u6563",onOk:()=>new Promise((t,s)=>{this.$store.dispatch("call",{url:"dialog/group/disband",data:{dialog_id:this.dialogId}}).then(({msg:e})=>{t(e),this.$store.dispatch("forgetDialog",this.dialogId),this.goForward({name:"manage-messenger"})}).catch(({msg:e})=>{s(e)})})})},onExitGroup(){$A.modalConfirm({content:"\u4F60\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,s)=>{this.$store.dispatch("call",{url:"dialog/group/deluser",data:{dialog_id:this.dialogId}}).then(({msg:e})=>{t(e),this.$store.dispatch("forgetDialog",this.dialogId),this.goForward({name:"manage-messenger"})}).catch(({msg:e})=>{s(e)})})})},onModify(){this.modifyData.userid?(this.modifyLoad++,this.$store.dispatch("call",{url:"users/bot/edit",data:{id:this.modifyData.userid,avatar:this.modifyData.avatar,name:this.modifyData.name,clear_day:this.modifyData.clear_day,webhook_url:this.modifyData.webhook_url},method:"post"}).then(({data:t,msg:s})=>{$A.messageSuccess(s),this.$store.dispatch("saveUserBasic",{userid:this.modifyData.userid,nickname:t.name,userimg:t.avatar}),this.$store.dispatch("saveDialog",{id:this.modifyData.dialog_id,name:t.name}),this.modifyShow=!1,this.modifyData={}}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.modifyLoad--})):(this.modifyLoad++,this.$store.dispatch("call",{url:"dialog/group/edit",data:this.modifyData}).then(({data:t,msg:s})=>{$A.messageSuccess(s),this.$store.dispatch("saveDialog",t),this.modifyShow=!1,this.modifyData={}}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.modifyLoad--}))},onForwardBefore(){return new Promise((t,s)=>{if(this.forwardData=this.$refs.forwardSelect.formatSelect(this.$refs.forwardSelect.selects),this.forwardData.length===0)$A.messageError("\u8BF7\u9009\u62E9\u8F6C\u53D1\u5BF9\u8BDD\u6216\u6210\u5458");else{if(this.forwardDialogId=0,this.forwardData.length===1){const{type:e,userid:i}=this.forwardData[0];e==="group"&&/^d:/.test(i)&&(this.forwardDialogId=parseInt(i.replace(/^d:/,"")))}this.forwardMessage="",this.forwardSource=!0,this.forwardhow=!0}s()})},onForwardAffirm(){const t=this.$refs.forwardSelect.selects;if(t.length===0){$A.messageError("\u8BF7\u9009\u62E9\u8F6C\u53D1\u5BF9\u8BDD\u6216\u6210\u5458");return}const s=t.filter(i=>$A.leftExists(i,"d:")).map(i=>i.replace("d:","")),e=t.filter(i=>!$A.leftExists(i,"d:"));this.forwardLoad++,this.$store.dispatch("call",{url:"dialog/msg/forward",data:{dialogids:s,userids:e,msg_id:this.operateItem.id,show_source:this.forwardSource?1:0,leave_message:this.forwardMessage}}).then(({data:i,msg:a})=>{this.$store.dispatch("saveDialogMsg",i.msgs),this.$store.dispatch("updateDialogLastMsg",i.msgs),$A.messageSuccess(a),this.$refs.forwardSelect.hide(),this.forwardhow=!1}).catch(({msg:i})=>{$A.modalError(i)}).finally(i=>{this.forwardLoad--})},onActivity(t){if(this.msgActivity===!1){t&&(this.msgActivity=1);return}t?this.msgActivity++:this.msgActivity--},onScroll(t){this.operatePreventScroll===0&&(this.operateVisible=!1);const{offset:s,tail:e}=this.scrollInfo();this.scrollOffset=s,this.scrollTail=e,e<=10&&(this.msgNew=0,this.scrollToBottomRefresh&&this.onReGetMsg()),this.scrollAction=t.target.scrollTop,this.scrollDirection=this.scrollTmp<=this.scrollAction?"down":"up",setTimeout(i=>this.scrollTmp=this.scrollAction,0),this.scrollIng++,setTimeout(i=>this.scrollIng--,100)},onRange(t){if(this.preventMoreLoad)return;const s=this.scrollDirection==="down"?"next_id":"prev_id";for(let e=t.start;e<=t.end;e++){if(!this.allMsgs[e])continue;const i=this.allMsgs[e][s];if(!i)continue;const a=this.allMsgs[e+(s==="next_id"?1:-1)];a&&a.id!=i&&(this.preventMoreLoad=!0,this.getMsgs({dialog_id:this.dialogId,msg_id:this.msgId,msg_type:this.msgType,[s]:i}).finally(o=>{this.preventMoreLoad=!1}))}},onBack(){if(!this.beforeBack)return this.handleBack();const t=this.beforeBack();t&&t.then?t.then(()=>{this.handleBack()}):this.handleBack()},handleBack(){const{name:t,params:s}=this.$store.state.routeHistoryLast;t===this.$route.name&&/^\d+$/.test(s.dialogId)?this.goForward({name:this.$route.name}):this.goBack()},onMsgType(t){switch(t){case"project":this.openProject();break;case"task":this.openTask();break;case"okr":this.openOkr();break;default:this.loadMsg?$A.messageWarning("\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5..."):this.msgType=t;break}},onMention(t){const s=this.cacheUserBasic.find(({userid:e})=>e==t.userid);s&&this.$refs.input.addMention({denotationChar:"@",id:s.userid,value:s.nickname})},onLongpress({event:t,el:s,msgData:e}){if(this.operateVisible=this.operateItem.id===e.id,this.operateItem=$A.isJson(e)?e:{},this.operateCopys=[],t.target.nodeName==="IMG"&&this.$Electron?this.operateCopys.push({type:"image",icon:"&#xe7cd;",label:"\u590D\u5236\u56FE\u7247",value:$A.thumbRestore(t.target.currentSrc)}):t.target.nodeName==="A"&&(t.target.classList.contains("mention")&&t.target.classList.contains("file")&&this.findOperateFile(this.operateItem.id,t.target.href),this.operateCopys.push({type:"link",icon:"&#xe7cb;",label:"\u590D\u5236\u94FE\u63A5",value:t.target.href})),e.type==="text"){t.target.nodeName==="IMG"&&this.operateCopys.push({type:"imagedown",icon:"&#xe7a8;",label:"\u4E0B\u8F7D\u56FE\u7247",value:$A.thumbRestore(t.target.currentSrc)});const i=this.getSelectedTextInElement(s);if(i.length>0&&this.operateCopys.push({type:"selected",icon:"&#xe7df;",label:"\u590D\u5236\u9009\u62E9",value:i}),e.msg.text.replace(/<[^>]+>/g,"").length>0){let a=this.operateCopys.length>0?"\u590D\u5236\u6587\u672C":"\u590D\u5236";i.length>0&&(a="\u590D\u5236\u5168\u90E8"),this.operateCopys.push({type:"text",icon:"&#xe77f;",label:a,value:""})}}this.$nextTick(()=>{const i=s.getBoundingClientRect(),a=this.$refs.scroller.$el.getBoundingClientRect();let o=i.top+this.windowScrollY,r=i.height;i.top<a.top&&(o=a.top,r-=a.top-i.top),i.bottom>a.bottom&&(r-=i.bottom-a.bottom);const n=this.windowWidth<500?this.windowWidth/2:t.clientX;if(this.operateStyles={left:`${n}px`,top:`${o}px`,height:`${r}px`},this.operateClient={x:n,y:t.clientY},this.operateVisible)try{this.$refs.operate.$refs.drop.popper.update()}catch{}else this.operateVisible=!0})},onOperate(t,s=null){this.operateVisible=!1,this.$nextTick(e=>{switch(t){case"cancel":this.onCancelSend();break;case"reply":this.onReply();break;case"update":this.onUpdate();break;case"voice2text":this.onVoice2text();break;case"translation":this.onTranslation();break;case"copy":this.onCopy(s);break;case"forward":this.$refs.forwardSelect.onSelection();break;case"withdraw":this.onWithdraw();break;case"view":this.onViewFile();break;case"down":this.onDownFile();break;case"tag":this.onTag();break;case"newTask":let i=$A.formatMsgBasic(this.operateItem.msg.text);i=i.replace(/<img[^>]*?src=(["'])(.*?)(_thumb\.(png|jpg|jpeg))*\1[^>]*?>/g,'<img src="$2">'),i=i.replace(/<li\s+data-list="checked">/g,'<li class="tox-checklist--checked">'),i=i.replace(/<li\s+data-list="unchecked">/g,"<li>"),i=i.replace(/<ol[^>]*>([\s\S]*?)<\/ol>/g,'<ul class="tox-checklist">$1</ul>'),_.Store.set("addTask",{owner:[this.userId],content:i});break;case"todo":this.onTodo();break;case"pos":this.onPositionId(this.operateItem.id);break;case"emoji":s==="more"?Ka().then(this.onEmoji):this.onEmoji(s);break;case"top":this.onTopOperate();break}})},onCancelSend(){$A.modalConfirm({title:"\u53D6\u6D88\u53D1\u9001",content:"\u4F60\u786E\u5B9A\u8981\u53D6\u6D88\u53D1\u9001\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,s)=>{if(this.operateItem.created_at){s("\u6D88\u606F\u5DF2\u53D1\u9001\uFF0C\u4E0D\u53EF\u53D6\u6D88");return}this.operateItem.type==="file"?this.$refs.chatUpload.cancel(this.operateItem.file_uid)?(this.forgetTempMsg(this.operateItem.id),t()):s("\u53D6\u6D88\u53D1\u9001\u5931\u8D25"):this.$store.dispatch("callCancel",this.operateItem.id).then(()=>{this.forgetTempMsg(this.operateItem.id),t()}).catch(()=>{s("\u53D6\u6D88\u53D1\u9001\u5931\u8D25")})})})},onReply(t){this.replyMsgAutoMention=!0,this.setQuote(this.operateItem.id,t),this.inputFocus()},onUpdate(){const{type:t}=this.operateItem;if(this.onReply(t==="text"?"update":"reply"),t==="text"){let{text:s,type:e}=this.operateItem.msg;this.$refs.input.setPasteMode(!1),e==="md"?this.$refs.input.setText(s):(s.indexOf("mention")>-1&&(s=s.replace(/<a class="mention file" href="([^'"]*)"([^>]*)>~([^>]*)<\/a>/g,'<span class="mention" data-denotation-char="~" data-id="$1" data-value="$3">&#xFEFF;<span contenteditable="false"><span class="ql-mention-denotation-char">~</span>$3</span>&#xFEFF;</span>'),s=s.replace(/<span class="mention ([^'"]*)" data-id="(\d+)">([@#])([^>]*)<\/span>/g,'<span class="mention" data-denotation-char="$3" data-id="$2" data-value="$4">&#xFEFF;<span contenteditable="false"><span class="ql-mention-denotation-char">$3</span>$4</span>&#xFEFF;</span>')),s=s.replace(/<img[^>]*>/gi,i=>i.replace(/(width|height)="\d+"\s*/ig,"")),s=s.replace(/<p><\/p>/g,"<p><br/></p>"),this.msgText=$A.formatMsgBasic(s)),this.$nextTick(i=>this.$refs.input.setPasteMode(!0))}},onVoice2text(){if(!this.actionPermission(this.operateItem,"voice2text"))return;const{id:t}=this.operateItem;this.isLoad(`msg-${t}`)||(this.$store.dispatch("setLoad",`msg-${t}`),this.$store.dispatch("call",{url:"dialog/msg/voice2text",data:{msg_id:t}}).then(({data:s})=>{this.$store.dispatch("saveDialogMsg",s)}).catch(({msg:s})=>{$A.messageError(s)}).finally(s=>{this.$store.dispatch("cancelLoad",`msg-${t}`)}))},onTranslation(){if(!this.actionPermission(this.operateItem,"translation"))return;const{id:t}=this.operateItem,s=`msg-${t}`;this.isLoad(s)||(this.$store.dispatch("setLoad",s),this.$store.dispatch("call",{url:"dialog/msg/translation",data:{msg_id:t,language:this.cacheTranslationLanguage}}).then(({data:e})=>{this.$store.dispatch("saveTranslation",Object.assign(e,{key:s}))}).catch(({msg:e})=>{$A.messageError(e)}).finally(e=>{this.$store.dispatch("cancelLoad",s)}))},openTranslationMenu(t){const s=Object.keys(w).map(e=>({label:w[e],value:e}));this.$store.state.menuOperation={event:t,list:s,active:this.cacheTranslationLanguage,scrollHide:!0,onUpdate:async e=>{await this.$store.dispatch("setTranslationLanguage",e),this.onTranslation()}}},onCopy(t){if(!$A.isJson(t))return;const{type:s,value:e}=t;switch(s){case"image":this.$Electron&&this.getBase64Image(e).then(a=>{this.$Electron.sendMessage("copyBase64Image",{base64:a})});break;case"imagedown":this.$Electron?this.$Electron.sendMessage("saveImageAt",{params:{},url:e}):this.$store.dispatch("downUrl",{url:e,token:!1});break;case"filepos":this.$store.dispatch("filePos",e);break;case"link":this.copyText(e);break;case"selected":this.copyText(e);break;case"text":const i=$A(this.$refs.scroller.$el).find(`[data-id="${this.operateItem.id}"]`).find(".dialog-content");if(i.length>0){const a=i[0].innerText.replace(/\n\n/g,`
`).replace(/(^\s*)|(\s*$)/g,"");this.copyText(a)}else $A.messageWarning("\u4E0D\u53EF\u590D\u5236\u7684\u5185\u5BB9");break}},onWithdraw(){$A.modalConfirm({content:"\u786E\u5B9A\u64A4\u56DE\u6B64\u4FE1\u606F\u5417\uFF1F",okText:"\u64A4\u56DE",loading:!0,onOk:()=>new Promise((t,s)=>{this.$store.dispatch("call",{url:"dialog/msg/withdraw",data:{msg_id:this.operateItem.id}}).then(()=>{t("\u6D88\u606F\u5DF2\u64A4\u56DE"),this.$store.dispatch("forgetDialogMsg",this.operateItem.id)}).catch(({msg:e})=>{s(e)})})})},onViewReply(t){this.operateVisible||this.onPositionId(t.reply_id,t.msg_id)},onViewText(t,s){if(this.operateVisible)return;const{target:e,clientX:i}=t;if(e.classList.contains("translation-label")){this.operateItem=this.findMsgByElement(s),this.openTranslationMenu(t);return}let a=e;for(;a&&!a.classList.contains("dialog-scroller");){if(a.classList.contains("open-approve-details")){_.Store.set("approveDetails",a.getAttribute("data-id"));return}a=a.parentElement}switch(e.nodeName){case"IMG":if(e.classList.contains("browse"))this.onViewPicture(e.currentSrc);else{const r=$A.getTextImagesInfo(s.outerHTML);this.$store.dispatch("previewImage",{index:e.currentSrc,list:r})}break;case"SPAN":e.classList.contains("mention")&&e.classList.contains("task")&&this.$store.dispatch("openTask",$A.runNum(e.getAttribute("data-id"))),e.classList.contains("mention")&&e.classList.contains("okr")&&this.$store.dispatch("openOkr",$A.runNum(e.getAttribute("data-id")));break;case"LI":const o=e.getAttribute("data-list");if(["checked","unchecked"].includes(o)){if(i-e.getBoundingClientRect().x>18)return;const r=this.findMsgByElement(s);if(r.userid!=this.userId)return;const n=[].indexOf.call(s.querySelectorAll(e.tagName),e);o==="checked"?e.setAttribute("data-list","unchecked"):e.setAttribute("data-list","checked"),this.$store.dispatch("setLoad",{key:`msg-${r.id}`,delay:600}),this.$store.dispatch("call",{url:"dialog/msg/checked",data:{dialog_id:this.dialogId,msg_id:r.id,index:n,checked:o==="checked"?0:1}}).then(({data:l})=>{this.$store.dispatch("saveDialogMsg",l)}).catch(({msg:l})=>{o==="checked"?e.setAttribute("data-list","checked"):e.setAttribute("data-list","unchecked"),$A.modalError(l)}).finally(l=>{this.$store.dispatch("cancelLoad",`msg-${r.id}`)})}break}},findMsgByElement(t){let s=t.parentElement;for(;s&&!s.classList.contains("dialog-scroller");){if(s.classList.contains("dialog-view")){const e=s.getAttribute("data-id");return this.allMsgs.find(i=>i.id==e)||{}}s=s.parentElement}return{}},onViewFile(t){if(this.operateVisible)return;$A.isJson(t)||(t=this.operateItem);const{msg:s}=t;if(s.ext==="mp4"){this.$store.dispatch("previewImage",{index:0,list:[{src:s.path,width:s.width,height:s.height}]});return}if(["jpg","jpeg","webp","gif","png"].includes(s.ext)){this.onViewPicture(s.path);return}const e=`/single/file/msg/${t.id}`;this.$Electron?this.$store.dispatch("openChildWindow",{name:`file-msg-${t.id}`,path:e,userAgent:"/hideenOfficeTitle/",force:!1,config:{title:`${s.name} (${$A.bytesToSize(s.size)})`,titleFixed:!0,parent:null,width:Math.min(window.screen.availWidth,1440),height:Math.min(window.screen.availHeight,900)},webPreferences:{nodeIntegrationInSubFrames:s.ext==="drawio"}}):this.$isEEUiApp?this.$store.dispatch("openAppChildPage",{pageType:"app",pageTitle:`${s.name} (${$A.bytesToSize(s.size)})`,url:"web.js",params:{titleFixed:!0,allowAccess:!0,url:$A.rightDelete(window.location.href,window.location.hash)+`#${e}`}}):window.open($A.mainUrl(e.substring(1)))},onViewPicture(t){const s=this.allMsgs.filter(i=>i.type==="file"?["jpg","jpeg","webp","gif","png"].includes(i.msg.ext):i.type==="text"?i.msg.text.match(/<img\s+class="browse"[^>]*?>/):!1),e=[];s.some(({type:i,msg:a})=>{i==="file"?e.push({src:a.path,width:a.width,height:a.height}):i==="text"&&e.push(...$A.getTextImagesInfo(a.text))}),this.$store.dispatch("previewImage",{index:t,list:e})},onDownFile(t){this.operateVisible||($A.isJson(t)||(t=this.operateItem),$A.modalConfirm({language:!1,title:this.$L("\u4E0B\u8F7D\u6587\u4EF6"),okText:this.$L("\u7ACB\u5373\u4E0B\u8F7D"),content:`${t.msg.name} (${$A.bytesToSize(t.msg.size)})`,onOk:()=>{this.$store.dispatch("downUrl",$A.apiUrl(`dialog/msg/download?msg_id=${t.id}`))}}))},onReplyList(t){this.operateVisible||(this.replyListId=t.msg_id,this.replyListShow=!0)},onError(t){if(t.error!==!0)return;const{type:s,mType:e,content:i,msg:a}=t.errorData,o={icon:"error",title:"\u53D1\u9001\u5931\u8D25",content:i,cancelText:"\u53D6\u6D88\u53D1\u9001",onCancel:r=>{this.forgetTempMsg(t.id)}};if(s==="text")o.okText="\u91CD\u65B0\u53D1\u9001",o.onOk=()=>{this.forgetTempMsg(t.id),this.sendMsg(a,e)};else if(s==="record")o.okText="\u91CD\u65B0\u53D1\u9001",o.onOk=()=>{this.forgetTempMsg(t.id),this.sendRecord(a)};else return;$A.modalConfirm(o)},onEmoji(t){$A.isJson(t)||(t={msg_id:this.operateItem.id,symbol:t});const s=this.cacheEmojis.filter(e=>e!==t.symbol);s.unshift(t.symbol),$A.IDBSave("cacheEmojis",this.$store.state.cacheEmojis=s.slice(0,3)),this.$store.dispatch("setLoad",{key:`msg-${t.msg_id}`,delay:600}),this.$store.dispatch("call",{url:"dialog/msg/emoji",data:t}).then(({data:e})=>{this.dialogMsgs.findIndex(a=>a.id==e.id)>-1?this.$store.dispatch("saveDialogMsg",e):this.todoViewData.id===e.id&&(this.todoViewData=Object.assign(this.todoViewData,e))}).catch(({msg:e})=>{$A.messageError(e)}).finally(e=>{this.$store.dispatch("cancelLoad",`msg-${t.msg_id}`)})},onShowEmojiUser(t){this.operateVisible||(this.respondData=t,this.respondShow=!0)},onOther({event:t,data:s}){this.operateVisible||t==="todoAdd"&&(this.todoSpecifyData=Object.assign(this.todoSpecifyData,s),this.todoSpecifyShow=!0,this.$nextTick(e=>{this.$refs.todoSpecifySelect.onSelection()}))},onTag(){if(this.operateVisible)return;const t={msg_id:this.operateItem.id};this.$store.dispatch("setLoad",{key:`msg-${t.msg_id}`,delay:600}),this.$store.dispatch("call",{url:"dialog/msg/tag",data:t}).then(({data:s})=>{this.tagOrTodoSuccess(s)}).catch(({msg:s})=>{$A.messageError(s)}).finally(s=>{this.$store.dispatch("cancelLoad",`msg-${t.msg_id}`)})},onTypeChange(t){t==="user"&&(this.todoSettingData.userids.length===0&&this.todoSettingData.quick_value.length>0&&(this.todoSettingData.userids=this.todoSettingData.quick_value),this.$nextTick(s=>{this.$refs.userSelect.onSelection()})),t!=="quick_select"&&(this.todoSettingData.quick_value=[])},onQuickChange(t){this.todoSettingData.type=t.length===0?"all":"quick_select"},onTodo(t){var s;if(!this.operateVisible)if(t==="submit"){const e=$A.cloneJSON(this.todoSettingData);if(e.type==="quick_select")e.type="user",e.userids=e.quick_value;else if(e.type==="user"&&$A.arrayLength(e.userids)===0){$A.messageWarning("\u9009\u62E9\u6307\u5B9A\u6210\u5458");return}this.todoSettingLoad++,this.onTodoSubmit(e).then(i=>{$A.messageSuccess(i),this.todoSettingShow=!1}).catch(i=>{$A.messageError(i)}).finally(i=>{this.todoSettingLoad--})}else if(this.operateItem.todo)$A.modalConfirm({content:"\u4F60\u786E\u5B9A\u53D6\u6D88\u5F85\u529E\u5417\uFF1F",cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A",loading:!0,onOk:()=>this.onTodoSubmit({type:"user",userids:[],msg_id:this.operateItem.id})});else{const e={};e[this.userId]=this.userId;const i=(s=this.dialogData.dialog_user)==null?void 0:s.userid;if(i&&i!=this.userId&&!this.dialogData.bot&&(e[i]=i),this.operateItem.type==="text"){const a=/<span class="mention user" data-id="(\d+)">([^<]+)<\/span>/g,o=this.operateItem.msg.text.match(a);o&&o.forEach(r=>{const n=parseInt(r.replace(a,"$1"));n&&n!=this.userId&&(e[n]=n)})}this.todoSettingData={type:"all",userids:[],msg_id:this.operateItem.id,quick_value:[],quick_list:Object.values(e)},this.todoSettingShow=!0}},onTodoSpecify(){return new Promise((t,s)=>{this.onTodoSubmit(this.todoSpecifyData).then(e=>{$A.messageSuccess(e),t()}).catch(e=>{$A.messageError(e),s()})})},onTodoSubmit(t){return new Promise((s,e)=>{this.$store.dispatch("setLoad",{key:`msg-${t.msg_id}`,delay:600}),this.$store.dispatch("call",{method:"post",url:"dialog/msg/todo",data:t}).then(({data:i,msg:a})=>{s(a),this.tagOrTodoSuccess(i),this.onActive()}).catch(({msg:i})=>{e(i)}).finally(i=>{this.$store.dispatch("cancelLoad",`msg-${t.msg_id}`)})})},tagOrTodoSuccess(t){this.$store.dispatch("saveDialogMsg",t.update),t.add&&(this.$store.dispatch("saveDialogMsg",t.add),this.$store.dispatch("updateDialogLastMsg",t.add))},onSearchSwitch(t){if(this.searchResult.length!==0){if(this.searchLocation===1&&this.searchResult.length===1){this.onPositionId(this.searchResult[0]);return}t==="prev"?this.searchLocation<=1?this.searchLocation=this.searchResult.length:this.searchLocation--:this.searchLocation>=this.searchResult.length?this.searchLocation=1:this.searchLocation++}},onSearchKeyup(t){(t===null||t.keyCode===27)&&(this.searchShow=!1,this.searchKey="",this.searchResult=[])},onPositionMark(t){this.positionLoad>0||(this.positionLoad++,this.onPositionId(t).finally(s=>{this.positionLoad--}))},actionPermission(t,s){switch(s){case"forward":if(["word-chain","vote","template"].includes(t.type))return!1;break;case"newTask":return t.type==="text";case"voice2text":if(t.type!=="record"||t.msg.text)return!1;break;case"translation":return["text","record"].includes(t.type)&&t.msg.text}return!0},findOperateFile(t,s){const e=this.fileLinks.find(i=>i.link===s);if(e){this.addFileMenu(t,e);return}this.$store.dispatch("searchFiles",{link:s}).then(({data:i})=>{if(i.length===1){const a={link:s,id:i[0].id,pid:i[0].pid};this.fileLinks.push(a),this.addFileMenu(t,a)}}).catch(i=>{})},addFileMenu(t,s){if(this.operateItem.id!=t||this.operateCopys.findIndex(i=>i.type==="filepos")!==-1)return;const e=Math.max(0,this.operateCopys.findIndex(i=>i.type==="link")-1);this.operateCopys.splice(e,0,{type:"filepos",icon:"&#xe6f3;",label:"\u663E\u793A\u6587\u4EF6",value:{folderId:s.pid,fileId:null,shakeId:s.id}})},getBase64Image(t){return new Promise(s=>{let e=document.createElement("CANVAS"),i=e.getContext("2d"),a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{e.height=a.height,e.width=a.width,i.drawImage(a,0,0);let o="png";$A.rightExists(t,"jpg")||$A.rightExists(t,"jpeg")?o="jpeg":$A.rightExists(t,"webp")?o="webp":$A.rightExists(t,"git")&&(o="git"),s(e.toDataURL(`image/${o}`)),e=null},a.src=t})},getSelectedTextInElement(t){let s="";if(window.getSelection){let e=window.getSelection();if(e.rangeCount>0){const i=e.getRangeAt(0);t.contains(i.commonAncestorContainer)&&(s=i.toString())}}return s},onViewAvatar(t){let s=null;t.target.tagName==="IMG"?s=t.target.src:s=$A(t.target).find("img").attr("src"),s&&this.$store.dispatch("previewImage",s)},onTopOperate(){this.operateVisible||(this.operateItem.top_at?this.onCancelTop(this.operateItem):this.onTopSubmit(this.operateItem))},onTopSubmit(t){return new Promise((s,e)=>{this.$store.dispatch("setLoad",{key:`msg-${t.msg_id}`,delay:600}),this.$store.dispatch("call",{url:"dialog/msg/top",data:{msg_id:t.id}}).then(({data:i,msg:a})=>{var o,r,n;if(s(a),this.$store.dispatch("saveDialog",{id:this.dialogId,top_msg_id:((o=i.update)==null?void 0:o.top_msg_id)||0,top_userid:((r=i.update)==null?void 0:r.top_userid)||0}),(n=i.update)!=null&&n.top_msg_id){const l=this.dialogMsgs.findIndex(({id:c})=>c==i.update.top_msg_id);l>-1&&this.$store.dispatch("saveDialogMsgTop",Object.assign({},this.dialogMsgs[l]))}i.add&&(this.$store.dispatch("saveDialogMsg",i.add),this.$store.dispatch("updateDialogLastMsg",i.add),this.onActive())}).catch(({msg:i})=>{e(i)}).finally(i=>{this.$store.dispatch("cancelLoad",`msg-${t.msg_id}`)})})},onPosTop(){!this.topMsg||(this.topPosLoad++,this.onPositionId(this.topMsg.id).finally(t=>{this.topPosLoad--}))},onCancelTop(t){$A.modalConfirm({content:"\u4F60\u786E\u5B9A\u53D6\u6D88\u7F6E\u9876\u5417\uFF1F",cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A",loading:!0,onOk:()=>this.onTopSubmit(t)})},getUserApproveStatus(){this.approvaUserStatus="",!(this.dialogData.type!=="user"||this.dialogData.bot)&&this.$store.dispatch("call",{url:"approve/user/status",data:{userid:this.dialogData.dialog_user.userid}}).then(({data:t})=>{this.approvaUserStatus=t}).catch(({msg:t})=>{$A.messageError(t)})}}},ft={};var bo=d(Co,wo,ko,!1,Lo,null,null,null);function Lo(t){for(let s in ft)this[s]=ft[s]}var Vo=function(){return bo.exports}();export{eo as C,Vo as D};
